(function(f,b,h){var a={version:"1.0.3+ed36a04"};function d(){var i=f.L;a.noConflict=function(){f.L=i;return this};f.L=a}if(typeof module==="object"&&typeof module.exports==="object"){module.exports=a}else{if(typeof define==="function"&&define.amd){define(a)}}if(typeof f!=="undefined"){d()}a.Util={extend:function(m){var o,l,k,p;for(l=1,k=arguments.length;l<k;l++){p=arguments[l];for(o in p){m[o]=p[o]}}return m},create:Object.create||(function(){function i(){}return function(j){i.prototype=j;return new i()}})(),bind:function(j,k){var l=Array.prototype.slice;if(j.bind){return j.bind.apply(j,l.call(arguments,1))}var i=l.call(arguments,2);return function(){return j.apply(k,i.length?i.concat(l.call(arguments)):arguments)}},stamp:function(i){i._leaflet_id=i._leaflet_id||++a.Util.lastId;return i._leaflet_id},lastId:0,throttle:function(o,p,m){var l,k,j,i;i=function(){l=false;if(k){j.apply(m,k);k=false}};j=function(){if(l){k=arguments}else{o.apply(m,arguments);setTimeout(i,p);l=true}};return j},wrapNum:function(j,k,m){var i=k[1],l=k[0],o=i-l;return j===i&&m?j:((j-l)%o+o)%o+l},falseFn:function(){return false},formatNum:function(i,k){var j=Math.pow(10,k||5);return Math.round(i*j)/j},trim:function(i){return i.trim?i.trim():i.replace(/^\s+|\s+$/g,"")},splitWords:function(i){return a.Util.trim(i).split(/\s+/)},setOptions:function(l,j){if(!l.hasOwnProperty("options")){l.options=l.options?a.Util.create(l.options):{}}for(var k in j){l.options[k]=j[k]}return l.options},getParamString:function(m,j,k){var o=[];for(var l in m){o.push(encodeURIComponent(k?l.toUpperCase():l)+"="+encodeURIComponent(m[l]))}return((!j||j.indexOf("?")===-1)?"?":"&")+o.join("&")},template:function(j,i){return j.replace(a.Util.templateRe,function(m,k){var l=i[k];if(l===h){throw new Error("No value provided for variable "+m)}else{if(typeof l==="function"){l=l(i)}}return l})},templateRe:/\{ *([\w_\-]+) *\}/g,isArray:Array.isArray||function(i){return(Object.prototype.toString.call(i)==="[object Array]")},indexOf:function(l,k){for(var j=0;j<l.length;j++){if(l[j]===k){return j}}return -1},emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="};(function(){function l(o){return f["webkit"+o]||f["moz"+o]||f["ms"+o]}var m=0;function j(o){var q=+new Date(),p=Math.max(0,16-(q-m));m=q+p;return f.setTimeout(o,p)}var i=f.requestAnimationFrame||l("RequestAnimationFrame")||j,k=f.cancelAnimationFrame||l("CancelAnimationFrame")||l("CancelRequestAnimationFrame")||function(o){f.clearTimeout(o)};a.Util.requestAnimFrame=function(q,p,o){if(o&&i===j){q.call(p)}else{return i.call(f,a.bind(q,p))}};a.Util.cancelAnimFrame=function(o){if(o){k.call(f,o)}}})();a.extend=a.Util.extend;a.bind=a.Util.bind;a.stamp=a.Util.stamp;a.setOptions=a.Util.setOptions;a.Class=function(){};a.Class.extend=function(k){var o=function(){if(this.initialize){this.initialize.apply(this,arguments)}this.callInitHooks()};var m=o.__super__=this.prototype;var l=a.Util.create(m);l.constructor=o;o.prototype=l;for(var j in this){if(this.hasOwnProperty(j)&&j!=="prototype"){o[j]=this[j]}}if(k.statics){a.extend(o,k.statics);delete k.statics}if(k.includes){a.Util.extend.apply(null,[l].concat(k.includes));delete k.includes}if(l.options){k.options=a.Util.extend(a.Util.create(l.options),k.options)}a.extend(l,k);l._initHooks=[];l.callInitHooks=function(){if(this._initHooksCalled){return}if(m.callInitHooks){m.callInitHooks.call(this)}this._initHooksCalled=true;for(var q=0,p=l._initHooks.length;q<p;q++){l._initHooks[q].call(this)}};return o};a.Class.include=function(i){a.extend(this.prototype,i);return this};a.Class.mergeOptions=function(i){a.extend(this.prototype.options,i);return this};a.Class.addInitHook=function(j){var i=Array.prototype.slice.call(arguments,1);var k=typeof j==="function"?j:function(){this[j].apply(this,i)};this.prototype._initHooks=this.prototype._initHooks||[];this.prototype._initHooks.push(k);return this};a.Evented=a.Class.extend({on:function(m,p,l){if(typeof m==="object"){for(var o in m){this._on(o,m[o],p)}}else{m=a.Util.splitWords(m);for(var k=0,j=m.length;k<j;k++){this._on(m[k],p,l)}}return this},off:function(m,p,l){if(!m){delete this._events}else{if(typeof m==="object"){for(var o in m){this._off(o,m[o],p)}}else{m=a.Util.splitWords(m);for(var k=0,j=m.length;k<j;k++){this._off(m[k],p,l)}}}return this},_on:function(r,q,o){this._events=this._events||{};var k=this._events[r];if(!k){k=[];this._events[r]=k}if(o===this){o=h}var l={fn:q,ctx:o},p=k;for(var m=0,j=p.length;m<j;m++){if(p[m].fn===q&&p[m].ctx===o){return}}p.push(l)},_off:function(r,q,o){var p,m,j;if(!this._events){return}p=this._events[r];if(!p){return}if(!q){for(m=0,j=p.length;m<j;m++){p[m].fn=a.Util.falseFn}delete this._events[r];return}if(o===this){o=h}if(p){for(m=0,j=p.length;m<j;m++){var k=p[m];if(k.ctx!==o){continue}if(k.fn===q){k.fn=a.Util.falseFn;if(this._firingCount){this._events[r]=p=p.slice()}p.splice(m,1);return}}}},fire:function(q,s,k){if(!this.listens(q,k)){return this}var r=a.Util.extend({},s,{type:q,target:this});if(this._events){var p=this._events[q];if(p){this._firingCount=(this._firingCount+1)||1;for(var o=0,j=p.length;o<j;o++){var m=p[o];m.fn.call(m.ctx||this,r)}this._firingCount--}}if(k){this._propagateEvent(r)}return this},listens:function(k,i){var j=this._events&&this._events[k];if(j&&j.length){return true}if(i){for(var l in this._eventParents){if(this._eventParents[l].listens(k,i)){return true}}}return false},once:function(j,m,i){if(typeof j==="object"){for(var l in j){this.once(l,j[l],m)}return this}var k=a.bind(function(){this.off(j,m,i).off(j,k,i)},this);return this.on(j,m,i).on(j,k,i)},addEventParent:function(i){this._eventParents=this._eventParents||{};this._eventParents[a.stamp(i)]=i;return this},removeEventParent:function(i){if(this._eventParents){delete this._eventParents[a.stamp(i)]}return this},_propagateEvent:function(i){for(var j in this._eventParents){this._eventParents[j].fire(i.type,a.extend({layer:i.target},i),true)}}});var e=a.Evented.prototype;e.addEventListener=e.on;e.removeEventListener=e.clearAllEventListeners=e.off;e.addOneTimeEventListener=e.once;e.fireEvent=e.fire;e.hasEventListeners=e.listens;a.Mixin={Events:e};(function(){var l=navigator.userAgent.toLowerCase(),v=b.documentElement,k="ActiveXObject" in f,w=l.indexOf("webkit")!==-1,y=l.indexOf("phantom")!==-1,t=l.search("android [23]")!==-1,r=l.indexOf("chrome")!==-1,m=l.indexOf("gecko")!==-1&&!w&&!f.opera&&!k,u=navigator.platform.indexOf("Win")===0,j=typeof orientation!=="undefined"||l.indexOf("mobile")!==-1,p=!f.PointerEvent&&f.MSPointerEvent,i=(f.PointerEvent&&f.navigator.pointerEnabled&&f.navigator.maxTouchPoints)||p,s=k&&("transition" in v.style),x=("WebKitCSSMatrix" in f)&&("m11" in new f.WebKitCSSMatrix())&&!t,o="MozPerspective" in v.style,z="OTransition" in v.style;var q=!f.L_NO_TOUCH&&!y&&(function(){var B="ontouchstart";if(i||(B in v)){return true}var C=b.createElement("div"),A=false;if(!C.setAttribute){return false}C.setAttribute(B,"return;");if(typeof C[B]==="function"){A=true}C.removeAttribute(B);C=null;return A}());a.Browser={ie:k,ielt9:k&&!b.addEventListener,edge:"msLaunchUri" in navigator&&!("documentMode" in b),webkit:w,gecko:m,android:l.indexOf("android")!==-1,android23:t,chrome:r,safari:!r&&l.indexOf("safari")!==-1,win:u,ie3d:s,webkit3d:x,gecko3d:o,opera12:z,any3d:!f.L_DISABLE_3D&&(s||x||o)&&!z&&!y,mobile:j,mobileWebkit:j&&w,mobileWebkit3d:j&&x,mobileOpera:j&&f.opera,mobileGecko:j&&m,touch:!!q,msPointer:!!p,pointer:!!i,retina:(f.devicePixelRatio||(f.screen.deviceXDPI/f.screen.logicalXDPI))>1}}());a.Point=function(i,k,j){this.x=(j?Math.round(i):i);this.y=(j?Math.round(k):k)};a.Point.prototype={clone:function(){return new a.Point(this.x,this.y)},add:function(i){return this.clone()._add(a.point(i))},_add:function(i){this.x+=i.x;this.y+=i.y;return this},subtract:function(i){return this.clone()._subtract(a.point(i))},_subtract:function(i){this.x-=i.x;this.y-=i.y;return this},divideBy:function(i){return this.clone()._divideBy(i)},_divideBy:function(i){this.x/=i;this.y/=i;return this},multiplyBy:function(i){return this.clone()._multiplyBy(i)},_multiplyBy:function(i){this.x*=i;this.y*=i;return this},scaleBy:function(i){return new a.Point(this.x*i.x,this.y*i.y)},unscaleBy:function(i){return new a.Point(this.x/i.x,this.y/i.y)},round:function(){return this.clone()._round()},_round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},floor:function(){return this.clone()._floor()},_floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){return this.clone()._ceil()},_ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},distanceTo:function(j){j=a.point(j);var i=j.x-this.x,k=j.y-this.y;return Math.sqrt(i*i+k*k)},equals:function(i){i=a.point(i);return i.x===this.x&&i.y===this.y},contains:function(i){i=a.point(i);return Math.abs(i.x)<=Math.abs(this.x)&&Math.abs(i.y)<=Math.abs(this.y)},toString:function(){return"Point("+a.Util.formatNum(this.x)+", "+a.Util.formatNum(this.y)+")"}};a.point=function(i,k,j){if(i instanceof a.Point){return i}if(a.Util.isArray(i)){return new a.Point(i[0],i[1])}if(i===h||i===null){return i}if(typeof i==="object"&&"x" in i&&"y" in i){return new a.Point(i.x,i.y)}return new a.Point(i,k,j)};a.Bounds=function(l,k){if(!l){return}var o=k?[l,k]:l;for(var m=0,j=o.length;m<j;m++){this.extend(o[m])}};a.Bounds.prototype={extend:function(i){i=a.point(i);if(!this.min&&!this.max){this.min=i.clone();this.max=i.clone()}else{this.min.x=Math.min(i.x,this.min.x);this.max.x=Math.max(i.x,this.max.x);this.min.y=Math.min(i.y,this.min.y);this.max.y=Math.max(i.y,this.max.y)}return this},getCenter:function(i){return new a.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,i)},getBottomLeft:function(){return new a.Point(this.min.x,this.max.y)},getTopRight:function(){return new a.Point(this.max.x,this.min.y)},getSize:function(){return this.max.subtract(this.min)},contains:function(k){var j,i;if(typeof k[0]==="number"||k instanceof a.Point){k=a.point(k)}else{k=a.bounds(k)}if(k instanceof a.Bounds){j=k.min;i=k.max}else{j=i=k}return(j.x>=this.min.x)&&(i.x<=this.max.x)&&(j.y>=this.min.y)&&(i.y<=this.max.y)},intersects:function(o){o=a.bounds(o);var l=this.min,i=this.max,m=o.min,j=o.max,k=(j.x>=l.x)&&(m.x<=i.x),p=(j.y>=l.y)&&(m.y<=i.y);return k&&p},overlaps:function(p){p=a.bounds(p);var l=this.min,i=this.max,o=p.min,j=p.max,m=(j.x>l.x)&&(o.x<i.x),k=(j.y>l.y)&&(o.y<i.y);return m&&k},isValid:function(){return !!(this.min&&this.max)}};a.bounds=function(j,i){if(!j||j instanceof a.Bounds){return j}return new a.Bounds(j,i)};a.Transformation=function(j,i,l,k){this._a=j;this._b=i;this._c=l;this._d=k};a.Transformation.prototype={transform:function(i,j){return this._transform(i.clone(),j)},_transform:function(i,j){j=j||1;i.x=j*(this._a*i.x+this._b);i.y=j*(this._c*i.y+this._d);return i},untransform:function(i,j){j=j||1;return new a.Point((i.x/j-this._b)/this._a,(i.y/j-this._d)/this._c)}};a.DomUtil={get:function(i){return typeof i==="string"?b.getElementById(i):i},getStyle:function(k,j){var l=k.style[j]||(k.currentStyle&&k.currentStyle[j]);if((!l||l==="auto")&&b.defaultView){var i=b.defaultView.getComputedStyle(k,null);l=i?i[j]:null}return l==="auto"?null:l},create:function(j,l,i){var k=b.createElement(j);k.className=l||"";if(i){i.appendChild(k)}return k},remove:function(j){var i=j.parentNode;if(i){i.removeChild(j)}},empty:function(i){while(i.firstChild){i.removeChild(i.firstChild)}},toFront:function(i){i.parentNode.appendChild(i)},toBack:function(j){var i=j.parentNode;i.insertBefore(j,i.firstChild)},hasClass:function(k,i){if(k.classList!==h){return k.classList.contains(i)}var j=a.DomUtil.getClass(k);return j.length>0&&new RegExp("(^|\\s)"+i+"(\\s|$)").test(j)},addClass:function(p,k){if(p.classList!==h){var m=a.Util.splitWords(k);for(var l=0,j=m.length;l<j;l++){p.classList.add(m[l])}}else{if(!a.DomUtil.hasClass(p,k)){var o=a.DomUtil.getClass(p);a.DomUtil.setClass(p,(o?o+" ":"")+k)}}},removeClass:function(j,i){if(j.classList!==h){j.classList.remove(i)}else{a.DomUtil.setClass(j,a.Util.trim((" "+a.DomUtil.getClass(j)+" ").replace(" "+i+" "," ")))}},setClass:function(j,i){if(j.className.baseVal===h){j.className=i}else{j.className.baseVal=i}},getClass:function(i){return i.className.baseVal===h?i.className:i.className.baseVal},setOpacity:function(i,j){if("opacity" in i.style){i.style.opacity=j}else{if("filter" in i.style){a.DomUtil._setOpacityIE(i,j)}}},_setOpacityIE:function(k,l){var j=false,i="DXImageTransform.Microsoft.Alpha";try{j=k.filters.item(i)}catch(m){if(l===1){return}}l=Math.round(l*100);if(j){j.Enabled=(l!==100);j.Opacity=l}else{k.style.filter+=" progid:"+i+"(opacity="+l+")"}},testProp:function(l){var k=b.documentElement.style;for(var j=0;j<l.length;j++){if(l[j] in k){return l[j]}}return false},setTransform:function(i,k,j){var l=k||new a.Point(0,0);i.style[a.DomUtil.TRANSFORM]=(a.Browser.ie3d?"translate("+l.x+"px,"+l.y+"px)":"translate3d("+l.x+"px,"+l.y+"px,0)")+(j?" scale("+j+")":"")},setPosition:function(j,i){j._leaflet_pos=i;if(a.Browser.any3d){a.DomUtil.setTransform(j,i)}else{j.style.left=i.x+"px";j.style.top=i.y+"px"}},getPosition:function(i){return i._leaflet_pos||new a.Point(0,0)}};(function(){a.DomUtil.TRANSFORM=a.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]);var j=a.DomUtil.TRANSITION=a.DomUtil.testProp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]);a.DomUtil.TRANSITION_END=j==="webkitTransition"||j==="OTransition"?j+"End":"transitionend";if("onselectstart" in b){a.DomUtil.disableTextSelection=function(){a.DomEvent.on(f,"selectstart",a.DomEvent.preventDefault)};a.DomUtil.enableTextSelection=function(){a.DomEvent.off(f,"selectstart",a.DomEvent.preventDefault)}}else{var i=a.DomUtil.testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);a.DomUtil.disableTextSelection=function(){if(i){var k=b.documentElement.style;this._userSelect=k[i];k[i]="none"}};a.DomUtil.enableTextSelection=function(){if(i){b.documentElement.style[i]=this._userSelect;delete this._userSelect}}}a.DomUtil.disableImageDrag=function(){a.DomEvent.on(f,"dragstart",a.DomEvent.preventDefault)};a.DomUtil.enableImageDrag=function(){a.DomEvent.off(f,"dragstart",a.DomEvent.preventDefault)};a.DomUtil.preventOutline=function(k){while(k.tabIndex===-1){k=k.parentNode}if(!k||!k.style){return}a.DomUtil.restoreOutline();this._outlineElement=k;this._outlineStyle=k.style.outline;k.style.outline="none";a.DomEvent.on(f,"keydown",a.DomUtil.restoreOutline,this)};a.DomUtil.restoreOutline=function(){if(!this._outlineElement){return}this._outlineElement.style.outline=this._outlineStyle;delete this._outlineElement;delete this._outlineStyle;a.DomEvent.off(f,"keydown",a.DomUtil.restoreOutline,this)}})();a.LatLng=function(k,i,j){if(isNaN(k)||isNaN(i)){throw new Error("Invalid LatLng object: ("+k+", "+i+")")}this.lat=+k;this.lng=+i;if(j!==h){this.alt=+j}};a.extend(a.LatLng,{DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MAX_MARGIN:1e-9});a.LatLng.prototype={equals:function(k,i){if(!k){return false}k=a.latLng(k);var j=Math.max(Math.abs(this.lat-k.lat),Math.abs(this.lng-k.lng));return j<=(i===h?1e-9:i)},toString:function(i){return"LatLng("+a.Util.formatNum(this.lat,i)+", "+a.Util.formatNum(this.lng,i)+")"},distanceTo:function(i){return a.CRS.Earth.distance(this,a.latLng(i))},wrap:function(){return a.CRS.Earth.wrapLatLng(this)},toBounds:function(j){var k=180*j/40075017,i=k/Math.cos((Math.PI/180)*this.lat);return a.latLngBounds([this.lat-k,this.lng-i],[this.lat+k,this.lng+i])},clone:function(){return new a.LatLng(this.lat,this.lng,this.alt)}};a.latLng=function(j,i,k){if(j instanceof a.LatLng){return j}if(a.Util.isArray(j)&&typeof j[0]!=="object"){if(j.length===3){return new a.LatLng(j[0],j[1],j[2])}if(j.length===2){return new a.LatLng(j[0],j[1])}return null}if(j===h||j===null){return j}if(typeof j==="object"&&"lat" in j){return new a.LatLng(j.lat,"lng" in j?j.lng:j.lon,j.alt)}if(i===h){return null}return new a.LatLng(j,i,k)};a.LatLngBounds=function(m,l){if(!m){return}var k=l?[m,l]:m;for(var o=0,j=k.length;o<j;o++){this.extend(k[o])}};a.LatLngBounds.prototype={extend:function(m){var i=this._southWest,l=this._northEast,j,k;if(m instanceof a.LatLng){j=m;k=m}else{if(m instanceof a.LatLngBounds){j=m._southWest;k=m._northEast;if(!j||!k){return this}}else{return m?this.extend(a.latLng(m)||a.latLngBounds(m)):this}}if(!i&&!l){this._southWest=new a.LatLng(j.lat,j.lng);this._northEast=new a.LatLng(k.lat,k.lng)}else{i.lat=Math.min(j.lat,i.lat);i.lng=Math.min(j.lng,i.lng);l.lat=Math.max(k.lat,l.lat);l.lng=Math.max(k.lng,l.lng)}return this},pad:function(l){var j=this._southWest,m=this._northEast,i=Math.abs(j.lat-m.lat)*l,k=Math.abs(j.lng-m.lng)*l;return new a.LatLngBounds(new a.LatLng(j.lat-i,j.lng-k),new a.LatLng(m.lat+i,m.lng+k))},getCenter:function(){return new a.LatLng((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new a.LatLng(this.getNorth(),this.getWest())},getSouthEast:function(){return new a.LatLng(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(m){if(typeof m[0]==="number"||m instanceof a.LatLng||"lat" in m){m=a.latLng(m)}else{m=a.latLngBounds(m)}var i=this._southWest,l=this._northEast,j,k;if(m instanceof a.LatLngBounds){j=m.getSouthWest();k=m.getNorthEast()}else{j=k=m}return(j.lat>=i.lat)&&(k.lat<=l.lat)&&(j.lng>=i.lng)&&(k.lng<=l.lng)},intersects:function(l){l=a.latLngBounds(l);var i=this._southWest,p=this._northEast,j=l.getSouthWest(),o=l.getNorthEast(),m=(o.lat>=i.lat)&&(j.lat<=p.lat),k=(o.lng>=i.lng)&&(j.lng<=p.lng);return m&&k},overlaps:function(m){m=a.latLngBounds(m);var i=this._southWest,p=this._northEast,j=m.getSouthWest(),o=m.getNorthEast(),l=(o.lat>i.lat)&&(j.lat<p.lat),k=(o.lng>i.lng)&&(j.lng<p.lng);return l&&k},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(i){if(!i){return false}i=a.latLngBounds(i);return this._southWest.equals(i.getSouthWest())&&this._northEast.equals(i.getNorthEast())},isValid:function(){return !!(this._southWest&&this._northEast)}};a.latLngBounds=function(j,i){if(j instanceof a.LatLngBounds){return j}return new a.LatLngBounds(j,i)};a.Projection={};a.Projection.LonLat={project:function(i){return new a.Point(i.lng,i.lat)},unproject:function(i){return new a.LatLng(i.y,i.x)},bounds:a.bounds([-180,-90],[180,90])};a.Projection.SphericalMercator={R:6378137,MAX_LATITUDE:85.0511287798,project:function(m){var l=Math.PI/180,i=this.MAX_LATITUDE,k=Math.max(Math.min(i,m.lat),-i),j=Math.sin(k*l);return new a.Point(this.R*m.lng*l,this.R*Math.log((1+j)/(1-j))/2)},unproject:function(i){var j=180/Math.PI;return new a.LatLng((2*Math.atan(Math.exp(i.y/this.R))-(Math.PI/2))*j,i.x*j/this.R)},bounds:(function(){var i=6378137*Math.PI;return a.bounds([-i,-i],[i,i])})()};a.CRS={latLngToPoint:function(l,j){var i=this.projection.project(l),k=this.scale(j);return this.transformation._transform(i,k)},pointToLatLng:function(i,k){var l=this.scale(k),j=this.transformation.untransform(i,l);return this.projection.unproject(j)},project:function(i){return this.projection.project(i)},unproject:function(i){return this.projection.unproject(i)},scale:function(i){return 256*Math.pow(2,i)},zoom:function(i){return Math.log(i/256)/Math.LN2},getProjectedBounds:function(m){if(this.infinite){return null}var j=this.projection.bounds,l=this.scale(m),k=this.transformation.transform(j.min,l),i=this.transformation.transform(j.max,l);return a.bounds(k,i)},infinite:false,wrapLatLng:function(l){var i=this.wrapLng?a.Util.wrapNum(l.lng,this.wrapLng,true):l.lng,k=this.wrapLat?a.Util.wrapNum(l.lat,this.wrapLat,true):l.lat,j=l.alt;return a.latLng(k,i,j)},wrapLatLngBounds:function(i){var j=i.getCenter(),k=this.wrapLatLng(j),o=j.lat-k.lat,p=j.lng-k.lng;if(o===0&&p===0){return i}var q=i.getSouthWest(),l=i.getNorthEast(),r=a.latLng({lat:q.lat-o,lng:q.lng-p}),m=a.latLng({lat:l.lat-o,lng:l.lng-p});return new a.LatLngBounds(r,m)}};a.CRS.Simple=a.extend({},a.CRS,{projection:a.Projection.LonLat,transformation:new a.Transformation(1,0,-1,0),scale:function(i){return Math.pow(2,i)},zoom:function(i){return Math.log(i)/Math.LN2},distance:function(i,l){var k=l.lng-i.lng,j=l.lat-i.lat;return Math.sqrt(k*k+j*j)},infinite:true});a.CRS.Earth=a.extend({},a.CRS,{wrapLng:[-180,180],R:6371000,distance:function(j,o){var i=Math.PI/180,m=j.lat*i,l=o.lat*i,k=Math.sin(m)*Math.sin(l)+Math.cos(m)*Math.cos(l)*Math.cos((o.lng-j.lng)*i);return this.R*Math.acos(Math.min(k,1))}});a.CRS.EPSG3857=a.extend({},a.CRS.Earth,{code:"EPSG:3857",projection:a.Projection.SphericalMercator,transformation:(function(){var i=0.5/(Math.PI*a.Projection.SphericalMercator.R);return new a.Transformation(i,0.5,-i,0.5)}())});a.CRS.EPSG900913=a.extend({},a.CRS.EPSG3857,{code:"EPSG:900913"});a.CRS.EPSG4326=a.extend({},a.CRS.Earth,{code:"EPSG:4326",projection:a.Projection.LonLat,transformation:new a.Transformation(1/360,0.5,-1/360,0.25)});a.Map=a.Evented.extend({options:{crs:a.CRS.EPSG3857,center:h,zoom:h,minZoom:h,maxZoom:h,layers:[],maxBounds:h,renderer:h,zoomAnimation:true,zoomAnimationThreshold:4,fadeAnimation:true,markerZoomAnimation:true,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:true},initialize:function(j,i){i=a.setOptions(this,i);this._initContainer(j);this._initLayout();this._onResize=a.bind(this._onResize,this);this._initEvents();if(i.maxBounds){this.setMaxBounds(i.maxBounds)}if(i.zoom!==h){this._zoom=this._limitZoom(i.zoom)}if(i.center&&i.zoom!==h){this.setView(a.latLng(i.center),i.zoom,{reset:true})}this._handlers=[];this._layers={};this._zoomBoundLayers={};this._sizeChanged=true;this.callInitHooks();this._zoomAnimated=a.DomUtil.TRANSITION&&a.Browser.any3d&&!a.Browser.mobileOpera&&this.options.zoomAnimation;if(this._zoomAnimated){this._createAnimProxy();a.DomEvent.on(this._proxy,a.DomUtil.TRANSITION_END,this._catchTransitionEnd,this)}this._addLayers(this.options.layers)},setView:function(i,l,j){l=l===h?this._zoom:this._limitZoom(l);i=this._limitCenter(a.latLng(i),l,this.options.maxBounds);j=j||{};this._stop();if(this._loaded&&!j.reset&&j!==true){if(j.animate!==h){j.zoom=a.extend({animate:j.animate},j.zoom);j.pan=a.extend({animate:j.animate,duration:j.duration},j.pan)}var k=(this._zoom!==l)?this._tryAnimatedZoom&&this._tryAnimatedZoom(i,l,j.zoom):this._tryAnimatedPan(i,j.pan);if(k){clearTimeout(this._sizeTimer);return this}}this._resetView(i,l);return this},setZoom:function(j,i){if(!this._loaded){this._zoom=j;return this}return this.setView(this.getCenter(),j,{zoom:i})},zoomIn:function(j,i){j=j||(a.Browser.any3d?this.options.zoomDelta:1);return this.setZoom(this._zoom+j,i)},zoomOut:function(j,i){j=j||(a.Browser.any3d?this.options.zoomDelta:1);return this.setZoom(this._zoom-j,i)},setZoomAround:function(q,o,m){var p=this.getZoomScale(o),l=this.getSize().divideBy(2),k=q instanceof a.Point?q:this.latLngToContainerPoint(q),i=k.subtract(l).multiplyBy(1-1/p),j=this.containerPointToLatLng(l.add(i));return this.setView(j,o,{zoom:m})},_getBoundsCenterZoom:function(j,r){r=r||{};j=j.getBounds?j.getBounds():a.latLngBounds(j);var l=a.point(r.paddingTopLeft||r.padding||[0,0]),k=a.point(r.paddingBottomRight||r.padding||[0,0]),q=this.getBoundsZoom(j,false,l.add(k));q=(typeof r.maxZoom==="number")?Math.min(r.maxZoom,q):q;var o=k.subtract(l).divideBy(2),p=this.project(j.getSouthWest(),q),m=this.project(j.getNorthEast(),q),i=this.unproject(p.add(m).divideBy(2).add(o),q);return{center:i,zoom:q}},fitBounds:function(j,i){j=a.latLngBounds(j);if(!j.isValid()){throw new Error("Bounds are not valid.")}var k=this._getBoundsCenterZoom(j,i);return this.setView(k.center,k.zoom,i)},fitWorld:function(i){return this.fitBounds([[-90,-180],[90,180]],i)},panTo:function(i,j){return this.setView(i,this._zoom,{pan:j})},panBy:function(k,i){k=a.point(k).round();i=i||{};if(!k.x&&!k.y){return this.fire("moveend")}if(i.animate!==true&&!this.getSize().contains(k)){this._resetView(this.unproject(this.project(this.getCenter()).add(k)),this.getZoom());return this}if(!this._panAnim){this._panAnim=new a.PosAnimation();this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)}if(!i.noMoveStart){this.fire("movestart")}if(i.animate!==false){a.DomUtil.addClass(this._mapPane,"leaflet-pan-anim");var j=this._getMapPanePos().subtract(k).round();this._panAnim.run(this._mapPane,j,i.duration||0.25,i.easeLinearity)}else{this._rawPanBy(k);this.fire("move").fire("moveend")}return this},flyTo:function(G,D,o){o=o||{};if(o.animate===false||!a.Browser.any3d){return this.setView(G,D,o)}this._stop();var H=this.project(this.getCenter()),l=this.project(G),F=this.getSize(),t=this._zoom;G=a.latLng(G);D=D===h?t:D;var A=Math.max(F.x,F.y),z=A*this.getZoomScale(t,D),J=(l.distanceTo(H))||1,k=1.42,s=k*k;function E(M){var K=M?-1:1,w=M?z:A,P=z*z-A*A+K*s*s*J*J,u=2*w*s*J,r=P/u,O=Math.sqrt(r*r+1)-r;var N=O<1e-9?-18:Math.log(O);return N}function x(r){return(Math.exp(r)-Math.exp(-r))/2}function j(r){return(Math.exp(r)+Math.exp(-r))/2}function m(r){return x(r)/j(r)}var I=E(0);function y(r){return A*(j(I)/j(I+k*r))}function B(r){return A*(j(I)*m(I+k*r)-x(I))/s}function v(r){return 1-Math.pow(1-r,1.5)}var q=Date.now(),p=(E(1)-I)/k,i=o.duration?1000*o.duration:1000*p*0.8;function C(){var r=(Date.now()-q)/i,u=v(r)*p;if(r<=1){this._flyToFrame=a.Util.requestAnimFrame(C,this);this._move(this.unproject(H.add(l.subtract(H).multiplyBy(B(u)/J)),t),this.getScaleZoom(A/y(u),t),{flyTo:true})}else{this._move(G,D)._moveEnd(true)}}this._moveStart(true);C.call(this);return this},flyToBounds:function(j,i){var k=this._getBoundsCenterZoom(j,i);return this.flyTo(k.center,k.zoom,i)},setMaxBounds:function(i){i=a.latLngBounds(i);if(!i.isValid()){this.options.maxBounds=null;return this.off("moveend",this._panInsideMaxBounds)}else{if(this.options.maxBounds){this.off("moveend",this._panInsideMaxBounds)}}this.options.maxBounds=i;if(this._loaded){this._panInsideMaxBounds()}return this.on("moveend",this._panInsideMaxBounds)},setMinZoom:function(i){this.options.minZoom=i;if(this._loaded&&this.getZoom()<this.options.minZoom){return this.setZoom(i)}return this},setMaxZoom:function(i){this.options.maxZoom=i;if(this._loaded&&(this.getZoom()>this.options.maxZoom)){return this.setZoom(i)}return this},panInsideBounds:function(l,k){this._enforcingBounds=true;var i=this.getCenter(),j=this._limitCenter(i,this._zoom,a.latLngBounds(l));if(!i.equals(j)){this.panTo(j,k)}this._enforcingBounds=false;return this},invalidateSize:function(k){if(!this._loaded){return this}k=a.extend({animate:false,pan:true},k===true?{animate:true}:k);var l=this.getSize();this._sizeChanged=true;this._lastCenter=null;var j=this.getSize(),o=l.divideBy(2).round(),i=j.divideBy(2).round(),m=o.subtract(i);if(!m.x&&!m.y){return this}if(k.animate&&k.pan){this.panBy(m)}else{if(k.pan){this._rawPanBy(m)}this.fire("move");if(k.debounceMoveend){clearTimeout(this._sizeTimer);this._sizeTimer=setTimeout(a.bind(this.fire,this,"moveend"),200)}else{this.fire("moveend")}}return this.fire("resize",{oldSize:l,newSize:j})},stop:function(){this.setZoom(this._limitZoom(this._zoom));if(!this.options.zoomSnap){this.fire("viewreset")}return this._stop()},locate:function(i){i=this._locateOptions=a.extend({timeout:10000,watch:false},i);if(!("geolocation" in navigator)){this._handleGeolocationError({code:0,message:"Geolocation not supported."});return this}var k=a.bind(this._handleGeolocationResponse,this),j=a.bind(this._handleGeolocationError,this);if(i.watch){this._locationWatchId=navigator.geolocation.watchPosition(k,j,i)}else{navigator.geolocation.getCurrentPosition(k,j,i)}return this},stopLocate:function(){if(navigator.geolocation&&navigator.geolocation.clearWatch){navigator.geolocation.clearWatch(this._locationWatchId)}if(this._locateOptions){this._locateOptions.setView=false}return this},_handleGeolocationError:function(i){var k=i.code,j=i.message||(k===1?"permission denied":(k===2?"position unavailable":"timeout"));if(this._locateOptions.setView&&!this._loaded){this.fitWorld()}this.fire("locationerror",{code:k,message:"Geolocation error: "+j+"."})},_handleGeolocationResponse:function(p){var o=p.coords.latitude,q=p.coords.longitude,k=new a.LatLng(o,q),j=k.toBounds(p.coords.accuracy),s=this._locateOptions;if(s.setView){var r=this.getBoundsZoom(j);this.setView(k,s.maxZoom?Math.min(r,s.maxZoom):r)}var m={latlng:k,bounds:j,timestamp:p.timestamp};for(var l in p.coords){if(typeof p.coords[l]==="number"){m[l]=p.coords[l]}}this.fire("locationfound",m)},addHandler:function(i,k){if(!k){return this}var j=this[i]=new k(this);this._handlers.push(j);if(this.options[i]){j.enable()}return this},remove:function(){this._initEvents(true);if(this._containerId!==this._container._leaflet_id){throw new Error("Map container is being reused by another instance")}try{delete this._container._leaflet_id;delete this._containerId}catch(k){this._container._leaflet_id=h;this._containerId=h}a.DomUtil.remove(this._mapPane);if(this._clearControlPos){this._clearControlPos()}this._clearHandlers();if(this._loaded){this.fire("unload")}for(var j in this._layers){this._layers[j].remove()}return this},createPane:function(j,i){var k="leaflet-pane"+(j?" leaflet-"+j.replace("Pane","")+"-pane":""),l=a.DomUtil.create("div",k,i||this._mapPane);if(j){this._panes[j]=l}return l},getCenter:function(){this._checkIfLoaded();if(this._lastCenter&&!this._moved()){return this._lastCenter}return this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var j=this.getPixelBounds(),i=this.unproject(j.getBottomLeft()),k=this.unproject(j.getTopRight());return new a.LatLngBounds(i,k)},getMinZoom:function(){return this.options.minZoom===h?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===h?(this._layersMaxZoom===h?Infinity:this._layersMaxZoom):this.options.maxZoom},getBoundsZoom:function(i,l,r){i=a.latLngBounds(i);r=a.point(r||[0,0]);var s=this.getZoom()||0,m=this.getMinZoom(),q=this.getMaxZoom(),o=i.getNorthWest(),p=i.getSouthEast(),u=this.getSize().subtract(r),t=a.bounds(this.project(p,s),this.project(o,s)).getSize(),k=a.Browser.any3d?this.options.zoomSnap:1;var j=Math.min(u.x/t.x,u.y/t.y);s=this.getScaleZoom(j,s);if(k){s=Math.round(s/(k/100))*(k/100);s=l?Math.ceil(s/k)*k:Math.floor(s/k)*k}return Math.max(m,Math.min(q,s))},getSize:function(){if(!this._size||this._sizeChanged){this._size=new a.Point(this._container.clientWidth||0,this._container.clientHeight||0);this._sizeChanged=false}return this._size.clone()},getPixelBounds:function(i,k){var j=this._getTopLeftPoint(i,k);return new a.Bounds(j,j.add(this.getSize()))},getPixelOrigin:function(){this._checkIfLoaded();return this._pixelOrigin},getPixelWorldBounds:function(i){return this.options.crs.getProjectedBounds(i===h?this.getZoom():i)},getPane:function(i){return typeof i==="string"?this._panes[i]:i},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(j,k){var i=this.options.crs;k=k===h?this._zoom:k;return i.scale(j)/i.scale(k)},getScaleZoom:function(l,k){var i=this.options.crs;k=k===h?this._zoom:k;var j=i.zoom(l*i.scale(k));return isNaN(j)?Infinity:j},project:function(j,i){i=i===h?this._zoom:i;return this.options.crs.latLngToPoint(a.latLng(j),i)},unproject:function(i,j){j=j===h?this._zoom:j;return this.options.crs.pointToLatLng(a.point(i),j)},layerPointToLatLng:function(i){var j=a.point(i).add(this.getPixelOrigin());return this.unproject(j)},latLngToLayerPoint:function(j){var i=this.project(a.latLng(j))._round();return i._subtract(this.getPixelOrigin())},wrapLatLng:function(i){return this.options.crs.wrapLatLng(a.latLng(i))},wrapLatLngBounds:function(i){return this.options.crs.wrapLatLngBounds(a.latLngBounds(i))},distance:function(i,j){return this.options.crs.distance(a.latLng(i),a.latLng(j))},containerPointToLayerPoint:function(i){return a.point(i).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(i){return a.point(i).add(this._getMapPanePos())},containerPointToLatLng:function(i){var j=this.containerPointToLayerPoint(a.point(i));return this.layerPointToLatLng(j)},latLngToContainerPoint:function(i){return this.layerPointToContainerPoint(this.latLngToLayerPoint(a.latLng(i)))},mouseEventToContainerPoint:function(i){return a.DomEvent.getMousePosition(i,this._container)},mouseEventToLayerPoint:function(i){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(i))},mouseEventToLatLng:function(i){return this.layerPointToLatLng(this.mouseEventToLayerPoint(i))},_initContainer:function(j){var i=this._container=a.DomUtil.get(j);if(!i){throw new Error("Map container not found.")}else{if(i._leaflet_id){throw new Error("Map container is already initialized.")}}a.DomEvent.addListener(i,"scroll",this._onScroll,this);this._containerId=a.Util.stamp(i)},_initLayout:function(){var j=this._container;this._fadeAnimated=this.options.fadeAnimation&&a.Browser.any3d;a.DomUtil.addClass(j,"leaflet-container"+(a.Browser.touch?" leaflet-touch":"")+(a.Browser.retina?" leaflet-retina":"")+(a.Browser.ielt9?" leaflet-oldie":"")+(a.Browser.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var i=a.DomUtil.getStyle(j,"position");if(i!=="absolute"&&i!=="relative"&&i!=="fixed"){j.style.position="relative"}this._initPanes();if(this._initControlPos){this._initControlPos()}},_initPanes:function(){var i=this._panes={};this._paneRenderers={};this._mapPane=this.createPane("mapPane",this._container);a.DomUtil.setPosition(this._mapPane,new a.Point(0,0));this.createPane("tilePane");this.createPane("shadowPane");this.createPane("overlayPane");this.createPane("markerPane");this.createPane("tooltipPane");this.createPane("popupPane");if(!this.options.markerZoomAnimation){a.DomUtil.addClass(i.markerPane,"leaflet-zoom-hide");a.DomUtil.addClass(i.shadowPane,"leaflet-zoom-hide")}},_resetView:function(j,k){a.DomUtil.setPosition(this._mapPane,new a.Point(0,0));var l=!this._loaded;this._loaded=true;k=this._limitZoom(k);this.fire("viewprereset");var i=this._zoom!==k;this._moveStart(i)._move(j,k)._moveEnd(i);this.fire("viewreset");if(l){this.fire("load")}},_moveStart:function(i){if(i){this.fire("zoomstart")}return this.fire("movestart")},_move:function(j,k,l){if(k===h){k=this._zoom}var i=this._zoom!==k;this._zoom=k;this._lastCenter=j;this._pixelOrigin=this._getNewPixelOrigin(j);if(i||(l&&l.pinch)){this.fire("zoom",l)}return this.fire("move",l)},_moveEnd:function(i){if(i){this.fire("zoomend")}return this.fire("moveend")},_stop:function(){a.Util.cancelAnimFrame(this._flyToFrame);if(this._panAnim){this._panAnim.stop()}return this},_rawPanBy:function(i){a.DomUtil.setPosition(this._mapPane,this._getMapPanePos().subtract(i))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){if(!this._enforcingBounds){this.panInsideBounds(this.options.maxBounds)}},_checkIfLoaded:function(){if(!this._loaded){throw new Error("Set map center and zoom first.")}},_initEvents:function(j){if(!a.DomEvent){return}this._targets={};this._targets[a.stamp(this._container)]=this;var i=j?"off":"on";a.DomEvent[i](this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress",this._handleDOMEvent,this);if(this.options.trackResize){a.DomEvent[i](f,"resize",this._onResize,this)}if(a.Browser.any3d&&this.options.transform3DLimit){this[i]("moveend",this._onMoveEnd)}},_onResize:function(){a.Util.cancelAnimFrame(this._resizeRequest);this._resizeRequest=a.Util.requestAnimFrame(function(){this.invalidateSize({debounceMoveend:true})},this)},_onScroll:function(){this._container.scrollTop=0;this._container.scrollLeft=0},_onMoveEnd:function(){var i=this._getMapPanePos();if(Math.max(Math.abs(i.x),Math.abs(i.y))>=this.options.transform3DLimit){this._resetView(this.getCenter(),this.getZoom())}},_findEventTargets:function(o,j){var i=[],m,l=j==="mouseout"||j==="mouseover",p=o.target||o.srcElement,k=false;while(p){m=this._targets[a.stamp(p)];if(m&&(j==="click"||j==="preclick")&&!o._simulated&&this._draggableMoved(m)){k=true;break}if(m&&m.listens(j,true)){if(l&&!a.DomEvent._isExternalTarget(p,o)){break}i.push(m);if(l){break}}if(p===this._container){break}p=p.parentNode}if(!i.length&&!k&&!l&&a.DomEvent._isExternalTarget(p,o)){i=[this]}return i},_handleDOMEvent:function(j){if(!this._loaded||a.DomEvent._skipped(j)){return}var i=j.type==="keypress"&&j.keyCode===13?"click":j.type;if(i==="mousedown"){a.DomUtil.preventOutline(j.target||j.srcElement)}this._fireDOMEvent(j,i)},_fireDOMEvent:function(q,m,j){if(q.type==="click"){var k=a.Util.extend({},q);k.type="preclick";this._fireDOMEvent(k,k.type,j)}if(q._stopped){return}j=(j||[]).concat(this._findEventTargets(q,m));if(!j.length){return}var p=j[0];if(m==="contextmenu"&&p.listens(m,true)){a.DomEvent.preventDefault(q)}var o={originalEvent:q};if(q.type!=="keypress"){var r=p instanceof a.Marker;o.containerPoint=r?this.latLngToContainerPoint(p.getLatLng()):this.mouseEventToContainerPoint(q);o.layerPoint=this.containerPointToLayerPoint(o.containerPoint);o.latlng=r?p.getLatLng():this.layerPointToLatLng(o.layerPoint)}for(var l=0;l<j.length;l++){j[l].fire(m,o,true);if(o.originalEvent._stopped||(j[l].options.nonBubblingEvents&&a.Util.indexOf(j[l].options.nonBubblingEvents,m)!==-1)){return}}},_draggableMoved:function(i){i=i.dragging&&i.dragging.enabled()?i:this;return(i.dragging&&i.dragging.moved())||(this.boxZoom&&this.boxZoom.moved())},_clearHandlers:function(){for(var k=0,j=this._handlers.length;k<j;k++){this._handlers[k].disable()}},whenReady:function(j,i){if(this._loaded){j.call(i||this,{target:this})}else{this.on("load",j,i)}return this},_getMapPanePos:function(){return a.DomUtil.getPosition(this._mapPane)||new a.Point(0,0)},_moved:function(){var i=this._getMapPanePos();return i&&!i.equals([0,0])},_getTopLeftPoint:function(i,k){var j=i&&k!==h?this._getNewPixelOrigin(i,k):this.getPixelOrigin();return j.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(i,k){var j=this.getSize()._divideBy(2);return this.project(i,k)._subtract(j)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(l,k,i){var j=this._getNewPixelOrigin(i,k);return this.project(l,k)._subtract(j)},_latLngBoundsToNewLayerBounds:function(l,k,i){var j=this._getNewPixelOrigin(i,k);return a.bounds([this.project(l.getSouthWest(),k)._subtract(j),this.project(l.getNorthWest(),k)._subtract(j),this.project(l.getSouthEast(),k)._subtract(j),this.project(l.getNorthEast(),k)._subtract(j)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(i){return this.latLngToLayerPoint(i).subtract(this._getCenterLayerPoint())},_limitCenter:function(i,l,k){if(!k){return i}var p=this.project(i,l),j=this.getSize().divideBy(2),m=new a.Bounds(p.subtract(j),p.add(j)),o=this._getBoundsOffset(m,k,l);if(o.round().equals([0,0])){return i}return this.unproject(p.add(o),l)},_limitOffset:function(l,i){if(!i){return l}var k=this.getPixelBounds(),j=new a.Bounds(k.min.add(l),k.max.add(l));return l.add(this._getBoundsOffset(j,i))},_getBoundsOffset:function(o,k,p){var j=a.bounds(this.project(k.getNorthEast(),p),this.project(k.getSouthWest(),p)),q=j.min.subtract(o.min),m=j.max.subtract(o.max),l=this._rebound(q.x,-m.x),i=this._rebound(q.y,-m.y);return new a.Point(l,i)},_rebound:function(j,i){return j+i>0?Math.round(j-i)/2:Math.max(0,Math.ceil(j))-Math.max(0,Math.floor(i))},_limitZoom:function(l){var k=this.getMinZoom(),j=this.getMaxZoom(),i=a.Browser.any3d?this.options.zoomSnap:1;if(i){l=Math.round(l/i)*i}return Math.max(k,Math.min(j,l))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){a.DomUtil.removeClass(this._mapPane,"leaflet-pan-anim");this.fire("moveend")},_tryAnimatedPan:function(i,j){var k=this._getCenterOffset(i)._floor();if((j&&j.animate)!==true&&!this.getSize().contains(k)){return false}this.panBy(k,j);return true},_createAnimProxy:function(){var i=this._proxy=a.DomUtil.create("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(i);this.on("zoomanim",function(k){var l=a.DomUtil.TRANSFORM,j=i.style[l];a.DomUtil.setTransform(i,this.project(k.center,k.zoom),this.getZoomScale(k.zoom,1));if(j===i.style[l]&&this._animatingZoom){this._onZoomTransitionEnd()}},this);this.on("load moveend",function(){var k=this.getCenter(),j=this.getZoom();a.DomUtil.setTransform(i,this.project(k,j),this.getZoomScale(j,1))},this)},_catchTransitionEnd:function(i){if(this._animatingZoom&&i.propertyName.indexOf("transform")>=0){this._onZoomTransitionEnd()}},_nothingToAnimate:function(){return !this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(i,k,j){if(this._animatingZoom){return true}j=j||{};if(!this._zoomAnimated||j.animate===false||this._nothingToAnimate()||Math.abs(k-this._zoom)>this.options.zoomAnimationThreshold){return false}var m=this.getZoomScale(k),l=this._getCenterOffset(i)._divideBy(1-1/m);if(j.animate!==true&&!this.getSize().contains(l)){return false}a.Util.requestAnimFrame(function(){this._moveStart(true)._animateZoom(i,k,true)},this);return true},_animateZoom:function(i,l,j,k){if(j){this._animatingZoom=true;this._animateToCenter=i;this._animateToZoom=l;a.DomUtil.addClass(this._mapPane,"leaflet-zoom-anim")}this.fire("zoomanim",{center:i,zoom:l,noUpdate:k});setTimeout(a.bind(this._onZoomTransitionEnd,this),250)},_onZoomTransitionEnd:function(){if(!this._animatingZoom){return}a.DomUtil.removeClass(this._mapPane,"leaflet-zoom-anim");this._animatingZoom=false;this._move(this._animateToCenter,this._animateToZoom);a.Util.requestAnimFrame(function(){this._moveEnd(true)},this)}});a.map=function(j,i){return new a.Map(j,i)};a.Layer=a.Evented.extend({options:{pane:"overlayPane",nonBubblingEvents:[],attribution:null},addTo:function(i){i.addLayer(this);return this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(i){if(i){i.removeLayer(this)}return this},getPane:function(i){return this._map.getPane(i?(this.options[i]||i):this.options.pane)},addInteractiveTarget:function(i){this._map._targets[a.stamp(i)]=this;return this},removeInteractiveTarget:function(i){delete this._map._targets[a.stamp(i)];return this},getAttribution:function(){return this.options.attribution},_layerAdd:function(k){var j=k.target;if(!j.hasLayer(this)){return}this._map=j;this._zoomAnimated=j._zoomAnimated;if(this.getEvents){var i=this.getEvents();j.on(i,this);this.once("remove",function(){j.off(i,this)},this)}this.onAdd(j);if(this.getAttribution&&j.attributionControl){j.attributionControl.addAttribution(this.getAttribution())}this.fire("add");j.fire("layeradd",{layer:this})}});a.Map.include({addLayer:function(i){var j=a.stamp(i);if(this._layers[j]){return this}this._layers[j]=i;i._mapToAdd=this;if(i.beforeAdd){i.beforeAdd(this)}this.whenReady(i._layerAdd,i);return this},removeLayer:function(i){var j=a.stamp(i);if(!this._layers[j]){return this}if(this._loaded){i.onRemove(this)}if(i.getAttribution&&this.attributionControl){this.attributionControl.removeAttribution(i.getAttribution())}delete this._layers[j];if(this._loaded){this.fire("layerremove",{layer:i});i.fire("remove")}i._map=i._mapToAdd=null;return this},hasLayer:function(i){return !!i&&(a.stamp(i) in this._layers)},eachLayer:function(l,k){for(var j in this._layers){l.call(k,this._layers[j])}return this},_addLayers:function(l){l=l?(a.Util.isArray(l)?l:[l]):[];for(var k=0,j=l.length;k<j;k++){this.addLayer(l[k])}},_addZoomLimit:function(i){if(isNaN(i.options.maxZoom)||!isNaN(i.options.minZoom)){this._zoomBoundLayers[a.stamp(i)]=i;this._updateZoomLevels()}},_removeZoomLimit:function(i){var j=a.stamp(i);if(this._zoomBoundLayers[j]){delete this._zoomBoundLayers[j];this._updateZoomLevels()}},_updateZoomLevels:function(){var o=Infinity,j=-Infinity,m=this._getZoomSpan();for(var l in this._zoomBoundLayers){var k=this._zoomBoundLayers[l].options;o=k.minZoom===h?o:Math.min(o,k.minZoom);j=k.maxZoom===h?j:Math.max(j,k.maxZoom)}this._layersMaxZoom=j===-Infinity?h:j;this._layersMinZoom=o===Infinity?h:o;if(m!==this._getZoomSpan()){this.fire("zoomlevelschange")}if(this.options.maxZoom===h&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom){this.setZoom(this._layersMaxZoom)}if(this.options.minZoom===h&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom){this.setZoom(this._layersMinZoom)}}});var g="_leaflet_events";a.DomEvent={on:function(q,m,p,l){if(typeof m==="object"){for(var o in m){this._on(q,o,m[o],p)}}else{m=a.Util.splitWords(m);for(var k=0,j=m.length;k<j;k++){this._on(q,m[k],p,l)}}return this},off:function(q,m,p,l){if(typeof m==="object"){for(var o in m){this._off(q,o,m[o],p)}}else{m=a.Util.splitWords(m);for(var k=0,j=m.length;k<j;k++){this._off(q,m[k],p,l)}}return this},_on:function(o,m,l,j){var p=m+a.stamp(l)+(j?"_"+a.stamp(j):"");if(o[g]&&o[g][p]){return this}var k=function(q){return l.call(j||o,q||f.event)};var i=k;if(a.Browser.pointer&&m.indexOf("touch")===0){this.addPointerListener(o,m,k,p)}else{if(a.Browser.touch&&(m==="dblclick")&&this.addDoubleTapListener&&!(a.Browser.pointer&&a.Browser.chrome)){this.addDoubleTapListener(o,k,p)}else{if("addEventListener" in o){if(m==="mousewheel"){o.addEventListener("onwheel" in o?"wheel":"mousewheel",k,false)}else{if((m==="mouseenter")||(m==="mouseleave")){k=function(q){q=q||f.event;if(a.DomEvent._isExternalTarget(o,q)){i(q)}};o.addEventListener(m==="mouseenter"?"mouseover":"mouseout",k,false)}else{if(m==="click"&&a.Browser.android){k=function(q){return a.DomEvent._filterClick(q,i)}}o.addEventListener(m,k,false)}}}else{if("attachEvent" in o){o.attachEvent("on"+m,k)}}}}o[g]=o[g]||{};o[g][p]=k;return this},_off:function(m,l,k,i){var o=l+a.stamp(k)+(i?"_"+a.stamp(i):""),j=m[g]&&m[g][o];if(!j){return this}if(a.Browser.pointer&&l.indexOf("touch")===0){this.removePointerListener(m,l,o)}else{if(a.Browser.touch&&(l==="dblclick")&&this.removeDoubleTapListener){this.removeDoubleTapListener(m,o)}else{if("removeEventListener" in m){if(l==="mousewheel"){m.removeEventListener("onwheel" in m?"wheel":"mousewheel",j,false)}else{m.removeEventListener(l==="mouseenter"?"mouseover":l==="mouseleave"?"mouseout":l,j,false)}}else{if("detachEvent" in m){m.detachEvent("on"+l,j)}}}}m[g][o]=null;return this},stopPropagation:function(i){if(i.stopPropagation){i.stopPropagation()}else{if(i.originalEvent){i.originalEvent._stopped=true}else{i.cancelBubble=true}}a.DomEvent._skipped(i);return this},disableScrollPropagation:function(i){return a.DomEvent.on(i,"mousewheel",a.DomEvent.stopPropagation)},disableClickPropagation:function(j){var i=a.DomEvent.stopPropagation;a.DomEvent.on(j,a.Draggable.START.join(" "),i);return a.DomEvent.on(j,{click:a.DomEvent._fakeStop,dblclick:i})},preventDefault:function(i){if(i.preventDefault){i.preventDefault()}else{i.returnValue=false}return this},stop:function(i){return a.DomEvent.preventDefault(i).stopPropagation(i)},getMousePosition:function(k,i){if(!i){return new a.Point(k.clientX,k.clientY)}var j=i.getBoundingClientRect();return new a.Point(k.clientX-j.left-i.clientLeft,k.clientY-j.top-i.clientTop)},_wheelPxFactor:(a.Browser.win&&a.Browser.chrome)?2:a.Browser.gecko?f.devicePixelRatio:1,getWheelDelta:function(i){return(a.Browser.edge)?i.wheelDeltaY/2:(i.deltaY&&i.deltaMode===0)?-i.deltaY/a.DomEvent._wheelPxFactor:(i.deltaY&&i.deltaMode===1)?-i.deltaY*20:(i.deltaY&&i.deltaMode===2)?-i.deltaY*60:(i.deltaX||i.deltaZ)?0:i.wheelDelta?(i.wheelDeltaY||i.wheelDelta)/2:(i.detail&&Math.abs(i.detail)<32765)?-i.detail*20:i.detail?i.detail/-32765*60:0},_skipEvents:{},_fakeStop:function(i){a.DomEvent._skipEvents[i.type]=true},_skipped:function(j){var i=this._skipEvents[j.type];this._skipEvents[j.type]=false;return i},_isExternalTarget:function(i,l){var k=l.relatedTarget;if(!k){return true}try{while(k&&(k!==i)){k=k.parentNode}}catch(j){return false}return(k!==i)},_filterClick:function(l,k){var j=(l.timeStamp||(l.originalEvent&&l.originalEvent.timeStamp)),i=a.DomEvent._lastClick&&(j-a.DomEvent._lastClick);if((i&&i>100&&i<500)||(l.target._simulatedClick&&!l._simulated)){a.DomEvent.stop(l);return}a.DomEvent._lastClick=j;k(l)}};a.DomEvent.addListener=a.DomEvent.on;a.DomEvent.removeListener=a.DomEvent.off;a.PosAnimation=a.Evented.extend({run:function(j,i,k,l){this.stop();this._el=j;this._inProgress=true;this._duration=k||0.25;this._easeOutPower=1/Math.max(l||0.5,0.2);this._startPos=a.DomUtil.getPosition(j);this._offset=i.subtract(this._startPos);this._startTime=+new Date();this.fire("start");this._animate()},stop:function(){if(!this._inProgress){return}this._step(true);this._complete()},_animate:function(){this._animId=a.Util.requestAnimFrame(this._animate,this);this._step()},_step:function(j){var i=(+new Date())-this._startTime,k=this._duration*1000;if(i<k){this._runFrame(this._easeOut(i/k),j)}else{this._runFrame(1);this._complete()}},_runFrame:function(j,i){var k=this._startPos.add(this._offset.multiplyBy(j));if(i){k._round()}a.DomUtil.setPosition(this._el,k);this.fire("step")},_complete:function(){a.Util.cancelAnimFrame(this._animId);this._inProgress=false;this.fire("end")},_easeOut:function(i){return 1-Math.pow(1-i,this._easeOutPower)}});a.Projection.Mercator={R:6378137,R_MINOR:6356752.314245179,bounds:a.bounds([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(q){var o=Math.PI/180,l=this.R,p=q.lat*o,j=this.R_MINOR/l,m=Math.sqrt(1-j*j),i=m*Math.sin(p);var k=Math.tan(Math.PI/4-p/2)/Math.pow((1-i)/(1+i),m/2);p=-l*Math.log(Math.max(k,1e-10));return new a.Point(q.lng*o*l,p)},unproject:function(u){var s=180/Math.PI,j=this.R,l=this.R_MINOR/j,p=Math.sqrt(1-l*l),t=Math.exp(-u.y/j),q=Math.PI/2-2*Math.atan(t);for(var m=0,o=0.1,k;m<15&&Math.abs(o)>1e-7;m++){k=p*Math.sin(q);k=Math.pow((1-k)/(1+k),p/2);o=Math.PI/2-2*Math.atan(t*k)-q;q+=o}return new a.LatLng(q*s,u.x*s/j)}};a.CRS.EPSG3395=a.extend({},a.CRS.Earth,{code:"EPSG:3395",projection:a.Projection.Mercator,transformation:(function(){var i=0.5/(Math.PI*a.Projection.Mercator.R);return new a.Transformation(i,0.5,-i,0.5)}())});a.GridLayer=a.Layer.extend({options:{tileSize:256,opacity:1,updateWhenIdle:a.Browser.mobile,updateWhenZooming:true,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:h,noWrap:false,pane:"tilePane",className:"",keepBuffer:2},initialize:function(i){a.setOptions(this,i)},onAdd:function(){this._initContainer();this._levels={};this._tiles={};this._resetView();this._update()},beforeAdd:function(i){i._addZoomLimit(this)},onRemove:function(i){this._removeAllTiles();a.DomUtil.remove(this._container);i._removeZoomLimit(this);this._container=null;this._tileZoom=null},bringToFront:function(){if(this._map){a.DomUtil.toFront(this._container);this._setAutoZIndex(Math.max)}return this},bringToBack:function(){if(this._map){a.DomUtil.toBack(this._container);this._setAutoZIndex(Math.min)}return this},getContainer:function(){return this._container},setOpacity:function(i){this.options.opacity=i;this._updateOpacity();return this},setZIndex:function(i){this.options.zIndex=i;this._updateZIndex();return this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();this._update()}return this},getEvents:function(){var i={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};if(!this.options.updateWhenIdle){if(!this._onMove){this._onMove=a.Util.throttle(this._onMoveEnd,this.options.updateInterval,this)}i.move=this._onMove}if(this._zoomAnimated){i.zoomanim=this._animateZoom}return i},createTile:function(){return b.createElement("div")},getTileSize:function(){var i=this.options.tileSize;return i instanceof a.Point?i:new a.Point(i,i)},_updateZIndex:function(){if(this._container&&this.options.zIndex!==h&&this.options.zIndex!==null){this._container.style.zIndex=this.options.zIndex}},_setAutoZIndex:function(m){var o=this.getPane().children,l=-m(-Infinity,Infinity);for(var k=0,j=o.length,p;k<j;k++){p=o[k].style.zIndex;if(o[k]!==this._container&&p){l=m(l,+p)}}if(isFinite(l)){this.options.zIndex=l+m(-1,1);this._updateZIndex()}},_updateOpacity:function(){if(!this._map){return}if(a.Browser.ielt9){return}a.DomUtil.setOpacity(this._container,this.options.opacity);var i=+new Date(),l=false,o=false;for(var j in this._tiles){var k=this._tiles[j];if(!k.current||!k.loaded){continue}var m=Math.min(1,(i-k.loaded)/200);a.DomUtil.setOpacity(k.el,m);if(m<1){l=true}else{if(k.active){o=true}k.active=true}}if(o&&!this._noPrune){this._pruneTiles()}if(l){a.Util.cancelAnimFrame(this._fadeFrame);this._fadeFrame=a.Util.requestAnimFrame(this._updateOpacity,this)}},_initContainer:function(){if(this._container){return}this._container=a.DomUtil.create("div","leaflet-layer "+(this.options.className||""));this._updateZIndex();if(this.options.opacity<1){this._updateOpacity()}this.getPane().appendChild(this._container)},_updateLevels:function(){var j=this._tileZoom,i=this.options.maxZoom;if(j===h){return h}for(var l in this._levels){if(this._levels[l].el.children.length||l===j){this._levels[l].el.style.zIndex=i-Math.abs(j-l)}else{a.DomUtil.remove(this._levels[l].el);this._removeTilesAtZoom(l);delete this._levels[l]}}var m=this._levels[j],k=this._map;if(!m){m=this._levels[j]={};m.el=a.DomUtil.create("div","leaflet-tile-container leaflet-zoom-animated",this._container);m.el.style.zIndex=i;m.origin=k.project(k.unproject(k.getPixelOrigin()),j).round();m.zoom=j;this._setZoomTransform(m,k.getCenter(),k.getZoom());a.Util.falseFn(m.el.offsetWidth)}this._level=m;return m},_pruneTiles:function(){if(!this._map){return}var i,k;var j=this._map.getZoom();if(j>this.options.maxZoom||j<this.options.minZoom){this._removeAllTiles();return}for(i in this._tiles){k=this._tiles[i];k.retain=k.current}for(i in this._tiles){k=this._tiles[i];if(k.current&&!k.active){var l=k.coords;if(!this._retainParent(l.x,l.y,l.z,l.z-5)){this._retainChildren(l.x,l.y,l.z,l.z+2)}}}for(i in this._tiles){if(!this._tiles[i].retain){this._removeTile(i)}}},_removeTilesAtZoom:function(j){for(var i in this._tiles){if(this._tiles[i].coords.z!==j){continue}this._removeTile(i)}},_removeAllTiles:function(){for(var i in this._tiles){this._removeTile(i)}},_invalidateAll:function(){for(var i in this._levels){a.DomUtil.remove(this._levels[i].el);delete this._levels[i]}this._removeAllTiles();this._tileZoom=null},_retainParent:function(q,o,m,i){var j=Math.floor(q/2),p=Math.floor(o/2),k=m-1,s=new a.Point(+j,+p);s.z=+k;var r=this._tileCoordsToKey(s),l=this._tiles[r];if(l&&l.active){l.retain=true;return true}else{if(l&&l.loaded){l.retain=true}}if(k>i){return this._retainParent(j,p,k,i)}return false},_retainChildren:function(s,p,o,r){for(var l=2*s;l<2*s+2;l++){for(var k=2*p;k<2*p+2;k++){var q=new a.Point(l,k);q.z=o+1;var t=this._tileCoordsToKey(q),m=this._tiles[t];if(m&&m.active){m.retain=true;continue}else{if(m&&m.loaded){m.retain=true}}if(o+1<r){this._retainChildren(l,k,o+1,r)}}}},_resetView:function(j){var i=j&&(j.pinch||j.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),i,i)},_animateZoom:function(i){this._setView(i.center,i.zoom,true,i.noUpdate)},_setView:function(j,l,i,k){var o=Math.round(l);if((this.options.maxZoom!==h&&o>this.options.maxZoom)||(this.options.minZoom!==h&&o<this.options.minZoom)){o=h}var m=this.options.updateWhenZooming&&(o!==this._tileZoom);if(!k||m){this._tileZoom=o;if(this._abortLoading){this._abortLoading()}this._updateLevels();this._resetGrid();if(o!==h){this._update(j)}if(!i){this._pruneTiles()}this._noPrune=!!i}this._setZoomTransforms(j,l)},_setZoomTransforms:function(j,l){for(var k in this._levels){this._setZoomTransform(this._levels[k],j,l)}},_setZoomTransform:function(m,i,j){var l=this._map.getZoomScale(j,m.zoom),k=m.origin.multiplyBy(l).subtract(this._map._getNewPixelOrigin(i,j)).round();if(a.Browser.any3d){a.DomUtil.setTransform(m.el,k,l)}else{a.DomUtil.setPosition(m.el,k)}},_resetGrid:function(){var l=this._map,i=l.options.crs,k=this._tileSize=this.getTileSize(),m=this._tileZoom;var j=this._map.getPixelWorldBounds(this._tileZoom);if(j){this._globalTileRange=this._pxBoundsToTileRange(j)}this._wrapX=i.wrapLng&&!this.options.noWrap&&[Math.floor(l.project([0,i.wrapLng[0]],m).x/k.x),Math.ceil(l.project([0,i.wrapLng[1]],m).x/k.y)];this._wrapY=i.wrapLat&&!this.options.noWrap&&[Math.floor(l.project([i.wrapLat[0],0],m).y/k.x),Math.ceil(l.project([i.wrapLat[1],0],m).y/k.y)]},_onMoveEnd:function(){if(!this._map||this._map._animatingZoom){return}this._update()},_getTiledPixelBounds:function(i){var m=this._map,l=m._animatingZoom?Math.max(m._animateToZoom,m.getZoom()):m.getZoom(),o=m.getZoomScale(l,this._tileZoom),k=m.project(i,this._tileZoom).floor(),j=m.getSize().divideBy(o*2);return new a.Bounds(k.subtract(j),k.add(j))},_update:function(k){var l=this._map;if(!l){return}var A=l.getZoom();if(k===h){k=l.getCenter()}if(this._tileZoom===h){return}var r=this._getTiledPixelBounds(k),m=this._pxBoundsToTileRange(r),x=m.getCenter(),t=[],o=this.options.keepBuffer,s=new a.Bounds(m.getBottomLeft().subtract([o,-o]),m.getTopRight().add([o,-o]));for(var z in this._tiles){var w=this._tiles[z].coords;if(w.z!==this._tileZoom||!s.contains(a.point(w.x,w.y))){this._tiles[z].current=false}}if(Math.abs(A-this._tileZoom)>1){this._setView(k,A);return}for(var p=m.min.y;p<=m.max.y;p++){for(var q=m.min.x;q<=m.max.x;q++){var y=new a.Point(q,p);y.z=this._tileZoom;if(!this._isValidTile(y)){continue}var v=this._tiles[this._tileCoordsToKey(y)];if(v){v.current=true}else{t.push(y)}}}t.sort(function(j,i){return j.distanceTo(x)-i.distanceTo(x)});if(t.length!==0){if(!this._loading){this._loading=true;this.fire("loading")}var u=b.createDocumentFragment();for(q=0;q<t.length;q++){this._addTile(t[q],u)}this._level.el.appendChild(u)}},_isValidTile:function(k){var i=this._map.options.crs;if(!i.infinite){var j=this._globalTileRange;if((!i.wrapLng&&(k.x<j.min.x||k.x>j.max.x))||(!i.wrapLat&&(k.y<j.min.y||k.y>j.max.y))){return false}}if(!this.options.bounds){return true}var l=this._tileCoordsToBounds(k);return a.latLngBounds(this.options.bounds).overlaps(l)},_keyToBounds:function(i){return this._tileCoordsToBounds(this._keyToTileCoords(i))},_tileCoordsToBounds:function(p){var q=this._map,o=this.getTileSize(),k=p.scaleBy(o),i=k.add(o),j=q.unproject(k,p.z),m=q.unproject(i,p.z),l=new a.LatLngBounds(j,m);if(!this.options.noWrap){q.wrapLatLngBounds(l)}return l},_tileCoordsToKey:function(i){return i.x+":"+i.y+":"+i.z},_keyToTileCoords:function(j){var i=j.split(":"),l=new a.Point(+i[0],+i[1]);l.z=+i[2];return l},_removeTile:function(i){var j=this._tiles[i];if(!j){return}a.DomUtil.remove(j.el);delete this._tiles[i];this.fire("tileunload",{tile:j.el,coords:this._keyToTileCoords(i)})},_initTile:function(i){a.DomUtil.addClass(i,"leaflet-tile");var j=this.getTileSize();i.style.width=j.x+"px";i.style.height=j.y+"px";i.onselectstart=a.Util.falseFn;i.onmousemove=a.Util.falseFn;if(a.Browser.ielt9&&this.options.opacity<1){a.DomUtil.setOpacity(i,this.options.opacity)}if(a.Browser.android&&!a.Browser.android23){i.style.WebkitBackfaceVisibility="hidden"}},_addTile:function(m,i){var k=this._getTilePos(m),j=this._tileCoordsToKey(m);var l=this.createTile(this._wrapCoords(m),a.bind(this._tileReady,this,m));this._initTile(l);if(this.createTile.length<2){a.Util.requestAnimFrame(a.bind(this._tileReady,this,m,null,l))}a.DomUtil.setPosition(l,k);this._tiles[j]={el:l,coords:m,current:true};i.appendChild(l);this.fire("tileloadstart",{tile:l,coords:m})},_tileReady:function(l,k,j){if(!this._map){return}if(k){this.fire("tileerror",{error:k,tile:j,coords:l})}var i=this._tileCoordsToKey(l);j=this._tiles[i];if(!j){return}j.loaded=+new Date();if(this._map._fadeAnimated){a.DomUtil.setOpacity(j.el,0);a.Util.cancelAnimFrame(this._fadeFrame);this._fadeFrame=a.Util.requestAnimFrame(this._updateOpacity,this)}else{j.active=true;this._pruneTiles()}if(!k){a.DomUtil.addClass(j.el,"leaflet-tile-loaded");this.fire("tileload",{tile:j.el,coords:l})}if(this._noTilesToLoad()){this._loading=false;this.fire("load");if(a.Browser.ielt9||!this._map._fadeAnimated){a.Util.requestAnimFrame(this._pruneTiles,this)}else{setTimeout(a.bind(this._pruneTiles,this),250)}}},_getTilePos:function(i){return i.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(i){var j=new a.Point(this._wrapX?a.Util.wrapNum(i.x,this._wrapX):i.x,this._wrapY?a.Util.wrapNum(i.y,this._wrapY):i.y);j.z=i.z;return j},_pxBoundsToTileRange:function(i){var j=this.getTileSize();return new a.Bounds(i.min.unscaleBy(j).floor(),i.max.unscaleBy(j).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var i in this._tiles){if(!this._tiles[i].loaded){return false}}return true}});a.gridLayer=function(i){return new a.GridLayer(i)};a.TileLayer=a.GridLayer.extend({options:{minZoom:0,maxZoom:18,maxNativeZoom:null,minNativeZoom:null,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:false,zoomReverse:false,detectRetina:false,crossOrigin:false},initialize:function(j,i){this._url=j;i=a.setOptions(this,i);if(i.detectRetina&&a.Browser.retina&&i.maxZoom>0){i.tileSize=Math.floor(i.tileSize/2);if(!i.zoomReverse){i.zoomOffset++;i.maxZoom--}else{i.zoomOffset--;i.minZoom++}i.minZoom=Math.max(0,i.minZoom)}if(typeof i.subdomains==="string"){i.subdomains=i.subdomains.split("")}if(!a.Browser.android){this.on("tileunload",this._onTileRemove)}},setUrl:function(i,j){this._url=i;if(!j){this.redraw()}return this},createTile:function(k,i){var j=b.createElement("img");a.DomEvent.on(j,"load",a.bind(this._tileOnLoad,this,i,j));a.DomEvent.on(j,"error",a.bind(this._tileOnError,this,i,j));if(this.options.crossOrigin){j.crossOrigin=""}j.alt="";j.setAttribute("role","presentation");j.src=this.getTileUrl(k);return j},getTileUrl:function(j){var i={r:a.Browser.retina?"@2x":"",s:this._getSubdomain(j),x:j.x,y:j.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var k=this._globalTileRange.max.y-j.y;if(this.options.tms){i.y=k}i["-y"]=k}return a.Util.template(this._url,a.extend(i,this.options))},_tileOnLoad:function(i,j){if(a.Browser.ielt9){setTimeout(a.bind(i,this,null,j),0)}else{i(null,j)}},_tileOnError:function(j,k,l){var i=this.options.errorTileUrl;if(i&&k.src!==i){k.src=i}j(l,k)},getTileSize:function(){var k=this._map,j=a.GridLayer.prototype.getTileSize.call(this),i=this._tileZoom+this.options.zoomOffset,m=this.options.minNativeZoom,l=this.options.maxNativeZoom;if(m!==null&&i<m){return j.divideBy(k.getZoomScale(m,i)).round()}if(l!==null&&i>l){return j.divideBy(k.getZoomScale(l,i)).round()}return j},_onTileRemove:function(i){i.tile.onload=null},_getZoomForUrl:function(){var k=this._tileZoom,j=this.options.maxZoom,l=this.options.zoomReverse,i=this.options.zoomOffset,o=this.options.minNativeZoom,m=this.options.maxNativeZoom;if(l){k=j-k}k+=i;if(o!==null&&k<o){return o}if(m!==null&&k>m){return m}return k},_getSubdomain:function(j){var i=Math.abs(j.x+j.y)%this.options.subdomains.length;return this.options.subdomains[i]},_abortLoading:function(){var j,k;for(j in this._tiles){if(this._tiles[j].coords.z!==this._tileZoom){k=this._tiles[j].el;k.onload=a.Util.falseFn;k.onerror=a.Util.falseFn;if(!k.complete){k.src=a.Util.emptyImageUrl;a.DomUtil.remove(k)}}}}});a.tileLayer=function(j,i){return new a.TileLayer(j,i)};a.TileLayer.WMS=a.TileLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:false,version:"1.1.1"},options:{crs:null,uppercase:false},initialize:function(l,k){this._url=l;var j=a.extend({},this.defaultWmsParams);for(var m in k){if(!(m in this.options)){j[m]=k[m]}}k=a.setOptions(this,k);j.width=j.height=k.tileSize*(k.detectRetina&&a.Browser.retina?2:1);this.wmsParams=j},onAdd:function(i){this._crs=this.options.crs||i.options.crs;this._wmsVersion=parseFloat(this.wmsParams.version);var j=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[j]=this._crs.code;a.TileLayer.prototype.onAdd.call(this,i)},getTileUrl:function(l){var m=this._tileCoordsToBounds(l),i=this._crs.project(m.getNorthWest()),k=this._crs.project(m.getSouthEast()),o=(this._wmsVersion>=1.3&&this._crs===a.CRS.EPSG4326?[k.y,i.x,i.y,k.x]:[i.x,k.y,k.x,i.y]).join(","),j=a.TileLayer.prototype.getTileUrl.call(this,l);return j+a.Util.getParamString(this.wmsParams,j,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+o},setParams:function(j,i){a.extend(this.wmsParams,j);if(!i){this.redraw()}return this}});a.tileLayer.wms=function(j,i){return new a.TileLayer.WMS(j,i)};a.ImageOverlay=a.Layer.extend({options:{opacity:1,alt:"",interactive:false,crossOrigin:false},initialize:function(j,k,i){this._url=j;this._bounds=a.latLngBounds(k);a.setOptions(this,i)},onAdd:function(){if(!this._image){this._initImage();if(this.options.opacity<1){this._updateOpacity()}}if(this.options.interactive){a.DomUtil.addClass(this._image,"leaflet-interactive");this.addInteractiveTarget(this._image)}this.getPane().appendChild(this._image);this._reset()},onRemove:function(){a.DomUtil.remove(this._image);if(this.options.interactive){this.removeInteractiveTarget(this._image)}},setOpacity:function(i){this.options.opacity=i;if(this._image){this._updateOpacity()}return this},setStyle:function(i){if(i.opacity){this.setOpacity(i.opacity)}return this},bringToFront:function(){if(this._map){a.DomUtil.toFront(this._image)}return this},bringToBack:function(){if(this._map){a.DomUtil.toBack(this._image)}return this},setUrl:function(i){this._url=i;if(this._image){this._image.src=i}return this},setBounds:function(i){this._bounds=i;if(this._map){this._reset()}return this},getEvents:function(){var i={zoom:this._reset,viewreset:this._reset};if(this._zoomAnimated){i.zoomanim=this._animateZoom}return i},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var i=this._image=a.DomUtil.create("img","leaflet-image-layer "+(this._zoomAnimated?"leaflet-zoom-animated":""));i.onselectstart=a.Util.falseFn;i.onmousemove=a.Util.falseFn;i.onload=a.bind(this.fire,this,"load");if(this.options.crossOrigin){i.crossOrigin=""}i.src=this._url;i.alt=this.options.alt},_animateZoom:function(i){var k=this._map.getZoomScale(i.zoom),j=this._map._latLngBoundsToNewLayerBounds(this._bounds,i.zoom,i.center).min;a.DomUtil.setTransform(this._image,j,k)},_reset:function(){var k=this._image,j=new a.Bounds(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),i=j.getSize();a.DomUtil.setPosition(k,j.min);k.style.width=i.x+"px";k.style.height=i.y+"px"},_updateOpacity:function(){a.DomUtil.setOpacity(this._image,this.options.opacity)}});a.imageOverlay=function(j,k,i){return new a.ImageOverlay(j,k,i)};a.Icon=a.Class.extend({initialize:function(i){a.setOptions(this,i)},createIcon:function(i){return this._createIcon("icon",i)},createShadow:function(i){return this._createIcon("shadow",i)},_createIcon:function(j,k){var l=this._getIconUrl(j);if(!l){if(j==="icon"){throw new Error("iconUrl not set in Icon options (see the docs).")}return null}var i=this._createImg(l,k&&k.tagName==="IMG"?k:null);this._setIconStyles(i,j);return i},_setIconStyles:function(j,m){var l=this.options;var i=l[m+"Size"];if(typeof i==="number"){i=[i,i]}var o=a.point(i),k=a.point(m==="shadow"&&l.shadowAnchor||l.iconAnchor||o&&o.divideBy(2,true));j.className="leaflet-marker-"+m+" "+(l.className||"");if(k){j.style.marginLeft=(-k.x)+"px";j.style.marginTop=(-k.y)+"px"}if(o){j.style.width=o.x+"px";j.style.height=o.y+"px"}},_createImg:function(j,i){i=i||b.createElement("img");i.src=j;return i},_getIconUrl:function(i){return a.Browser.retina&&this.options[i+"RetinaUrl"]||this.options[i+"Url"]}});a.icon=function(i){return new a.Icon(i)};a.Icon.Default=a.Icon.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(i){if(!a.Icon.Default.imagePath){a.Icon.Default.imagePath=this._detectIconPath()}return(this.options.imagePath||a.Icon.Default.imagePath)+a.Icon.prototype._getIconUrl.call(this,i)},_detectIconPath:function(){var i=a.DomUtil.create("div","leaflet-default-icon-path",b.body);var j=a.DomUtil.getStyle(i,"background-image")||a.DomUtil.getStyle(i,"backgroundImage");b.body.removeChild(i);return j.indexOf("url")===0?j.replace(/^url\([\"\']?/,"").replace(/marker-icon\.png[\"\']?\)$/,""):""}});a.Marker=a.Layer.extend({options:{icon:new a.Icon.Default(),interactive:true,draggable:false,keyboard:true,title:"",alt:"",zIndexOffset:0,opacity:1,riseOnHover:false,riseOffset:250,pane:"markerPane",nonBubblingEvents:["click","dblclick","mouseover","mouseout","contextmenu"]},initialize:function(j,i){a.setOptions(this,i);this._latlng=a.latLng(j)},onAdd:function(i){this._zoomAnimated=this._zoomAnimated&&i.options.markerZoomAnimation;if(this._zoomAnimated){i.on("zoomanim",this._animateZoom,this)}this._initIcon();this.update()},onRemove:function(i){if(this.dragging&&this.dragging.enabled()){this.options.draggable=true;this.dragging.removeHooks()}if(this._zoomAnimated){i.off("zoomanim",this._animateZoom,this)}this._removeIcon();this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(j){var i=this._latlng;this._latlng=a.latLng(j);this.update();return this.fire("move",{oldLatLng:i,latlng:this._latlng})},setZIndexOffset:function(i){this.options.zIndexOffset=i;return this.update()},setIcon:function(i){this.options.icon=i;if(this._map){this._initIcon();this.update()}if(this._popup){this.bindPopup(this._popup,this._popup.options)}return this},getElement:function(){return this._icon},update:function(){if(this._icon){var i=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(i)}return this},_initIcon:function(){var j=this.options,l="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");var k=j.icon.createIcon(this._icon),m=false;if(k!==this._icon){if(this._icon){this._removeIcon()}m=true;if(j.title){k.title=j.title}if(j.alt){k.alt=j.alt}}a.DomUtil.addClass(k,l);if(j.keyboard){k.tabIndex="0"}this._icon=k;if(j.riseOnHover){this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex})}var i=j.icon.createShadow(this._shadow),o=false;if(i!==this._shadow){this._removeShadow();o=true}if(i){a.DomUtil.addClass(i,l);i.alt=""}this._shadow=i;if(j.opacity<1){this._updateOpacity()}if(m){this.getPane().appendChild(this._icon)}this._initInteraction();if(i&&o){this.getPane("shadowPane").appendChild(this._shadow)}},_removeIcon:function(){if(this.options.riseOnHover){this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex})}a.DomUtil.remove(this._icon);this.removeInteractiveTarget(this._icon);this._icon=null},_removeShadow:function(){if(this._shadow){a.DomUtil.remove(this._shadow)}this._shadow=null},_setPos:function(i){a.DomUtil.setPosition(this._icon,i);if(this._shadow){a.DomUtil.setPosition(this._shadow,i)}this._zIndex=i.y+this.options.zIndexOffset;this._resetZIndex()},_updateZIndex:function(i){this._icon.style.zIndex=this._zIndex+i},_animateZoom:function(i){var j=this._map._latLngToNewLayerPoint(this._latlng,i.zoom,i.center).round();this._setPos(j)},_initInteraction:function(){if(!this.options.interactive){return}a.DomUtil.addClass(this._icon,"leaflet-interactive");this.addInteractiveTarget(this._icon);if(a.Handler.MarkerDrag){var i=this.options.draggable;if(this.dragging){i=this.dragging.enabled();this.dragging.disable()}this.dragging=new a.Handler.MarkerDrag(this);if(i){this.dragging.enable()}}},setOpacity:function(i){this.options.opacity=i;if(this._map){this._updateOpacity()}return this},_updateOpacity:function(){var i=this.options.opacity;a.DomUtil.setOpacity(this._icon,i);if(this._shadow){a.DomUtil.setOpacity(this._shadow,i)}},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor||[0,0]},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor||[0,0]}});a.marker=function(j,i){return new a.Marker(j,i)};a.DivIcon=a.Icon.extend({options:{iconSize:[12,12],html:false,bgPos:null,className:"leaflet-div-icon"},createIcon:function(j){var l=(j&&j.tagName==="DIV")?j:b.createElement("div"),i=this.options;l.innerHTML=i.html!==false?i.html:"";if(i.bgPos){var k=a.point(i.bgPos);l.style.backgroundPosition=(-k.x)+"px "+(-k.y)+"px"}this._setIconStyles(l,"icon");return l},createShadow:function(){return null}});a.divIcon=function(i){return new a.DivIcon(i)};a.DivOverlay=a.Layer.extend({options:{offset:[0,7],className:"",pane:"popupPane"},initialize:function(i,j){a.setOptions(this,i);this._source=j},onAdd:function(i){this._zoomAnimated=i._zoomAnimated;if(!this._container){this._initLayout()}if(i._fadeAnimated){a.DomUtil.setOpacity(this._container,0)}clearTimeout(this._removeTimeout);this.getPane().appendChild(this._container);this.update();if(i._fadeAnimated){a.DomUtil.setOpacity(this._container,1)}this.bringToFront()},onRemove:function(i){if(i._fadeAnimated){a.DomUtil.setOpacity(this._container,0);this._removeTimeout=setTimeout(a.bind(a.DomUtil.remove,a.DomUtil,this._container),200)}else{a.DomUtil.remove(this._container)}},getLatLng:function(){return this._latlng},setLatLng:function(i){this._latlng=a.latLng(i);if(this._map){this._updatePosition();this._adjustPan()}return this},getContent:function(){return this._content},setContent:function(i){this._content=i;this.update();return this},getElement:function(){return this._container},update:function(){if(!this._map){return}this._container.style.visibility="hidden";this._updateContent();this._updateLayout();this._updatePosition();this._container.style.visibility="";this._adjustPan()},getEvents:function(){var i={zoom:this._updatePosition,viewreset:this._updatePosition};if(this._zoomAnimated){i.zoomanim=this._animateZoom}return i},isOpen:function(){return !!this._map&&this._map.hasLayer(this)},bringToFront:function(){if(this._map){a.DomUtil.toFront(this._container)}return this},bringToBack:function(){if(this._map){a.DomUtil.toBack(this._container)}return this},_updateContent:function(){if(!this._content){return}var j=this._contentNode;var i=(typeof this._content==="function")?this._content(this._source||this):this._content;if(typeof i==="string"){j.innerHTML=i}else{while(j.hasChildNodes()){j.removeChild(j.firstChild)}j.appendChild(i)}this.fire("contentupdate")},_updatePosition:function(){if(!this._map){return}var m=this._map.latLngToLayerPoint(this._latlng),l=a.point(this.options.offset),j=this._getAnchor();if(this._zoomAnimated){a.DomUtil.setPosition(this._container,m.add(j))}else{l=l.add(m).add(j)}var i=this._containerBottom=-l.y,k=this._containerLeft=-Math.round(this._containerWidth/2)+l.x;this._container.style.bottom=i+"px";this._container.style.left=k+"px"},_getAnchor:function(){return[0,0]}});a.Popup=a.DivOverlay.extend({options:{maxWidth:300,minWidth:50,maxHeight:null,autoPan:true,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:false,closeButton:true,autoClose:true,className:""},openOn:function(i){i.openPopup(this);return this},onAdd:function(i){a.DivOverlay.prototype.onAdd.call(this,i);i.fire("popupopen",{popup:this});if(this._source){this._source.fire("popupopen",{popup:this},true);if(!(this._source instanceof a.Path)){this._source.on("preclick",a.DomEvent.stopPropagation)}}},onRemove:function(i){a.DivOverlay.prototype.onRemove.call(this,i);i.fire("popupclose",{popup:this});if(this._source){this._source.fire("popupclose",{popup:this},true);if(!(this._source instanceof a.Path)){this._source.off("preclick",a.DomEvent.stopPropagation)}}},getEvents:function(){var i=a.DivOverlay.prototype.getEvents.call(this);if("closeOnClick" in this.options?this.options.closeOnClick:this._map.options.closePopupOnClick){i.preclick=this._close}if(this.options.keepInView){i.moveend=this._adjustPan}return i},_close:function(){if(this._map){this._map.closePopup(this)}},_initLayout:function(){var k="leaflet-popup",i=this._container=a.DomUtil.create("div",k+" "+(this.options.className||"")+" leaflet-zoom-animated");if(this.options.closeButton){var j=this._closeButton=a.DomUtil.create("a",k+"-close-button",i);j.href="#close";j.innerHTML="&#215;";a.DomEvent.on(j,"click",this._onCloseButtonClick,this)}var l=this._wrapper=a.DomUtil.create("div",k+"-content-wrapper",i);this._contentNode=a.DomUtil.create("div",k+"-content",l);a.DomEvent.disableClickPropagation(l).disableScrollPropagation(this._contentNode).on(l,"contextmenu",a.DomEvent.stopPropagation);this._tipContainer=a.DomUtil.create("div",k+"-tip-container",i);this._tip=a.DomUtil.create("div",k+"-tip",this._tipContainer)},_updateLayout:function(){var j=this._contentNode,l=j.style;l.width="";l.whiteSpace="nowrap";var k=j.offsetWidth;k=Math.min(k,this.options.maxWidth);k=Math.max(k,this.options.minWidth);l.width=(k+1)+"px";l.whiteSpace="";l.height="";var i=j.offsetHeight,m=this.options.maxHeight,o="leaflet-popup-scrolled";if(m&&i>m){l.height=m+"px";a.DomUtil.addClass(j,o)}else{a.DomUtil.removeClass(j,o)}this._containerWidth=this._container.offsetWidth},_animateZoom:function(j){var k=this._map._latLngToNewLayerPoint(this._latlng,j.zoom,j.center),i=this._getAnchor();a.DomUtil.setPosition(this._container,k.add(i))},_adjustPan:function(){if(!this.options.autoPan||(this._map._panAnim&&this._map._panAnim._inProgress)){return}var j=this._map,m=parseInt(a.DomUtil.getStyle(this._container,"marginBottom"),10)||0,u=this._container.offsetHeight+m,q=this._containerWidth,o=new a.Point(this._containerLeft,-u-this._containerBottom);o._add(a.DomUtil.getPosition(this._container));var l=j.layerPointToContainerPoint(o),p=a.point(this.options.autoPanPadding),k=a.point(this.options.autoPanPaddingTopLeft||p),i=a.point(this.options.autoPanPaddingBottomRight||p),t=j.getSize(),s=0,r=0;if(l.x+q+i.x>t.x){s=l.x+q-t.x+i.x}if(l.x-s-k.x<0){s=l.x-k.x}if(l.y+u+i.y>t.y){r=l.y+u-t.y+i.y}if(l.y-r-k.y<0){r=l.y-k.y}if(s||r){j.fire("autopanstart").panBy([s,r])}},_onCloseButtonClick:function(i){this._close();a.DomEvent.stop(i)},_getAnchor:function(){return a.point(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}});a.popup=function(i,j){return new a.Popup(i,j)};a.Map.mergeOptions({closePopupOnClick:true});a.Map.include({openPopup:function(i,k,j){if(!(i instanceof a.Popup)){i=new a.Popup(j).setContent(i)}if(k){i.setLatLng(k)}if(this.hasLayer(i)){return this}if(this._popup&&this._popup.options.autoClose){this.closePopup()}this._popup=i;return this.addLayer(i)},closePopup:function(i){if(!i||i===this._popup){i=this._popup;this._popup=null}if(i){this.removeLayer(i)}return this}});a.Layer.include({bindPopup:function(j,i){if(j instanceof a.Popup){a.setOptions(j,i);this._popup=j;j._source=this}else{if(!this._popup||i){this._popup=new a.Popup(i,this)}this._popup.setContent(j)}if(!this._popupHandlersAdded){this.on({click:this._openPopup,remove:this.closePopup,move:this._movePopup});this._popupHandlersAdded=true}return this},unbindPopup:function(){if(this._popup){this.off({click:this._openPopup,remove:this.closePopup,move:this._movePopup});this._popupHandlersAdded=false;this._popup=null}return this},openPopup:function(i,k){if(!(i instanceof a.Layer)){k=i;i=this}if(i instanceof a.FeatureGroup){for(var j in this._layers){i=this._layers[j];break}}if(!k){k=i.getCenter?i.getCenter():i.getLatLng()}if(this._popup&&this._map){this._popup._source=i;this._popup.update();this._map.openPopup(this._popup,k)}return this},closePopup:function(){if(this._popup){this._popup._close()}return this},togglePopup:function(i){if(this._popup){if(this._popup._map){this.closePopup()}else{this.openPopup(i)}}return this},isPopupOpen:function(){return(this._popup?this._popup.isOpen():false)},setPopupContent:function(i){if(this._popup){this._popup.setContent(i)}return this},getPopup:function(){return this._popup},_openPopup:function(j){var i=j.layer||j.target;if(!this._popup){return}if(!this._map){return}a.DomEvent.stop(j);if(i instanceof a.Path){this.openPopup(j.layer||j.target,j.latlng);return}if(this._map.hasLayer(this._popup)&&this._popup._source===i){this.closePopup()}else{this.openPopup(i,j.latlng)}},_movePopup:function(i){this._popup.setLatLng(i.latlng)}});a.Tooltip=a.DivOverlay.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:false,sticky:false,interactive:false,opacity:0.9},onAdd:function(i){a.DivOverlay.prototype.onAdd.call(this,i);this.setOpacity(this.options.opacity);i.fire("tooltipopen",{tooltip:this});if(this._source){this._source.fire("tooltipopen",{tooltip:this},true)}},onRemove:function(i){a.DivOverlay.prototype.onRemove.call(this,i);i.fire("tooltipclose",{tooltip:this});if(this._source){this._source.fire("tooltipclose",{tooltip:this},true)}},getEvents:function(){var i=a.DivOverlay.prototype.getEvents.call(this);if(a.Browser.touch&&!this.options.permanent){i.preclick=this._close}return i},_close:function(){if(this._map){this._map.closeTooltip(this)}},_initLayout:function(){var j="leaflet-tooltip",i=j+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=a.DomUtil.create("div",i)},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(q){var i=this._map,j=this._container,p=i.latLngToContainerPoint(i.getCenter()),k=i.layerPointToContainerPoint(q),r=this.options.direction,o=j.offsetWidth,s=j.offsetHeight,l=a.point(this.options.offset),m=this._getAnchor();if(r==="top"){q=q.add(a.point(-o/2+l.x,-s+l.y+m.y,true))}else{if(r==="bottom"){q=q.subtract(a.point(o/2-l.x,-l.y,true))}else{if(r==="center"){q=q.subtract(a.point(o/2+l.x,s/2-m.y+l.y,true))}else{if(r==="right"||r==="auto"&&k.x<p.x){r="right";q=q.add(a.point(l.x+m.x,m.y-s/2+l.y,true))}else{r="left";q=q.subtract(a.point(o+m.x-l.x,s/2-m.y-l.y,true))}}}}a.DomUtil.removeClass(j,"leaflet-tooltip-right");a.DomUtil.removeClass(j,"leaflet-tooltip-left");a.DomUtil.removeClass(j,"leaflet-tooltip-top");a.DomUtil.removeClass(j,"leaflet-tooltip-bottom");a.DomUtil.addClass(j,"leaflet-tooltip-"+r);a.DomUtil.setPosition(j,q)},_updatePosition:function(){var i=this._map.latLngToLayerPoint(this._latlng);this._setPosition(i)},setOpacity:function(i){this.options.opacity=i;if(this._container){a.DomUtil.setOpacity(this._container,i)}},_animateZoom:function(i){var j=this._map._latLngToNewLayerPoint(this._latlng,i.zoom,i.center);this._setPosition(j)},_getAnchor:function(){return a.point(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}});a.tooltip=function(i,j){return new a.Tooltip(i,j)};a.Map.include({openTooltip:function(j,k,i){if(!(j instanceof a.Tooltip)){j=new a.Tooltip(i).setContent(j)}if(k){j.setLatLng(k)}if(this.hasLayer(j)){return this}return this.addLayer(j)},closeTooltip:function(i){if(i){this.removeLayer(i)}return this}});a.Layer.include({bindTooltip:function(j,i){if(j instanceof a.Tooltip){a.setOptions(j,i);this._tooltip=j;j._source=this}else{if(!this._tooltip||i){this._tooltip=a.tooltip(i,this)}this._tooltip.setContent(j)}this._initTooltipInteractions();if(this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)){this.openTooltip()}return this},unbindTooltip:function(){if(this._tooltip){this._initTooltipInteractions(true);this.closeTooltip();this._tooltip=null}return this},_initTooltipInteractions:function(j){if(!j&&this._tooltipHandlersAdded){return}var i=j?"off":"on",k={remove:this.closeTooltip,move:this._moveTooltip};if(!this._tooltip.options.permanent){k.mouseover=this._openTooltip;k.mouseout=this.closeTooltip;if(this._tooltip.options.sticky){k.mousemove=this._moveTooltip}if(a.Browser.touch){k.click=this._openTooltip}}else{k.add=this._openTooltip}this[i](k);this._tooltipHandlersAdded=!j},openTooltip:function(i,k){if(!(i instanceof a.Layer)){k=i;i=this}if(i instanceof a.FeatureGroup){for(var j in this._layers){i=this._layers[j];break}}if(!k){k=i.getCenter?i.getCenter():i.getLatLng()}if(this._tooltip&&this._map){this._tooltip._source=i;this._tooltip.update();this._map.openTooltip(this._tooltip,k);if(this._tooltip.options.interactive&&this._tooltip._container){a.DomUtil.addClass(this._tooltip._container,"leaflet-clickable");this.addInteractiveTarget(this._tooltip._container)}}return this},closeTooltip:function(){if(this._tooltip){this._tooltip._close();if(this._tooltip.options.interactive&&this._tooltip._container){a.DomUtil.removeClass(this._tooltip._container,"leaflet-clickable");this.removeInteractiveTarget(this._tooltip._container)}}return this},toggleTooltip:function(i){if(this._tooltip){if(this._tooltip._map){this.closeTooltip()}else{this.openTooltip(i)}}return this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(i){if(this._tooltip){this._tooltip.setContent(i)}return this},getTooltip:function(){return this._tooltip},_openTooltip:function(j){var i=j.layer||j.target;if(!this._tooltip||!this._map){return}this.openTooltip(i,this._tooltip.options.sticky?j.latlng:h)},_moveTooltip:function(k){var l=k.latlng,j,i;if(this._tooltip.options.sticky&&k.originalEvent){j=this._map.mouseEventToContainerPoint(k.originalEvent);i=this._map.containerPointToLayerPoint(j);l=this._map.layerPointToLatLng(i)}this._tooltip.setLatLng(l)}});a.LayerGroup=a.Layer.extend({initialize:function(l){this._layers={};var k,j;if(l){for(k=0,j=l.length;k<j;k++){this.addLayer(l[k])}}},addLayer:function(i){var j=this.getLayerId(i);this._layers[j]=i;if(this._map){this._map.addLayer(i)}return this},removeLayer:function(i){var j=i in this._layers?i:this.getLayerId(i);if(this._map&&this._layers[j]){this._map.removeLayer(this._layers[j])}delete this._layers[j];return this},hasLayer:function(i){return !!i&&(i in this._layers||this.getLayerId(i) in this._layers)},clearLayers:function(){for(var j in this._layers){this.removeLayer(this._layers[j])}return this},invoke:function(j){var k=Array.prototype.slice.call(arguments,1),m,l;for(m in this._layers){l=this._layers[m];if(l[j]){l[j].apply(l,k)}}return this},onAdd:function(k){for(var j in this._layers){k.addLayer(this._layers[j])}},onRemove:function(k){for(var j in this._layers){k.removeLayer(this._layers[j])}},eachLayer:function(l,k){for(var j in this._layers){l.call(k,this._layers[j])}return this},getLayer:function(i){return this._layers[i]},getLayers:function(){var k=[];for(var j in this._layers){k.push(this._layers[j])}return k},setZIndex:function(i){return this.invoke("setZIndex",i)},getLayerId:function(i){return a.stamp(i)}});a.layerGroup=function(i){return new a.LayerGroup(i)};a.FeatureGroup=a.LayerGroup.extend({addLayer:function(i){if(this.hasLayer(i)){return this}i.addEventParent(this);a.LayerGroup.prototype.addLayer.call(this,i);return this.fire("layeradd",{layer:i})},removeLayer:function(i){if(!this.hasLayer(i)){return this}if(i in this._layers){i=this._layers[i]}i.removeEventParent(this);a.LayerGroup.prototype.removeLayer.call(this,i);return this.fire("layerremove",{layer:i})},setStyle:function(i){return this.invoke("setStyle",i)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var j=new a.LatLngBounds();for(var k in this._layers){var i=this._layers[k];j.extend(i.getBounds?i.getBounds():i.getLatLng())}return j}});a.featureGroup=function(i){return new a.FeatureGroup(i)};a.Renderer=a.Layer.extend({options:{padding:0.1},initialize:function(i){a.setOptions(this,i);a.stamp(this);this._layers=this._layers||{}},onAdd:function(){if(!this._container){this._initContainer();if(this._zoomAnimated){a.DomUtil.addClass(this._container,"leaflet-zoom-animated")}}this.getPane().appendChild(this._container);this._update();this.on("update",this._updatePaths,this)},onRemove:function(){a.DomUtil.remove(this._container);this.off("update",this._updatePaths,this)},getEvents:function(){var i={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};if(this._zoomAnimated){i.zoomanim=this._onAnimZoom}return i},_onAnimZoom:function(i){this._updateTransform(i.center,i.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(i,r){var l=this._map.getZoomScale(r,this._zoom),o=a.DomUtil.getPosition(this._container),p=this._map.getSize().multiplyBy(0.5+this.options.padding),j=this._map.project(this._center,r),m=this._map.project(i,r),q=m.subtract(j),k=p.multiplyBy(-l).add(o).add(p).subtract(q);if(a.Browser.any3d){a.DomUtil.setTransform(this._container,k,l)}else{a.DomUtil.setPosition(this._container,k)}},_reset:function(){this._update();this._updateTransform(this._center,this._zoom);for(var i in this._layers){this._layers[i]._reset()}},_onZoomEnd:function(){for(var i in this._layers){this._layers[i]._project()}},_updatePaths:function(){for(var i in this._layers){this._layers[i]._update()}},_update:function(){var k=this.options.padding,j=this._map.getSize(),i=this._map.containerPointToLayerPoint(j.multiplyBy(-k)).round();this._bounds=new a.Bounds(i,i.add(j.multiplyBy(1+k*2)).round());this._center=this._map.getCenter();this._zoom=this._map.getZoom()}});a.Map.include({getRenderer:function(i){var j=i.options.renderer||this._getPaneRenderer(i.options.pane)||this.options.renderer||this._renderer;if(!j){j=this._renderer=(this.options.preferCanvas&&a.canvas())||a.svg()}if(!this.hasLayer(j)){this.addLayer(j)}return j},_getPaneRenderer:function(i){if(i==="overlayPane"||i===h){return false}var j=this._paneRenderers[i];if(j===h){j=(a.SVG&&a.svg({pane:i}))||(a.Canvas&&a.canvas({pane:i}));this._paneRenderers[i]=j}return j}});a.Path=a.Layer.extend({options:{stroke:true,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:false,fillColor:null,fillOpacity:0.2,fillRule:"evenodd",interactive:true},beforeAdd:function(i){this._renderer=i.getRenderer(this)},onAdd:function(){this._renderer._initPath(this);this._reset();this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){if(this._map){this._renderer._updatePath(this)}return this},setStyle:function(i){a.setOptions(this,i);if(this._renderer){this._renderer._updateStyle(this)}return this},bringToFront:function(){if(this._renderer){this._renderer._bringToFront(this)}return this},bringToBack:function(){if(this._renderer){this._renderer._bringToBack(this)}return this},getElement:function(){return this._path},_reset:function(){this._project();this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(a.Browser.touch?10:0)}});a.LineUtil={simplify:function(k,i){if(!i||!k.length){return k.slice()}var j=i*i;k=this._reducePoints(k,j);k=this._simplifyDP(k,j);return k},pointToSegmentDistance:function(j,k,i){return Math.sqrt(this._sqClosestPointOnSegment(j,k,i,true))},closestPointOnSegment:function(j,k,i){return this._sqClosestPointOnSegment(j,k,i)},_simplifyDP:function(o,k){var j=o.length,m=typeof Uint8Array!==h+""?Uint8Array:Array,q=new m(j);q[0]=q[j-1]=1;this._simplifyDPStep(o,q,k,0,j-1);var l,p=[];for(l=0;l<j;l++){if(q[l]){p.push(o[l])}}return p},_simplifyDPStep:function(s,k,j,p,r){var l=0,q,m,o;for(m=p+1;m<=r-1;m++){o=this._sqClosestPointOnSegment(s[m],s[p],s[r],true);if(o>l){q=m;l=o}}if(l>j){k[q]=1;this._simplifyDPStep(s,k,j,p,q);this._simplifyDPStep(s,k,j,q,r)}},_reducePoints:function(m,k){var p=[m[0]];for(var l=1,o=0,j=m.length;l<j;l++){if(this._sqDist(m[l],m[o])>k){p.push(m[l]);o=l}}if(o<j-1){p.push(m[j-1])}return p},clipSegment:function(r,q,i,s,t){var m=s?this._lastCode:this._getBitCode(r,i),k=this._getBitCode(q,i),l,j,o;this._lastCode=k;while(true){if(!(m|k)){return[r,q]}if(m&k){return false}l=m||k;j=this._getEdgeIntersection(r,q,l,i,t);o=this._getBitCode(j,i);if(l===m){r=j;m=o}else{q=j;k=o}}},_getEdgeIntersection:function(q,o,j,i,r){var t=o.x-q.x,s=o.y-q.y,k=i.min,m=i.max,p,l;if(j&8){p=q.x+t*(m.y-q.y)/s;l=m.y}else{if(j&4){p=q.x+t*(k.y-q.y)/s;l=k.y}else{if(j&2){p=m.x;l=q.y+s*(m.x-q.x)/t}else{if(j&1){p=k.x;l=q.y+s*(k.x-q.x)/t}}}}return new a.Point(p,l,r)},_getBitCode:function(k,j){var i=0;if(k.x<j.min.x){i|=1}else{if(k.x>j.max.x){i|=2}}if(k.y<j.min.y){i|=4}else{if(k.y>j.max.y){i|=8}}return i},_sqDist:function(l,k){var j=k.x-l.x,i=k.y-l.y;return j*j+i*i},_sqClosestPointOnSegment:function(j,q,o,k){var m=q.x,l=q.y,u=o.x-m,s=o.y-l,i=u*u+s*s,r;if(i>0){r=((j.x-m)*u+(j.y-l)*s)/i;if(r>1){m=o.x;l=o.y}else{if(r>0){m+=u*r;l+=s*r}}}u=j.x-m;s=j.y-l;return k?u*u+s*s:new a.Point(m,l)}};a.Polyline=a.Path.extend({options:{smoothFactor:1,noClip:false},initialize:function(i,j){a.setOptions(this,j);this._setLatLngs(i)},getLatLngs:function(){return this._latlngs},setLatLngs:function(i){this._setLatLngs(i);return this.redraw()},isEmpty:function(){return !this._latlngs.length},closestLayerPoint:function(k){var u=Infinity,s=null,l=a.LineUtil._sqClosestPointOnSegment,w,v;for(var m=0,x=this._parts.length;m<x;m++){var t=this._parts[m];for(var o=1,r=t.length;o<r;o++){w=t[o-1];v=t[o];var q=l(k,w,v,true);if(q<u){u=q;s=l(k,w,v)}}}if(s){s.distance=Math.sqrt(u)}return s},getCenter:function(){if(!this._map){throw new Error("Must add layer to map before using getCenter()")}var l,j,k,p,s,q,o,r=this._rings[0],m=r.length;if(!m){return null}for(l=0,j=0;l<m-1;l++){j+=r[l].distanceTo(r[l+1])/2}if(j===0){return this._map.layerPointToLatLng(r[0])}for(l=0,p=0;l<m-1;l++){s=r[l];q=r[l+1];k=s.distanceTo(q);p+=k;if(p>j){o=(p-j)/k;return this._map.layerPointToLatLng([q.x-o*(q.x-s.x),q.y-o*(q.y-s.y)])}}},getBounds:function(){return this._bounds},addLatLng:function(j,i){i=i||this._defaultShape();j=a.latLng(j);i.push(j);this._bounds.extend(j);return this.redraw()},_setLatLngs:function(i){this._bounds=new a.LatLngBounds();this._latlngs=this._convertLatLngs(i)},_defaultShape:function(){return a.Polyline._flat(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(l){var k=[],o=a.Polyline._flat(l);for(var m=0,j=l.length;m<j;m++){if(o){k[m]=a.latLng(l[m]);this._bounds.extend(k[m])}else{k[m]=this._convertLatLngs(l[m])}}return k},_project:function(){var j=new a.Bounds();this._rings=[];this._projectLatlngs(this._latlngs,this._rings,j);var i=this._clickTolerance(),k=new a.Point(i,i);if(this._bounds.isValid()&&j.isValid()){j.min._subtract(k);j.max._add(k);this._pxBounds=j}},_projectLatlngs:function(l,k,p){var q=l[0] instanceof a.LatLng,j=l.length,o,m;if(q){m=[];for(o=0;o<j;o++){m[o]=this._map.latLngToLayerPoint(l[o]);p.extend(m[o])}k.push(m)}else{for(o=0;o<j;o++){this._projectLatlngs(l[o],k,p)}}},_clipPoints:function(){var l=this._renderer._bounds;this._parts=[];if(!this._pxBounds||!this._pxBounds.intersects(l)){return}if(this.options.noClip){this._parts=this._rings;return}var p=this._parts,r,q,m,t,o,s,u;for(r=0,m=0,t=this._rings.length;r<t;r++){u=this._rings[r];for(q=0,o=u.length;q<o-1;q++){s=a.LineUtil.clipSegment(u[q],u[q+1],l,q,true);if(!s){continue}p[m]=p[m]||[];p[m].push(s[0]);if((s[1]!==u[q+1])||(q===o-2)){p[m].push(s[1]);m++}}}},_simplifyPoints:function(){var m=this._parts,k=this.options.smoothFactor;for(var l=0,j=m.length;l<j;l++){m[l]=a.LineUtil.simplify(m[l],k)}},_update:function(){if(!this._map){return}this._clipPoints();this._simplifyPoints();this._updatePath()},_updatePath:function(){this._renderer._updatePoly(this)}});a.polyline=function(i,j){return new a.Polyline(i,j)};a.Polyline._flat=function(i){return !a.Util.isArray(i[0])||(typeof i[0][0]!=="object"&&typeof i[0][0]!=="undefined")};a.PolyUtil={};a.PolyUtil.clipPolygon=function(z,l,A){var w,t=[1,4,2,8],u,s,r,y,x,v,o,m,q=a.LineUtil;for(u=0,v=z.length;u<v;u++){z[u]._code=q._getBitCode(z[u],l)}for(r=0;r<4;r++){o=t[r];w=[];for(u=0,v=z.length,s=v-1;u<v;s=u++){y=z[u];x=z[s];if(!(y._code&o)){if(x._code&o){m=q._getEdgeIntersection(x,y,o,l,A);m._code=q._getBitCode(m,l);w.push(m)}w.push(y)}else{if(!(x._code&o)){m=q._getEdgeIntersection(x,y,o,l,A);m._code=q._getBitCode(m,l);w.push(m)}}}z=w}return z};a.Polygon=a.Polyline.extend({options:{fill:true},isEmpty:function(){return !this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map){throw new Error("Must add layer to map before using getCenter()")}var o,m,v,u,q,l,s,r,k,t=this._rings[0],p=t.length;if(!p){return null}l=s=r=0;for(o=0,m=p-1;o<p;m=o++){v=t[o];u=t[m];q=v.y*u.x-u.y*v.x;s+=(v.x+u.x)*q;r+=(v.y+u.y)*q;l+=q*3}if(l===0){k=t[0]}else{k=[s/l,r/l]}return this._map.layerPointToLatLng(k)},_convertLatLngs:function(k){var j=a.Polyline.prototype._convertLatLngs.call(this,k),i=j.length;if(i>=2&&j[0] instanceof a.LatLng&&j[0].equals(j[i-1])){j.pop()}return j},_setLatLngs:function(i){a.Polyline.prototype._setLatLngs.call(this,i);if(a.Polyline._flat(this._latlngs)){this._latlngs=[this._latlngs]}},_defaultShape:function(){return a.Polyline._flat(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var o=this._renderer._bounds,l=this.options.weight,q=new a.Point(l,l);o=new a.Bounds(o.min.subtract(q),o.max.add(q));this._parts=[];if(!this._pxBounds||!this._pxBounds.intersects(o)){return}if(this.options.noClip){this._parts=this._rings;return}for(var m=0,k=this._rings.length,j;m<k;m++){j=a.PolyUtil.clipPolygon(this._rings[m],o,true);if(j.length){this._parts.push(j)}}},_updatePath:function(){this._renderer._updatePoly(this,true)}});a.polygon=function(i,j){return new a.Polygon(i,j)};a.Rectangle=a.Polygon.extend({initialize:function(j,i){a.Polygon.prototype.initialize.call(this,this._boundsToLatLngs(j),i)},setBounds:function(i){return this.setLatLngs(this._boundsToLatLngs(i))},_boundsToLatLngs:function(i){i=a.latLngBounds(i);return[i.getSouthWest(),i.getNorthWest(),i.getNorthEast(),i.getSouthEast()]}});a.rectangle=function(j,i){return new a.Rectangle(j,i)};a.CircleMarker=a.Path.extend({options:{fill:true,radius:10},initialize:function(j,i){a.setOptions(this,i);this._latlng=a.latLng(j);this._radius=this.options.radius},setLatLng:function(i){this._latlng=a.latLng(i);this.redraw();return this.fire("move",{latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(i){this.options.radius=this._radius=i;return this.redraw()},getRadius:function(){return this._radius},setStyle:function(j){var i=j&&j.radius||this._radius;a.Path.prototype.setStyle.call(this,j);this.setRadius(i);return this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng);this._updateBounds()},_updateBounds:function(){var k=this._radius,j=this._radiusY||k,i=this._clickTolerance(),l=[k+i,j+i];this._pxBounds=new a.Bounds(this._point.subtract(l),this._point.add(l))},_update:function(){if(this._map){this._updatePath()}},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)}});a.circleMarker=function(j,i){return new a.CircleMarker(j,i)};a.Circle=a.CircleMarker.extend({initialize:function(k,j,i){if(typeof j==="number"){j=a.extend({},i,{radius:j})}a.setOptions(this,j);this._latlng=a.latLng(k);if(isNaN(this.options.radius)){throw new Error("Circle radius cannot be NaN")}this._mRadius=this.options.radius},setRadius:function(i){this._mRadius=i;return this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var i=[this._radius,this._radiusY||this._radius];return new a.LatLngBounds(this._map.layerPointToLatLng(this._point.subtract(i)),this._map.layerPointToLatLng(this._point.add(i)))},setStyle:a.Path.prototype.setStyle,_project:function(){var s=this._latlng.lng,q=this._latlng.lat,j=this._map,u=j.options.crs;if(u.distance===a.CRS.Earth.distance){var o=Math.PI/180,v=(this._mRadius/a.CRS.Earth.R)/o,r=j.project([q+v,s]),i=j.project([q-v,s]),k=r.add(i).divideBy(2),m=j.unproject(k).lat,l=Math.acos((Math.cos(v*o)-Math.sin(q*o)*Math.sin(m*o))/(Math.cos(q*o)*Math.cos(m*o)))/o;if(isNaN(l)||l===0){l=v/Math.cos(Math.PI/180*q)}this._point=k.subtract(j.getPixelOrigin());this._radius=isNaN(l)?0:Math.max(Math.round(k.x-j.project([m,s-l]).x),1);this._radiusY=Math.max(Math.round(k.y-r.y),1)}else{var t=u.unproject(u.project(this._latlng).subtract([this._mRadius,0]));this._point=j.latLngToLayerPoint(this._latlng);this._radius=this._point.x-j.latLngToLayerPoint(t).x}this._updateBounds()}});a.circle=function(k,j,i){return new a.Circle(k,j,i)};a.SVG=a.Renderer.extend({getEvents:function(){var i=a.Renderer.prototype.getEvents.call(this);i.zoomstart=this._onZoomStart;return i},_initContainer:function(){this._container=a.SVG.create("svg");this._container.setAttribute("pointer-events","none");this._rootGroup=a.SVG.create("g");this._container.appendChild(this._rootGroup)},_onZoomStart:function(){this._update()},_update:function(){if(this._map._animatingZoom&&this._bounds){return}a.Renderer.prototype._update.call(this);var i=this._bounds,k=i.getSize(),j=this._container;if(!this._svgSize||!this._svgSize.equals(k)){this._svgSize=k;j.setAttribute("width",k.x);j.setAttribute("height",k.y)}a.DomUtil.setPosition(j,i.min);j.setAttribute("viewBox",[i.min.x,i.min.y,k.x,k.y].join(" "));this.fire("update")},_initPath:function(i){var j=i._path=a.SVG.create("path");if(i.options.className){a.DomUtil.addClass(j,i.options.className)}if(i.options.interactive){a.DomUtil.addClass(j,"leaflet-interactive")}this._updateStyle(i);this._layers[a.stamp(i)]=i},_addPath:function(i){this._rootGroup.appendChild(i._path);i.addInteractiveTarget(i._path)},_removePath:function(i){a.DomUtil.remove(i._path);i.removeInteractiveTarget(i._path);delete this._layers[a.stamp(i)]},_updatePath:function(i){i._project();i._update()},_updateStyle:function(j){var k=j._path,i=j.options;if(!k){return}if(i.stroke){k.setAttribute("stroke",i.color);k.setAttribute("stroke-opacity",i.opacity);k.setAttribute("stroke-width",i.weight);k.setAttribute("stroke-linecap",i.lineCap);k.setAttribute("stroke-linejoin",i.lineJoin);if(i.dashArray){k.setAttribute("stroke-dasharray",i.dashArray)}else{k.removeAttribute("stroke-dasharray")}if(i.dashOffset){k.setAttribute("stroke-dashoffset",i.dashOffset)}else{k.removeAttribute("stroke-dashoffset")}}else{k.setAttribute("stroke","none")}if(i.fill){k.setAttribute("fill",i.fillColor||i.color);k.setAttribute("fill-opacity",i.fillOpacity);k.setAttribute("fill-rule",i.fillRule||"evenodd")}else{k.setAttribute("fill","none")}},_updatePoly:function(j,i){this._setPath(j,a.SVG.pointsToPath(j._parts,i))},_updateCircle:function(k){var m=k._point,l=k._radius,i=k._radiusY||l,j="a"+l+","+i+" 0 1,0 ";var o=k._empty()?"M0 0":"M"+(m.x-l)+","+m.y+j+(l*2)+",0 "+j+(-l*2)+",0 ";this._setPath(k,o)},_setPath:function(i,j){i._path.setAttribute("d",j)},_bringToFront:function(i){a.DomUtil.toFront(i._path)},_bringToBack:function(i){a.DomUtil.toBack(i._path)}});a.extend(a.SVG,{create:function(i){return b.createElementNS("http://www.w3.org/2000/svg",i)},pointsToPath:function(t,q){var s="",o,m,r,l,u,k;for(o=0,r=t.length;o<r;o++){u=t[o];for(m=0,l=u.length;m<l;m++){k=u[m];s+=(m?"L":"M")+k.x+" "+k.y}s+=q?(a.Browser.svg?"z":"x"):""}return s||"M0 0"}});a.Browser.svg=!!(b.createElementNS&&a.SVG.create("svg").createSVGRect);a.svg=function(i){return a.Browser.svg||a.Browser.vml?new a.SVG(i):null};a.Browser.vml=!a.Browser.svg&&(function(){try{var k=b.createElement("div");k.innerHTML='<v:shape adj="1"/>';var i=k.firstChild;i.style.behavior="url(#default#VML)";return i&&(typeof i.adj==="object")}catch(j){return false}}());a.SVG.include(!a.Browser.vml?{}:{_initContainer:function(){this._container=a.DomUtil.create("div","leaflet-vml-container")},_update:function(){if(this._map._animatingZoom){return}a.Renderer.prototype._update.call(this);this.fire("update")},_initPath:function(j){var i=j._container=a.SVG.create("shape");a.DomUtil.addClass(i,"leaflet-vml-shape "+(this.options.className||""));i.coordsize="1 1";j._path=a.SVG.create("path");i.appendChild(j._path);this._updateStyle(j);this._layers[a.stamp(j)]=j},_addPath:function(j){var i=j._container;this._container.appendChild(i);if(j.options.interactive){j.addInteractiveTarget(i)}},_removePath:function(j){var i=j._container;a.DomUtil.remove(i);j.removeInteractiveTarget(i);delete this._layers[a.stamp(j)]},_updateStyle:function(k){var m=k._stroke,l=k._fill,j=k.options,i=k._container;i.stroked=!!j.stroke;i.filled=!!j.fill;if(j.stroke){if(!m){m=k._stroke=a.SVG.create("stroke")}i.appendChild(m);m.weight=j.weight+"px";m.color=j.color;m.opacity=j.opacity;if(j.dashArray){m.dashStyle=a.Util.isArray(j.dashArray)?j.dashArray.join(" "):j.dashArray.replace(/( *, *)/g," ")}else{m.dashStyle=""}m.endcap=j.lineCap.replace("butt","flat");m.joinstyle=j.lineJoin}else{if(m){i.removeChild(m);k._stroke=null}}if(j.fill){if(!l){l=k._fill=a.SVG.create("fill")}i.appendChild(l);l.color=j.fillColor||j.color;l.opacity=j.fillOpacity}else{if(l){i.removeChild(l);k._fill=null}}},_updateCircle:function(j){var l=j._point.round(),k=Math.round(j._radius),i=Math.round(j._radiusY||k);this._setPath(j,j._empty()?"M0 0":"AL "+l.x+","+l.y+" "+k+","+i+" 0,"+(65535*360))},_setPath:function(i,j){i._path.v=j},_bringToFront:function(i){a.DomUtil.toFront(i._container)},_bringToBack:function(i){a.DomUtil.toBack(i._container)}});if(a.Browser.vml){a.SVG.create=(function(){try{b.namespaces.add("lvml","urn:schemas-microsoft-com:vml");return function(j){return b.createElement("<lvml:"+j+' class="lvml">')}}catch(i){return function(j){return b.createElement("<"+j+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}})()}a.Canvas=a.Renderer.extend({getEvents:function(){var i=a.Renderer.prototype.getEvents.call(this);i.viewprereset=this._onViewPreReset;return i},_onViewPreReset:function(){this._postponeUpdatePaths=true},onAdd:function(){a.Renderer.prototype.onAdd.call(this);this._draw()},_initContainer:function(){var i=this._container=b.createElement("canvas");a.DomEvent.on(i,"mousemove",a.Util.throttle(this._onMouseMove,32,this),this).on(i,"click dblclick mousedown mouseup contextmenu",this._onClick,this).on(i,"mouseout",this._handleMouseOut,this);this._ctx=i.getContext("2d")},_updatePaths:function(){if(this._postponeUpdatePaths){return}var i;this._redrawBounds=null;for(var j in this._layers){i=this._layers[j];i._update()}this._redraw()},_update:function(){if(this._map._animatingZoom&&this._bounds){return}this._drawnLayers={};a.Renderer.prototype._update.call(this);var j=this._bounds,k=this._container,l=j.getSize(),i=a.Browser.retina?2:1;a.DomUtil.setPosition(k,j.min);k.width=i*l.x;k.height=i*l.y;k.style.width=l.x+"px";k.style.height=l.y+"px";if(a.Browser.retina){this._ctx.scale(2,2)}this._ctx.translate(-j.min.x,-j.min.y);this.fire("update")},_reset:function(){a.Renderer.prototype._reset.call(this);if(this._postponeUpdatePaths){this._postponeUpdatePaths=false;this._updatePaths()}},_initPath:function(j){this._updateDashArray(j);this._layers[a.stamp(j)]=j;var i=j._order={layer:j,prev:this._drawLast,next:null};if(this._drawLast){this._drawLast.next=i}this._drawLast=i;this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(i){this._requestRedraw(i)},_removePath:function(j){var i=j._order;var k=i.next;var l=i.prev;if(k){k.prev=l}else{this._drawLast=l}if(l){l.next=k}else{this._drawFirst=k}delete j._order;delete this._layers[a.stamp(j)];this._requestRedraw(j)},_updatePath:function(i){this._extendRedrawBounds(i);i._project();i._update();this._requestRedraw(i)},_updateStyle:function(i){this._updateDashArray(i);this._requestRedraw(i)},_updateDashArray:function(l){if(l.options.dashArray){var m=l.options.dashArray.split(","),j=[],k;for(k=0;k<m.length;k++){j.push(Number(m[k]))}l.options._dashArray=j}},_requestRedraw:function(i){if(!this._map){return}this._extendRedrawBounds(i);this._redrawRequest=this._redrawRequest||a.Util.requestAnimFrame(this._redraw,this)},_extendRedrawBounds:function(i){var j=(i.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new a.Bounds();this._redrawBounds.extend(i._pxBounds.min.subtract([j,j]));this._redrawBounds.extend(i._pxBounds.max.add([j,j]))},_redraw:function(){this._redrawRequest=null;if(this._redrawBounds){this._redrawBounds.min._floor();this._redrawBounds.max._ceil()}this._clear();this._draw();this._redrawBounds=null},_clear:function(){var j=this._redrawBounds;if(j){var i=j.getSize();this._ctx.clearRect(j.min.x,j.min.y,i.x,i.y)}else{this._ctx.clearRect(0,0,this._container.width,this._container.height)}},_draw:function(){var k,l=this._redrawBounds;this._ctx.save();if(l){var j=l.getSize();this._ctx.beginPath();this._ctx.rect(l.min.x,l.min.y,j.x,j.y);this._ctx.clip()}this._drawing=true;for(var i=this._drawFirst;i;i=i.next){k=i.layer;if(!l||(k._pxBounds&&k._pxBounds.intersects(l))){k._updatePath()}}this._drawing=false;this._ctx.restore()},_updatePoly:function(r,s){if(!this._drawing){return}var q,o,l,k,m=r._parts,t=m.length,u=this._ctx;if(!t){return}this._drawnLayers[r._leaflet_id]=r;u.beginPath();if(u.setLineDash){u.setLineDash(r.options&&r.options._dashArray||[])}for(q=0;q<t;q++){for(o=0,l=m[q].length;o<l;o++){k=m[q][o];u[o?"lineTo":"moveTo"](k.x,k.y)}if(s){u.closePath()}}this._fillStroke(u,r)},_updateCircle:function(j){if(!this._drawing||j._empty()){return}var m=j._point,i=this._ctx,l=j._radius,k=(j._radiusY||l)/l;this._drawnLayers[j._leaflet_id]=j;if(k!==1){i.save();i.scale(1,k)}i.beginPath();i.arc(m.x,m.y/k,l,0,Math.PI*2,false);if(k!==1){i.restore()}this._fillStroke(i,j)},_fillStroke:function(i,k){var j=k.options;if(j.fill){i.globalAlpha=j.fillOpacity;i.fillStyle=j.fillColor||j.color;i.fill(j.fillRule||"evenodd")}if(j.stroke&&j.weight!==0){i.globalAlpha=j.opacity;i.lineWidth=j.weight;i.strokeStyle=j.color;i.lineCap=j.lineCap;i.lineJoin=j.lineJoin;i.stroke()}},_onClick:function(m){var j=this._map.mouseEventToLayerPoint(m),k,l;for(var i=this._drawFirst;i;i=i.next){k=i.layer;if(k.options.interactive&&k._containsPoint(j)&&!this._map._draggableMoved(k)){l=k}}if(l){a.DomEvent._fakeStop(m);this._fireEvent([l],m)}},_onMouseMove:function(j){if(!this._map||this._map.dragging.moving()||this._map._animatingZoom){return}var i=this._map.mouseEventToLayerPoint(j);this._handleMouseHover(j,i)},_handleMouseOut:function(j){var i=this._hoveredLayer;if(i){a.DomUtil.removeClass(this._container,"leaflet-interactive");this._fireEvent([i],j,"mouseout");this._hoveredLayer=null}},_handleMouseHover:function(m,j){var l,k;for(var i=this._drawFirst;i;i=i.next){l=i.layer;if(l.options.interactive&&l._containsPoint(j)){k=l}}if(k!==this._hoveredLayer){this._handleMouseOut(m);if(k){a.DomUtil.addClass(this._container,"leaflet-interactive");this._fireEvent([k],m,"mouseover");this._hoveredLayer=k}}if(this._hoveredLayer){this._fireEvent([this._hoveredLayer],m)}},_fireEvent:function(k,j,i){this._map._fireDOMEvent(j,i||j.type,k)},_bringToFront:function(j){var i=j._order;var k=i.next;var l=i.prev;if(k){k.prev=l}else{return}if(l){l.next=k}else{if(k){this._drawFirst=k}}i.prev=this._drawLast;this._drawLast.next=i;i.next=null;this._drawLast=i;this._requestRedraw(j)},_bringToBack:function(j){var i=j._order;var k=i.next;var l=i.prev;if(l){l.next=k}else{return}if(k){k.prev=l}else{if(l){this._drawLast=l}}i.prev=null;i.next=this._drawFirst;this._drawFirst.prev=i;this._drawFirst=i;this._requestRedraw(j)}});a.Browser.canvas=(function(){return !!b.createElement("canvas").getContext}());a.canvas=function(i){return a.Browser.canvas?new a.Canvas(i):null};a.Polyline.prototype._containsPoint=function(l,t){var s,r,o,u,q,m,v=this._clickTolerance();if(!this._pxBounds.contains(l)){return false}for(s=0,u=this._parts.length;s<u;s++){m=this._parts[s];for(r=0,q=m.length,o=q-1;r<q;o=r++){if(!t&&(r===0)){continue}if(a.LineUtil.pointToSegmentDistance(l,m[o],m[r])<=v){return true}}}return false};a.Polygon.prototype._containsPoint=function(l){var o=false,m,w,v,t,s,r,u,q;if(!this._pxBounds.contains(l)){return false}for(t=0,u=this._parts.length;t<u;t++){m=this._parts[t];for(s=0,q=m.length,r=q-1;s<q;r=s++){w=m[s];v=m[r];if(((w.y>l.y)!==(v.y>l.y))&&(l.x<(v.x-w.x)*(l.y-w.y)/(v.y-w.y)+w.x)){o=!o}}}return o||a.Polyline.prototype._containsPoint.call(this,l,true)};a.CircleMarker.prototype._containsPoint=function(i){return i.distanceTo(this._point)<=this._radius+this._clickTolerance()};a.GeoJSON=a.FeatureGroup.extend({initialize:function(j,i){a.setOptions(this,i);this._layers={};if(j){this.addData(j)}},addData:function(l){var q=a.Util.isArray(l)?l:l.features,p,j,o;if(q){for(p=0,j=q.length;p<j;p++){o=q[p];if(o.geometries||o.geometry||o.features||o.coordinates){this.addData(o)}}return this}var k=this.options;if(k.filter&&!k.filter(l)){return this}var m=a.GeoJSON.geometryToLayer(l,k);if(!m){return this}m.feature=a.GeoJSON.asFeature(l);m.defaultOptions=m.options;this.resetStyle(m);if(k.onEachFeature){k.onEachFeature(l,m)}return this.addLayer(m)},resetStyle:function(i){i.options=a.Util.extend({},i.defaultOptions);this._setLayerStyle(i,this.options.style);return this},setStyle:function(i){return this.eachLayer(function(j){this._setLayerStyle(j,i)},this)},_setLayerStyle:function(i,j){if(typeof j==="function"){j=j(i.feature)}if(i.setStyle){i.setStyle(j)}}});a.extend(a.GeoJSON,{geometryToLayer:function(k,v){var t=k.type==="Feature"?k.geometry:k,u=t?t.coordinates:null,q=[],l=v&&v.pointToLayer,m=v&&v.coordsToLatLng||this.coordsToLatLng,o,j,p,s;if(!u&&!t){return null}switch(t.type){case"Point":o=m(u);return l?l(k,o):new a.Marker(o);case"MultiPoint":for(p=0,s=u.length;p<s;p++){o=m(u[p]);q.push(l?l(k,o):new a.Marker(o))}return new a.FeatureGroup(q);case"LineString":case"MultiLineString":j=this.coordsToLatLngs(u,t.type==="LineString"?0:1,m);return new a.Polyline(j,v);case"Polygon":case"MultiPolygon":j=this.coordsToLatLngs(u,t.type==="Polygon"?1:2,m);return new a.Polygon(j,v);case"GeometryCollection":for(p=0,s=t.geometries.length;p<s;p++){var r=this.geometryToLayer({geometry:t.geometries[p],type:"Feature",properties:k.properties},v);if(r){q.push(r)}}return new a.FeatureGroup(q);default:throw new Error("Invalid GeoJSON object.")}},coordsToLatLng:function(i){return new a.LatLng(i[1],i[0],i[2])},coordsToLatLngs:function(o,m,q){var k=[];for(var l=0,j=o.length,p;l<j;l++){p=m?this.coordsToLatLngs(o[l],m-1,q):(q||this.coordsToLatLng)(o[l]);k.push(p)}return k},latLngToCoords:function(i){return i.alt!==h?[i.lng,i.lat,i.alt]:[i.lng,i.lat]},latLngsToCoords:function(k,p,l){var o=[];for(var m=0,j=k.length;m<j;m++){o.push(p?a.GeoJSON.latLngsToCoords(k[m],p-1,l):a.GeoJSON.latLngToCoords(k[m]))}if(!p&&l){o.push(o[0])}return o},getFeature:function(j,i){return j.feature?a.extend({},j.feature,{geometry:i}):a.GeoJSON.asFeature(i)},asFeature:function(i){if(i.type==="Feature"||i.type==="FeatureCollection"){return i}return{type:"Feature",properties:{},geometry:i}}});var c={toGeoJSON:function(){return a.GeoJSON.getFeature(this,{type:"Point",coordinates:a.GeoJSON.latLngToCoords(this.getLatLng())})}};a.Marker.include(c);a.Circle.include(c);a.CircleMarker.include(c);a.Polyline.prototype.toGeoJSON=function(){var j=!a.Polyline._flat(this._latlngs);var i=a.GeoJSON.latLngsToCoords(this._latlngs,j?1:0);return a.GeoJSON.getFeature(this,{type:(j?"Multi":"")+"LineString",coordinates:i})};a.Polygon.prototype.toGeoJSON=function(){var i=!a.Polyline._flat(this._latlngs),k=i&&!a.Polyline._flat(this._latlngs[0]);var j=a.GeoJSON.latLngsToCoords(this._latlngs,k?2:i?1:0,true);if(!i){j=[j]}return a.GeoJSON.getFeature(this,{type:(k?"Multi":"")+"Polygon",coordinates:j})};a.LayerGroup.include({toMultiPoint:function(){var i=[];this.eachLayer(function(j){i.push(j.toGeoJSON().geometry.coordinates)});return a.GeoJSON.getFeature(this,{type:"MultiPoint",coordinates:i})},toGeoJSON:function(){var j=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(j==="MultiPoint"){return this.toMultiPoint()}var i=j==="GeometryCollection",k=[];this.eachLayer(function(m){if(m.toGeoJSON){var l=m.toGeoJSON();k.push(i?l.geometry:a.GeoJSON.asFeature(l))}});if(i){return a.GeoJSON.getFeature(this,{geometries:k,type:"GeometryCollection"})}return{type:"FeatureCollection",features:k}}});a.geoJSON=function(j,i){return new a.GeoJSON(j,i)};a.geoJson=a.geoJSON;a.Draggable=a.Evented.extend({options:{clickTolerance:3},statics:{START:a.Browser.touch?["touchstart","mousedown"]:["mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"}},initialize:function(j,k,i){this._element=j;this._dragStartTarget=k||j;this._preventOutline=i},enable:function(){if(this._enabled){return}a.DomEvent.on(this._dragStartTarget,a.Draggable.START.join(" "),this._onDown,this);this._enabled=true},disable:function(){if(!this._enabled){return}if(a.Draggable._dragging===this){this.finishDrag()}a.DomEvent.off(this._dragStartTarget,a.Draggable.START.join(" "),this._onDown,this);this._enabled=false;this._moved=false},_onDown:function(i){if(i._simulated||!this._enabled){return}this._moved=false;if(a.DomUtil.hasClass(this._element,"leaflet-zoom-anim")){return}if(a.Draggable._dragging||i.shiftKey||((i.which!==1)&&(i.button!==1)&&!i.touches)){return}a.Draggable._dragging=this;if(this._preventOutline){a.DomUtil.preventOutline(this._element)}a.DomUtil.disableImageDrag();a.DomUtil.disableTextSelection();if(this._moving){return}this.fire("down");var j=i.touches?i.touches[0]:i;this._startPoint=new a.Point(j.clientX,j.clientY);a.DomEvent.on(b,a.Draggable.MOVE[i.type],this._onMove,this).on(b,a.Draggable.END[i.type],this._onUp,this)},_onMove:function(j){if(j._simulated||!this._enabled){return}if(j.touches&&j.touches.length>1){this._moved=true;return}var l=(j.touches&&j.touches.length===1?j.touches[0]:j),i=new a.Point(l.clientX,l.clientY),k=i.subtract(this._startPoint);if(!k.x&&!k.y){return}if(Math.abs(k.x)+Math.abs(k.y)<this.options.clickTolerance){return}a.DomEvent.preventDefault(j);if(!this._moved){this.fire("dragstart");this._moved=true;this._startPos=a.DomUtil.getPosition(this._element).subtract(k);a.DomUtil.addClass(b.body,"leaflet-dragging");this._lastTarget=j.target||j.srcElement;if((f.SVGElementInstance)&&(this._lastTarget instanceof SVGElementInstance)){this._lastTarget=this._lastTarget.correspondingUseElement}a.DomUtil.addClass(this._lastTarget,"leaflet-drag-target")}this._newPos=this._startPos.add(k);this._moving=true;a.Util.cancelAnimFrame(this._animRequest);this._lastEvent=j;this._animRequest=a.Util.requestAnimFrame(this._updatePosition,this,true)},_updatePosition:function(){var i={originalEvent:this._lastEvent};this.fire("predrag",i);a.DomUtil.setPosition(this._element,this._newPos);this.fire("drag",i)},_onUp:function(i){if(i._simulated||!this._enabled){return}this.finishDrag()},finishDrag:function(){a.DomUtil.removeClass(b.body,"leaflet-dragging");if(this._lastTarget){a.DomUtil.removeClass(this._lastTarget,"leaflet-drag-target");this._lastTarget=null}for(var j in a.Draggable.MOVE){a.DomEvent.off(b,a.Draggable.MOVE[j],this._onMove,this).off(b,a.Draggable.END[j],this._onUp,this)}a.DomUtil.enableImageDrag();a.DomUtil.enableTextSelection();if(this._moved&&this._moving){a.Util.cancelAnimFrame(this._animRequest);this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})}this._moving=false;a.Draggable._dragging=false}});a.Handler=a.Class.extend({initialize:function(i){this._map=i},enable:function(){if(this._enabled){return this}this._enabled=true;this.addHooks();return this},disable:function(){if(!this._enabled){return this}this._enabled=false;this.removeHooks();return this},enabled:function(){return !!this._enabled}});a.Map.mergeOptions({dragging:true,inertia:!a.Browser.android23,inertiaDeceleration:3400,inertiaMaxSpeed:Infinity,easeLinearity:0.2,worldCopyJump:false,maxBoundsViscosity:0});a.Map.Drag=a.Handler.extend({addHooks:function(){if(!this._draggable){var i=this._map;this._draggable=new a.Draggable(i._mapPane,i._container);this._draggable.on({down:this._onDown,dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this);this._draggable.on("predrag",this._onPreDragLimit,this);if(i.options.worldCopyJump){this._draggable.on("predrag",this._onPreDragWrap,this);i.on("zoomend",this._onZoomEnd,this);i.whenReady(this._onZoomEnd,this)}}a.DomUtil.addClass(this._map._container,"leaflet-grab leaflet-touch-drag");this._draggable.enable();this._positions=[];this._times=[]},removeHooks:function(){a.DomUtil.removeClass(this._map._container,"leaflet-grab");a.DomUtil.removeClass(this._map._container,"leaflet-touch-drag");this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDown:function(){this._map._stop()},_onDragStart:function(){var j=this._map;if(this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var i=a.latLngBounds(this._map.options.maxBounds);this._offsetLimit=a.bounds(this._map.latLngToContainerPoint(i.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(i.getSouthEast()).multiplyBy(-1).add(this._map.getSize()));this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else{this._offsetLimit=null}j.fire("movestart").fire("dragstart");if(j.options.inertia){this._positions=[];this._times=[]}},_onDrag:function(j){if(this._map.options.inertia){var i=this._lastTime=+new Date(),k=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(k);this._times.push(i);if(i-this._times[0]>50){this._positions.shift();this._times.shift()}}this._map.fire("move",j).fire("drag",j)},_onZoomEnd:function(){var j=this._map.getSize().divideBy(2),i=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=i.subtract(j).x;this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(j,i){return j-(j-i)*this._viscosity},_onPreDragLimit:function(){if(!this._viscosity||!this._offsetLimit){return}var j=this._draggable._newPos.subtract(this._draggable._startPos);var i=this._offsetLimit;if(j.x<i.min.x){j.x=this._viscousLimit(j.x,i.min.x)}if(j.y<i.min.y){j.y=this._viscousLimit(j.y,i.min.y)}if(j.x>i.max.x){j.x=this._viscousLimit(j.x,i.max.x)}if(j.y>i.max.y){j.y=this._viscousLimit(j.y,i.max.y)}this._draggable._newPos=this._draggable._startPos.add(j)},_onPreDragWrap:function(){var p=this._worldWidth,o=Math.round(p/2),j=this._initialWorldOffset,i=this._draggable._newPos.x,l=(i-o+j)%p+o-j,k=(i+o+j)%p-o-j,m=Math.abs(l+j)<Math.abs(k+j)?l:k;this._draggable._absPos=this._draggable._newPos.clone();this._draggable._newPos.x=m},_onDragEnd:function(r){var j=this._map,v=j.options,i=!v.inertia||this._times.length<2;j.fire("dragend",r);if(i){j.fire("moveend")}else{var s=this._lastPos.subtract(this._positions[0]),p=(this._lastTime-this._times[0])/1000,o=v.easeLinearity,m=s.multiplyBy(o/p),l=m.distanceTo([0,0]),u=Math.min(v.inertiaMaxSpeed,l),t=m.multiplyBy(u/l),k=u/(v.inertiaDeceleration*o),q=t.multiplyBy(-k/2).round();if(!q.x&&!q.y){j.fire("moveend")}else{q=j._limitOffset(q,j.options.maxBounds);a.Util.requestAnimFrame(function(){j.panBy(q,{duration:k,easeLinearity:o,noMoveStart:true,animate:true})})}}}});a.Map.addInitHook("addHandler","dragging",a.Map.Drag);a.Map.mergeOptions({doubleClickZoom:true});a.Map.DoubleClickZoom=a.Handler.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(l){var k=this._map,j=k.getZoom(),m=k.options.zoomDelta,i=l.originalEvent.shiftKey?j-m:j+m;if(k.options.doubleClickZoom==="center"){k.setZoom(i)}else{k.setZoomAround(l.containerPoint,i)}}});a.Map.addInitHook("addHandler","doubleClickZoom",a.Map.DoubleClickZoom);a.Map.mergeOptions({scrollWheelZoom:true,wheelDebounceTime:40,wheelPxPerZoomLevel:60});a.Map.ScrollWheelZoom=a.Handler.extend({addHooks:function(){a.DomEvent.on(this._map._container,"mousewheel",this._onWheelScroll,this);this._delta=0},removeHooks:function(){a.DomEvent.off(this._map._container,"mousewheel",this._onWheelScroll,this)},_onWheelScroll:function(k){var l=a.DomEvent.getWheelDelta(k);var i=this._map.options.wheelDebounceTime;this._delta+=l;this._lastMousePos=this._map.mouseEventToContainerPoint(k);if(!this._startTime){this._startTime=+new Date()}var j=Math.max(i-(+new Date()-this._startTime),0);clearTimeout(this._timer);this._timer=setTimeout(a.bind(this._performZoom,this),j);a.DomEvent.stop(k)},_performZoom:function(){var o=this._map,m=o.getZoom(),i=this._map.options.zoomSnap||0;o._stop();var l=this._delta/(this._map.options.wheelPxPerZoomLevel*4),k=4*Math.log(2/(1+Math.exp(-Math.abs(l))))/Math.LN2,j=i?Math.ceil(k/i)*i:k,p=o._limitZoom(m+(this._delta>0?j:-j))-m;this._delta=0;this._startTime=null;if(!p){return}if(o.options.scrollWheelZoom==="center"){o.setZoom(m+p)}else{o.setZoomAround(this._lastMousePos,m+p)}}});a.Map.addInitHook("addHandler","scrollWheelZoom",a.Map.ScrollWheelZoom);a.extend(a.DomEvent,{_touchstart:a.Browser.msPointer?"MSPointerDown":a.Browser.pointer?"pointerdown":"touchstart",_touchend:a.Browser.msPointer?"MSPointerUp":a.Browser.pointer?"pointerup":"touchend",addDoubleTapListener:function(l,u,i){var t,k,q=false,o=250;function m(x){var w;if(a.Browser.pointer){if((!a.Browser.edge)||x.pointerType==="mouse"){return}w=a.DomEvent._pointersCount}else{w=x.touches.length}if(w>1){return}var v=Date.now(),y=v-(t||v);k=x.touches?x.touches[0]:x;q=(y>0&&y<=o);t=v}function r(x){if(q&&!k.cancelBubble){if(a.Browser.pointer){if((!a.Browser.edge)||x.pointerType==="mouse"){return}var v={},y,w;for(w in k){y=k[w];v[w]=y&&y.bind?y.bind(k):y}k=v}k.type="dblclick";u(k);t=null}}var j="_leaflet_",p=this._touchstart,s=this._touchend;l[j+p+i]=m;l[j+s+i]=r;l[j+"dblclick"+i]=u;l.addEventListener(p,m,false);l.addEventListener(s,r,false);l.addEventListener("dblclick",u,false);return this},removeDoubleTapListener:function(k,o){var j="_leaflet_",m=k[j+this._touchstart+o],l=k[j+this._touchend+o],i=k[j+"dblclick"+o];k.removeEventListener(this._touchstart,m,false);k.removeEventListener(this._touchend,l,false);if(!a.Browser.edge){k.removeEventListener("dblclick",i,false)}return this}});a.extend(a.DomEvent,{POINTER_DOWN:a.Browser.msPointer?"MSPointerDown":"pointerdown",POINTER_MOVE:a.Browser.msPointer?"MSPointerMove":"pointermove",POINTER_UP:a.Browser.msPointer?"MSPointerUp":"pointerup",POINTER_CANCEL:a.Browser.msPointer?"MSPointerCancel":"pointercancel",TAG_WHITE_LIST:["INPUT","SELECT","OPTION"],_pointers:{},_pointersCount:0,addPointerListener:function(k,j,i,l){if(j==="touchstart"){this._addPointerStart(k,i,l)}else{if(j==="touchmove"){this._addPointerMove(k,i,l)}else{if(j==="touchend"){this._addPointerEnd(k,i,l)}}}return this},removePointerListener:function(k,j,l){var i=k["_leaflet_"+j+l];if(j==="touchstart"){k.removeEventListener(this.POINTER_DOWN,i,false)}else{if(j==="touchmove"){k.removeEventListener(this.POINTER_MOVE,i,false)}else{if(j==="touchend"){k.removeEventListener(this.POINTER_UP,i,false);k.removeEventListener(this.POINTER_CANCEL,i,false)}}}return this},_addPointerStart:function(k,i,m){var j=a.bind(function(o){if(o.pointerType!=="mouse"&&o.MSPOINTER_TYPE_MOUSE&&o.pointerType!==o.MSPOINTER_TYPE_MOUSE){if(this.TAG_WHITE_LIST.indexOf(o.target.tagName)<0){a.DomEvent.preventDefault(o)}else{return}}this._handlePointer(o,i)},this);k["_leaflet_touchstart"+m]=j;k.addEventListener(this.POINTER_DOWN,j,false);if(!this._pointerDocListener){var l=a.bind(this._globalPointerUp,this);b.documentElement.addEventListener(this.POINTER_DOWN,a.bind(this._globalPointerDown,this),true);b.documentElement.addEventListener(this.POINTER_MOVE,a.bind(this._globalPointerMove,this),true);b.documentElement.addEventListener(this.POINTER_UP,l,true);b.documentElement.addEventListener(this.POINTER_CANCEL,l,true);this._pointerDocListener=true}},_globalPointerDown:function(i){this._pointers[i.pointerId]=i;this._pointersCount++},_globalPointerMove:function(i){if(this._pointers[i.pointerId]){this._pointers[i.pointerId]=i}},_globalPointerUp:function(i){delete this._pointers[i.pointerId];this._pointersCount--},_handlePointer:function(l,k){l.touches=[];for(var j in this._pointers){l.touches.push(this._pointers[j])}l.changedTouches=[l];k(l)},_addPointerMove:function(j,i,l){var k=a.bind(function(m){if((m.pointerType===m.MSPOINTER_TYPE_MOUSE||m.pointerType==="mouse")&&m.buttons===0){return}this._handlePointer(m,i)},this);j["_leaflet_touchmove"+l]=k;j.addEventListener(this.POINTER_MOVE,k,false)},_addPointerEnd:function(j,i,l){var k=a.bind(function(m){this._handlePointer(m,i)},this);j["_leaflet_touchend"+l]=k;j.addEventListener(this.POINTER_UP,k,false);j.addEventListener(this.POINTER_CANCEL,k,false)}});a.Map.mergeOptions({touchZoom:a.Browser.touch&&!a.Browser.android23,bounceAtZoomLimits:true});a.Map.TouchZoom=a.Handler.extend({addHooks:function(){a.DomUtil.addClass(this._map._container,"leaflet-touch-zoom");a.DomEvent.on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){a.DomUtil.removeClass(this._map._container,"leaflet-touch-zoom");a.DomEvent.off(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(k){var j=this._map;if(!k.touches||k.touches.length!==2||j._animatingZoom||this._zooming){return}var l=j.mouseEventToContainerPoint(k.touches[0]),i=j.mouseEventToContainerPoint(k.touches[1]);this._centerPoint=j.getSize()._divideBy(2);this._startLatLng=j.containerPointToLatLng(this._centerPoint);if(j.options.touchZoom!=="center"){this._pinchStartLatLng=j.containerPointToLatLng(l.add(i)._divideBy(2))}this._startDist=l.distanceTo(i);this._startZoom=j.getZoom();this._moved=false;this._zooming=true;j._stop();a.DomEvent.on(b,"touchmove",this._onTouchMove,this).on(b,"touchend",this._onTouchEnd,this);a.DomEvent.preventDefault(k)},_onTouchMove:function(l){if(!l.touches||l.touches.length!==2||!this._zooming){return}var k=this._map,o=k.mouseEventToContainerPoint(l.touches[0]),j=k.mouseEventToContainerPoint(l.touches[1]),m=o.distanceTo(j)/this._startDist;this._zoom=k.getScaleZoom(m,this._startZoom);if(!k.options.bounceAtZoomLimits&&((this._zoom<k.getMinZoom()&&m<1)||(this._zoom>k.getMaxZoom()&&m>1))){this._zoom=k._limitZoom(this._zoom)}if(k.options.touchZoom==="center"){this._center=this._startLatLng;if(m===1){return}}else{var p=o._add(j)._divideBy(2)._subtract(this._centerPoint);if(m===1&&p.x===0&&p.y===0){return}this._center=k.unproject(k.project(this._pinchStartLatLng,this._zoom).subtract(p),this._zoom)}if(!this._moved){k._moveStart(true);this._moved=true}a.Util.cancelAnimFrame(this._animRequest);var i=a.bind(k._move,k,this._center,this._zoom,{pinch:true,round:false});this._animRequest=a.Util.requestAnimFrame(i,this,true);a.DomEvent.preventDefault(l)},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=false;return}this._zooming=false;a.Util.cancelAnimFrame(this._animRequest);a.DomEvent.off(b,"touchmove",this._onTouchMove).off(b,"touchend",this._onTouchEnd);if(this._map.options.zoomAnimation){this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),true,this._map.options.zoomSnap)}else{this._map._resetView(this._center,this._map._limitZoom(this._zoom))}}});a.Map.addInitHook("addHandler","touchZoom",a.Map.TouchZoom);a.Map.mergeOptions({tap:true,tapTolerance:15});a.Map.Tap=a.Handler.extend({addHooks:function(){a.DomEvent.on(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){a.DomEvent.off(this._map._container,"touchstart",this._onDown,this)},_onDown:function(j){if(!j.touches){return}a.DomEvent.preventDefault(j);this._fireClick=true;if(j.touches.length>1){this._fireClick=false;clearTimeout(this._holdTimeout);return}var k=j.touches[0],i=k.target;this._startPos=this._newPos=new a.Point(k.clientX,k.clientY);if(i.tagName&&i.tagName.toLowerCase()==="a"){a.DomUtil.addClass(i,"leaflet-active")}this._holdTimeout=setTimeout(a.bind(function(){if(this._isTapValid()){this._fireClick=false;this._onUp();this._simulateEvent("contextmenu",k)}},this),1000);this._simulateEvent("mousedown",k);a.DomEvent.on(b,{touchmove:this._onMove,touchend:this._onUp},this)},_onUp:function(j){clearTimeout(this._holdTimeout);a.DomEvent.off(b,{touchmove:this._onMove,touchend:this._onUp},this);if(this._fireClick&&j&&j.changedTouches){var k=j.changedTouches[0],i=k.target;if(i&&i.tagName&&i.tagName.toLowerCase()==="a"){a.DomUtil.removeClass(i,"leaflet-active")}this._simulateEvent("mouseup",k);if(this._isTapValid()){this._simulateEvent("click",k)}}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(i){var j=i.touches[0];this._newPos=new a.Point(j.clientX,j.clientY);this._simulateEvent("mousemove",j)},_simulateEvent:function(i,k){var j=b.createEvent("MouseEvents");j._simulated=true;k.target._simulatedClick=true;j.initMouseEvent(i,true,true,f,1,k.screenX,k.screenY,k.clientX,k.clientY,false,false,false,false,0,null);k.target.dispatchEvent(j)}});if(a.Browser.touch&&!a.Browser.pointer){a.Map.addInitHook("addHandler","tap",a.Map.Tap)}a.Map.mergeOptions({boxZoom:true});a.Map.BoxZoom=a.Handler.extend({initialize:function(i){this._map=i;this._container=i._container;this._pane=i._panes.overlayPane},addHooks:function(){a.DomEvent.on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){a.DomEvent.off(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_resetState:function(){this._moved=false},_onMouseDown:function(i){if(!i.shiftKey||((i.which!==1)&&(i.button!==1))){return false}this._resetState();a.DomUtil.disableTextSelection();a.DomUtil.disableImageDrag();this._startPoint=this._map.mouseEventToContainerPoint(i);a.DomEvent.on(b,{contextmenu:a.DomEvent.stop,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(k){if(!this._moved){this._moved=true;this._box=a.DomUtil.create("div","leaflet-zoom-box",this._container);a.DomUtil.addClass(this._container,"leaflet-crosshair");this._map.fire("boxzoomstart")}this._point=this._map.mouseEventToContainerPoint(k);var j=new a.Bounds(this._point,this._startPoint),i=j.getSize();a.DomUtil.setPosition(this._box,j.min);this._box.style.width=i.x+"px";this._box.style.height=i.y+"px"},_finish:function(){if(this._moved){a.DomUtil.remove(this._box);a.DomUtil.removeClass(this._container,"leaflet-crosshair")}a.DomUtil.enableTextSelection();a.DomUtil.enableImageDrag();a.DomEvent.off(b,{contextmenu:a.DomEvent.stop,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(j){if((j.which!==1)&&(j.button!==1)){return}this._finish();if(!this._moved){return}setTimeout(a.bind(this._resetState,this),0);var i=new a.LatLngBounds(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(i).fire("boxzoomend",{boxZoomBounds:i})},_onKeyDown:function(i){if(i.keyCode===27){this._finish()}}});a.Map.addInitHook("addHandler","boxZoom",a.Map.BoxZoom);a.Map.mergeOptions({keyboard:true,keyboardPanDelta:80});a.Map.Keyboard=a.Handler.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(i){this._map=i;this._setPanDelta(i.options.keyboardPanDelta);this._setZoomDelta(i.options.zoomDelta)},addHooks:function(){var i=this._map._container;if(i.tabIndex<=0){i.tabIndex="0"}a.DomEvent.on(i,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this);this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks();a.DomEvent.off(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this);this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(this._focused){return}var i=b.body,l=b.documentElement,k=i.scrollTop||l.scrollTop,j=i.scrollLeft||l.scrollLeft;this._map._container.focus();f.scrollTo(j,k)},_onFocus:function(){this._focused=true;this._map.fire("focus")},_onBlur:function(){this._focused=false;this._map.fire("blur")},_setPanDelta:function(o){var m=this._panKeys={},k=this.keyCodes,l,j;for(l=0,j=k.left.length;l<j;l++){m[k.left[l]]=[-1*o,0]}for(l=0,j=k.right.length;l<j;l++){m[k.right[l]]=[o,0]}for(l=0,j=k.down.length;l<j;l++){m[k.down[l]]=[0,o]}for(l=0,j=k.up.length;l<j;l++){m[k.up[l]]=[0,-1*o]}},_setZoomDelta:function(o){var m=this._zoomKeys={},k=this.keyCodes,l,j;for(l=0,j=k.zoomIn.length;l<j;l++){m[k.zoomIn[l]]=o}for(l=0,j=k.zoomOut.length;l<j;l++){m[k.zoomOut[l]]=-o}},_addHooks:function(){a.DomEvent.on(b,"keydown",this._onKeyDown,this)},_removeHooks:function(){a.DomEvent.off(b,"keydown",this._onKeyDown,this)},_onKeyDown:function(k){if(k.altKey||k.ctrlKey||k.metaKey){return}var i=k.keyCode,j=this._map,l;if(i in this._panKeys){if(j._panAnim&&j._panAnim._inProgress){return}l=this._panKeys[i];if(k.shiftKey){l=a.point(l).multiplyBy(3)}j.panBy(l);if(j.options.maxBounds){j.panInsideBounds(j.options.maxBounds)}}else{if(i in this._zoomKeys){j.setZoom(j.getZoom()+(k.shiftKey?3:1)*this._zoomKeys[i])}else{if(i===27){j.closePopup()}else{return}}}a.DomEvent.stop(k)}});a.Map.addInitHook("addHandler","keyboard",a.Map.Keyboard);a.Handler.MarkerDrag=a.Handler.extend({initialize:function(i){this._marker=i},addHooks:function(){var i=this._marker._icon;if(!this._draggable){this._draggable=new a.Draggable(i,i,true)}this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this).enable();a.DomUtil.addClass(i,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this).disable();if(this._marker._icon){a.DomUtil.removeClass(this._marker._icon,"leaflet-marker-draggable")}},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng();this._marker.closePopup().fire("movestart").fire("dragstart")},_onDrag:function(k){var i=this._marker,m=i._shadow,j=a.DomUtil.getPosition(i._icon),l=i._map.layerPointToLatLng(j);if(m){a.DomUtil.setPosition(m,j)}i._latlng=l;k.latlng=l;k.oldLatLng=this._oldLatLng;i.fire("move",k).fire("drag",k)},_onDragEnd:function(i){delete this._oldLatLng;this._marker.fire("moveend").fire("dragend",i)}});a.Control=a.Class.extend({options:{position:"topright"},initialize:function(i){a.setOptions(this,i)},getPosition:function(){return this.options.position},setPosition:function(i){var j=this._map;if(j){j.removeControl(this)}this.options.position=i;if(j){j.addControl(this)}return this},getContainer:function(){return this._container},addTo:function(k){this.remove();this._map=k;var i=this._container=this.onAdd(k),l=this.getPosition(),j=k._controlCorners[l];a.DomUtil.addClass(i,"leaflet-control");if(l.indexOf("bottom")!==-1){j.insertBefore(i,j.firstChild)}else{j.appendChild(i)}return this},remove:function(){if(!this._map){return this}a.DomUtil.remove(this._container);if(this.onRemove){this.onRemove(this._map)}this._map=null;return this},_refocusOnMap:function(i){if(this._map&&i&&i.screenX>0&&i.screenY>0){this._map.getContainer().focus()}}});a.control=function(i){return new a.Control(i)};a.Map.include({addControl:function(i){i.addTo(this);return this},removeControl:function(i){i.remove();return this},_initControlPos:function(){var k=this._controlCorners={},j="leaflet-",i=this._controlContainer=a.DomUtil.create("div",j+"control-container",this._container);function m(o,p){var l=j+o+" "+j+p;k[o+p]=a.DomUtil.create("div",l,i)}m("top","left");m("top","right");m("bottom","left");m("bottom","right")},_clearControlPos:function(){a.DomUtil.remove(this._controlContainer)}});a.Control.Zoom=a.Control.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"-",zoomOutTitle:"Zoom out"},onAdd:function(k){var l="leaflet-control-zoom",i=a.DomUtil.create("div",l+" leaflet-bar"),j=this.options;this._zoomInButton=this._createButton(j.zoomInText,j.zoomInTitle,l+"-in",i,this._zoomIn);this._zoomOutButton=this._createButton(j.zoomOutText,j.zoomOutTitle,l+"-out",i,this._zoomOut);this._updateDisabled();k.on("zoomend zoomlevelschange",this._updateDisabled,this);return i},onRemove:function(i){i.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){this._disabled=true;this._updateDisabled();return this},enable:function(){this._disabled=false;this._updateDisabled();return this},_zoomIn:function(i){if(!this._disabled&&this._map._zoom<this._map.getMaxZoom()){this._map.zoomIn(this._map.options.zoomDelta*(i.shiftKey?3:1))}},_zoomOut:function(i){if(!this._disabled&&this._map._zoom>this._map.getMinZoom()){this._map.zoomOut(this._map.options.zoomDelta*(i.shiftKey?3:1))}},_createButton:function(j,o,l,i,k){var m=a.DomUtil.create("a",l,i);m.innerHTML=j;m.href="#";m.title=o;m.setAttribute("role","button");m.setAttribute("aria-label",o);a.DomEvent.on(m,"mousedown dblclick",a.DomEvent.stopPropagation).on(m,"click",a.DomEvent.stop).on(m,"click",k,this).on(m,"click",this._refocusOnMap,this);return m},_updateDisabled:function(){var j=this._map,i="leaflet-disabled";a.DomUtil.removeClass(this._zoomInButton,i);a.DomUtil.removeClass(this._zoomOutButton,i);if(this._disabled||j._zoom===j.getMinZoom()){a.DomUtil.addClass(this._zoomOutButton,i)}if(this._disabled||j._zoom===j.getMaxZoom()){a.DomUtil.addClass(this._zoomInButton,i)}}});a.Map.mergeOptions({zoomControl:true});a.Map.addInitHook(function(){if(this.options.zoomControl){this.zoomControl=new a.Control.Zoom();this.addControl(this.zoomControl)}});a.control.zoom=function(i){return new a.Control.Zoom(i)};a.Control.Attribution=a.Control.extend({options:{position:"bottomright",prefix:'<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize:function(i){a.setOptions(this,i);this._attributions={}},onAdd:function(k){k.attributionControl=this;this._container=a.DomUtil.create("div","leaflet-control-attribution");if(a.DomEvent){a.DomEvent.disableClickPropagation(this._container)}for(var j in k._layers){if(k._layers[j].getAttribution){this.addAttribution(k._layers[j].getAttribution())}}this._update();return this._container},setPrefix:function(i){this.options.prefix=i;this._update();return this},addAttribution:function(i){if(!i){return this}if(!this._attributions[i]){this._attributions[i]=0}this._attributions[i]++;this._update();return this},removeAttribution:function(i){if(!i){return this}if(this._attributions[i]){this._attributions[i]--;this._update()}return this},_update:function(){if(!this._map){return}var l=[];for(var j in this._attributions){if(this._attributions[j]){l.push(j)}}var k=[];if(this.options.prefix){k.push(this.options.prefix)}if(l.length){k.push(l.join(", "))}this._container.innerHTML=k.join(" | ")}});a.Map.mergeOptions({attributionControl:true});a.Map.addInitHook(function(){if(this.options.attributionControl){new a.Control.Attribution().addTo(this)}});a.control.attribution=function(i){return new a.Control.Attribution(i)};a.Control.Scale=a.Control.extend({options:{position:"bottomleft",maxWidth:100,metric:true,imperial:true},onAdd:function(l){var k="leaflet-control-scale",i=a.DomUtil.create("div",k),j=this.options;this._addScales(j,k+"-line",i);l.on(j.updateWhenIdle?"moveend":"move",this._update,this);l.whenReady(this._update,this);return i},onRemove:function(i){i.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(j,k,i){if(j.metric){this._mScale=a.DomUtil.create("div",k,i)}if(j.imperial){this._iScale=a.DomUtil.create("div",k,i)}},_update:function(){var j=this._map,k=j.getSize().y/2;var i=j.distance(j.containerPointToLatLng([0,k]),j.containerPointToLatLng([this.options.maxWidth,k]));this._updateScales(i)},_updateScales:function(i){if(this.options.metric&&i){this._updateMetric(i)}if(this.options.imperial&&i){this._updateImperial(i)}},_updateMetric:function(k){var i=this._getRoundNum(k),j=i<1000?i+" m":(i/1000)+" km";this._updateScale(this._mScale,j,i/k)},_updateImperial:function(m){var l=m*3.2808399,k,j,i;if(l>5280){k=l/5280;j=this._getRoundNum(k);this._updateScale(this._iScale,j+" mi",j/k)}else{i=this._getRoundNum(l);this._updateScale(this._iScale,i+" ft",i/l)}},_updateScale:function(k,j,i){k.style.width=Math.round(this.options.maxWidth*i)+"px";k.innerHTML=j},_getRoundNum:function(j){var i=Math.pow(10,(Math.floor(j)+"").length-1),k=j/i;k=k>=10?10:k>=5?5:k>=3?3:k>=2?2:1;return i*k}});a.control.scale=function(i){return new a.Control.Scale(i)};a.Control.Layers=a.Control.extend({options:{collapsed:true,position:"topright",autoZIndex:true,hideSingleBase:false,sortLayers:false,sortFunction:function(l,j,k,i){return k<i?-1:(i<k?1:0)}},initialize:function(m,l,j){a.setOptions(this,j);this._layers=[];this._lastZIndex=0;this._handlingClick=false;for(var k in m){this._addLayer(m[k],k)}for(k in l){this._addLayer(l[k],k,true)}},onAdd:function(i){this._initLayout();this._update();this._map=i;i.on("zoomend",this._checkDisabledLayers,this);return this._container},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var j=0;j<this._layers.length;j++){this._layers[j].layer.off("add remove",this._onLayerChange,this)}},addBaseLayer:function(j,i){this._addLayer(j,i);return(this._map)?this._update():this},addOverlay:function(j,i){this._addLayer(j,i,true);return(this._map)?this._update():this},removeLayer:function(i){i.off("add remove",this._onLayerChange,this);var j=this._getLayer(a.stamp(i));if(j){this._layers.splice(this._layers.indexOf(j),1)}return(this._map)?this._update():this},expand:function(){a.DomUtil.addClass(this._container,"leaflet-control-layers-expanded");this._form.style.height=null;var i=this._map.getSize().y-(this._container.offsetTop+50);if(i<this._form.clientHeight){a.DomUtil.addClass(this._form,"leaflet-control-layers-scrollbar");this._form.style.height=i+"px"}else{a.DomUtil.removeClass(this._form,"leaflet-control-layers-scrollbar")}this._checkDisabledLayers();return this},collapse:function(){a.DomUtil.removeClass(this._container,"leaflet-control-layers-expanded");return this},_initLayout:function(){var j="leaflet-control-layers",i=this._container=a.DomUtil.create("div",j),m=this.options.collapsed;i.setAttribute("aria-haspopup",true);a.DomEvent.disableClickPropagation(i);if(!a.Browser.touch){a.DomEvent.disableScrollPropagation(i)}var l=this._form=a.DomUtil.create("form",j+"-list");if(m){this._map.on("click",this.collapse,this);if(!a.Browser.android){a.DomEvent.on(i,{mouseenter:this.expand,mouseleave:this.collapse},this)}}var k=this._layersLink=a.DomUtil.create("a",j+"-toggle",i);k.href="#";k.title="Layers";if(a.Browser.touch){a.DomEvent.on(k,"click",a.DomEvent.stop).on(k,"click",this.expand,this)}else{a.DomEvent.on(k,"focus",this.expand,this)}a.DomEvent.on(l,"click",function(){setTimeout(a.bind(this._onInputClick,this),0)},this);if(!m){this.expand()}this._baseLayersList=a.DomUtil.create("div",j+"-base",l);this._separator=a.DomUtil.create("div",j+"-separator",l);this._overlaysList=a.DomUtil.create("div",j+"-overlays",l);i.appendChild(l)},_getLayer:function(k){for(var j=0;j<this._layers.length;j++){if(this._layers[j]&&a.stamp(this._layers[j].layer)===k){return this._layers[j]}}},_addLayer:function(k,j,i){k.on("add remove",this._onLayerChange,this);this._layers.push({layer:k,name:j,overlay:i});if(this.options.sortLayers){this._layers.sort(a.bind(function(m,l){return this.options.sortFunction(m.layer,l.layer,m.name,l.name)},this))}if(this.options.autoZIndex&&k.setZIndex){this._lastZIndex++;k.setZIndex(this._lastZIndex)}},_update:function(){if(!this._container){return this}a.DomUtil.empty(this._baseLayersList);a.DomUtil.empty(this._overlaysList);var j,m,l,o,k=0;for(l=0;l<this._layers.length;l++){o=this._layers[l];this._addItem(o);m=m||o.overlay;j=j||!o.overlay;k+=!o.overlay?1:0}if(this.options.hideSingleBase){j=j&&k>1;this._baseLayersList.style.display=j?"":"none"}this._separator.style.display=m&&j?"":"none";return this},_onLayerChange:function(k){if(!this._handlingClick){this._update()}var j=this._getLayer(a.stamp(k.target));var i=j.overlay?(k.type==="add"?"overlayadd":"overlayremove"):(k.type==="add"?"baselayerchange":null);if(i){this._map.fire(i,j)}},_createRadioElement:function(i,l){var k='<input type="radio" class="leaflet-control-layers-selector" name="'+i+'"'+(l?' checked="checked"':"")+"/>";var j=b.createElement("div");j.innerHTML=k;return j.firstChild},_addItem:function(p){var l=b.createElement("label"),o=this._map.hasLayer(p.layer),j;if(p.overlay){j=b.createElement("input");j.type="checkbox";j.className="leaflet-control-layers-selector";j.defaultChecked=o}else{j=this._createRadioElement("leaflet-base-layers",o)}j.layerId=a.stamp(p.layer);a.DomEvent.on(j,"click",this._onInputClick,this);var k=b.createElement("span");k.innerHTML=" "+p.name;var m=b.createElement("div");l.appendChild(m);m.appendChild(j);m.appendChild(k);var i=p.overlay?this._overlaysList:this._baseLayersList;i.appendChild(l);this._checkDisabledLayers();return l},_onInputClick:function(){var k=this._form.getElementsByTagName("input"),l,q,j;var o=[],m=[];this._handlingClick=true;for(var p=k.length-1;p>=0;p--){l=k[p];q=this._getLayer(l.layerId).layer;j=this._map.hasLayer(q);if(l.checked&&!j){o.push(q)}else{if(!l.checked&&j){m.push(q)}}}for(p=0;p<m.length;p++){this._map.removeLayer(m[p])}for(p=0;p<o.length;p++){this._map.addLayer(o[p])}this._handlingClick=false;this._refocusOnMap()},_checkDisabledLayers:function(){var j=this._form.getElementsByTagName("input"),k,m,o=this._map.getZoom();for(var l=j.length-1;l>=0;l--){k=j[l];m=this._getLayer(k.layerId).layer;k.disabled=(m.options.minZoom!==h&&o<m.options.minZoom)||(m.options.maxZoom!==h&&o>m.options.maxZoom)}},_expand:function(){return this.expand()},_collapse:function(){return this.collapse()}});a.control.layers=function(k,j,i){return new a.Control.Layers(k,j,i)}}(window,document));L.Config={};L.Map=L.Map.extend({options:{crs:L.CRS.EPSG4326,attributionControl:false,minZoom:2},getScales:function(){return[591658710.9091312,295829355.4545656,147914677.7272828,73957338.8636414,36978669.4318207,18489334.71591035,9244667.357955175,4622333.678977588,2311166.839488794,1155583.419744397,577791.7098721985,288895.85493609926,144447.92746804963,72223.96373402482,36111.98186701241,18055.990933506204,9027.995466753102,4513.997733376551,2256.998866688275,1128.4994333441375,564.2497166720685]}});L.GEvent={listeners:[],addListener:function(a,b){this.removeListener(a,b);this.listeners.push({name:a,closure:b})},removeListener:function(a,e){var d;var b=0;var c=this.listeners.length;if(e){for(;b<c;b++){d=this.listeners[b];if(d.name===a&&d.closure===e){this.listeners.splice(b,1);b--;c--}}}else{this.removeListenerFor(a)}},dispatch:function(a,d){var e;var b=0;var c=this.listeners.length;for(;b<c;b++){e=this.listeners[b];if(!e){continue}if(e.name===a){e.closure.call(this,d)}}},hasListenerFor:function(a){var d;var b=0;var c=this.listeners.length;for(;b<c;b++){if(this.listeners[b].name===a){return true}}return false},hasListeners:function(){return this.listeners.length>0},removeAllListeners:function(){this.listeners=[]},removeListenerFor:function(a){var d;var b=0;var c=this.listeners.length;for(;b<c;b++){d=this.listeners[b];if(d.name===a){this.listeners.splice(b,1);b--;c--}}},on:function(a,b){this.addListener(a,b)},off:function(a,c){var b=arguments.length;if(b==0){this.removeAllListeners()}else{if(b==1){this.removeListenerFor(arguments[0])}else{if(b>=2){this.removeListener(arguments[0],arguments[1])}}}},trigger:function(a,b){this.dispatch(a,b)}};L.FeatureManager=L.Class.extend({options:{map:null,featureGroup:null,classifyList:null,},initialize:function(a){this.options=L.setOptions(this,a);this.options.classifyList={};this.options.featureGroup=a.featureGroup||L.featureGroup();this.options.map.addLayer(this.options.featureGroup);this._initEvents()},_initEvents:function(){var a=this.options.map;this.options.featureGroup.on("click",function(b){this.resetFeatureIcon();if(b.layer.onFeatureClick){b.layer.onFeatureClick(b.layer)}b.layer.setIcon(b.layer.options.hightIcon)},this);this.options.featureGroup.on("mouseover",function(b){b.layer.setIcon(b.layer.options.hightIcon);if(b.layer.onFeatureOver){b.layer.onFeatureOver(b.layer)}});this.options.featureGroup.on("mouseout",function(d){var b=d.layer.getPopup();var c=a._popup;if(!(b&&c&&(b==c))){d.layer.setIcon(d.layer.options.unhightIcon)}if(d.layer.onFeatureOut){d.layer.onFeatureOut(d.layer)}});this.options.featureGroup.on("popupclose",function(b){b.layer.setIcon(b.layer.options.unhightIcon)},this)},createFeatureSort:function(d,b){var b=b||{};var e=b.onFeatureClick;var a=b.onFeatureOver;var c=b.onFeatureOut;var f={features:[],onFeatureClick:e,onFeatureOver:a,onFeatureOut:c};this.options.classifyList[d]=f},addFeatures:function(c,b,d){if(!b||typeof(b)!="string"){return}if(!(c instanceof Array)){c=[c]}var a=this.options.classifyList;if(a[b]){var c=this._processFeatures(c,b);if(!d){a[b].features=c}else{a[b].features=a[b].features.concat(c)}}},_processFeatures:function(e,d){var a=this.options.classifyList[d];for(var c=0;c<e.length;c++){var b=e[c];b.sort=d;b.onFeatureClick=a.onFeatureClick;b.onFeatureOver=a.onFeatureOver;b.onFeatureOut=a.onFeatureOut}return e},drawFeaturesToMap:function(d){var c;if(typeof(d)=="string"){var b=d||"default";if(this.options.classifyList[b]){c=this.getFeatures(b)}}if(d instanceof Array){c=d}if(!c){return false}for(var a=0;a<c.length;a++){c[a].setIcon(c[a].options.unhightIcon);this.options.featureGroup.addLayer(c[a])}},clearFeaturesFromMap:function(c){if(!c||typeof(c)!="string"){return}var d;var a=this.options.classifyList[c];if(c=="allType"){d=this.options.featureGroup.getLayers()}else{d=a?a.features:[]}if(d){for(var b=0;b<d.length;b++){this.options.featureGroup.removeLayer(d[b])}this.options.classifyList[c].features=[]}},getFeatures:function(a){if(!a||typeof(a)!="string"){return}if(this.options.classifyList[a]){return this.options.classifyList[a].features}else{return}},resetFeatureIcon:function(){this.options.featureGroup.eachLayer(function(a){a.setIcon(a.options.unhightIcon)})}});L.featureManager=function(a){return new L.FeatureManager(a)};L.TipPopup=L.Popup.extend({includes:L.Mixin.Events,initialize:function(a,b){L.Popup.prototype.initialize.call(this,a,b)},_getEvents:function(){var a={viewreset:this._updatePosition};if(this._animated){a.zoomanim=this._zoomAnimation}if(this.options.keepInView){a.moveend=this._adjustPan}return a},openOn:function(a){a.openTipPopup(this)},_initLayout:function(){var b="leaflet-popup",c=b+" "+this.options.className+" leaflet-zoom-"+(this._animated?"animated":"hide"),a=this._container=L.DomUtil.create("div",c);var d=this._wrapper=L.DomUtil.create("div",b+"-content-wrapper measure-tip-wrapper",a);L.DomEvent.disableClickPropagation(d);this._contentNode=L.DomUtil.create("div",b+"-tipcontent",d);L.DomEvent.disableScrollPropagation(this._contentNode);L.DomEvent.on(d,"contextmenu",L.DomEvent.stopPropagation)}});L.Map.include({openTipPopup:function(a,d,b){if(!(a instanceof L.Popup)){var c=a;a=new L.TipPopup(b).setLatLng(d).setContent(c)}a._isOpen=true;this._popup=a;return this.addLayer(a)},closePopup:function(a){if(!a||a===this._popup){a=this._popup;this._popup=null}if(a&&a._sort!="tip-popup"){this.removeLayer(a);a._isOpen=false}return this}});!function(b){if("object"==typeof exports&&"undefined"!=typeof module){module.exports=b()}else{if("function"==typeof define&&define.amd){define([],b)}else{var a;"undefined"!=typeof window?a=window:"undefined"!=typeof global?a=global:"undefined"!=typeof self&&(a=self),a.omnivore=b()}}}(function(){var b;return function a(j,g,f){function h(i,e){if(!g[i]){if(!j[i]){var k="function"==typeof require&&require;if(!e&&k){return k(i,!0)}if(d){return d(i,!0)}throw new Error("Cannot find module '"+i+"'")}var l=g[i]={exports:{}};j[i][0].call(l.exports,function(o){var m=j[i][1][o];return h(m?m:o)},l,l.exports,a,j,g,f)}return g[i].exports}for(var d="function"==typeof require&&require,c=0;c<f.length;c++){h(f[c])}return h}({1:[function(E,M){function B(d,c){"addData" in d&&d.addData(c),"setGeoJSON" in d&&d.setGeoJSON(c)}function z(g,d,c){var f=c||L.geoJson();return q(g,function(i,h){return i?f.fire("error",{error:i}):(B(f,JSON.parse(h.responseText)),void f.fire("ready"))}),f}function D(h,f,d){function g(l,i){return l?c.fire("error",{error:l}):(B(c,K(i.responseText)),void c.fire("ready"))}var c=d||L.geoJson();return q(h,g),c}function H(h,f,d){function c(o,m){function l(){e=!0}var e;return o?g.fire("error",{error:o}):(g.on("error",l),O(m.responseText,f,g),g.off("error",l),void (e||g.fire("ready")))}var g=d||L.geoJson();return q(h,c),g}function x(h,f,d){function c(o,m){function l(){e=!0}var e;return o?g.fire("error",{error:o}):(g.on("error",l),G(m.responseXML||m.responseText,f,g),g.off("error",l),void (e||g.fire("ready")))}var g=d||L.geoJson();return q(h,c),g}function P(h,f,d){function c(o,m){function l(){e=!0}var e;return o?g.fire("error",{error:o}):(g.on("error",l),C(m.responseXML||m.responseText,f,g),g.off("error",l),void (e||g.fire("ready")))}var g=d||L.geoJson();return q(h,c),g}function A(h,f,d){function c(i,e){return i?g.fire("error",{error:i}):(N(e.responseText,f,g),void g.fire("ready"))}var g=d||L.geoJson();return q(h,c),g}function K(h){var f="string"==typeof h?JSON.parse(h):h,d=[];for(var c in f.objects){var g=j.feature(f,f.objects[c]);d=d.concat(g.features?g.features:[g])}return d}function O(g,d,c){function f(i,h){return i?c.fire("error",{error:i}):void B(c,h)}return c=c||L.geoJson(),d=d||{},I.csv2geojson(g,d,f),c}function G(h,f,d){var g=J(h);if(!g){return d.fire("error",{error:"Could not parse GPX"})}d=d||L.geoJson();var c=k.gpx(g);return B(d,c),d}function C(h,f,d){var g=J(h);if(!g){return d.fire("error",{error:"Could not parse GPX"})}d=d||L.geoJson();var c=k.kml(g);return B(d,c),d}function N(g,d,c){c=c||L.geoJson();var f=F(g);return B(c,f),c}function J(c){return"string"==typeof c?(new DOMParser).parseFromString(c,"text/xml"):c}var q=E("corslite"),I=E("csv2geojson"),F=E("wellknown"),j=E("topojson/topojson.js"),k=E("togeojson");M.exports.geojson=z,M.exports.topojson=D,M.exports.topojson.parse=K,M.exports.csv=H,M.exports.csv.parse=O,M.exports.gpx=x,M.exports.gpx.parse=G,M.exports.kml=P,M.exports.kml.parse=C,M.exports.wkt=A,M.exports.wkt.parse=N},{corslite:5,csv2geojson:6,togeojson:9,"topojson/topojson.js":10,wellknown:11}],2:[function(){},{}],3:[function(d,c){c.exports=d(2)},{}],4:[function(g,f){function d(){}var c=f.exports={};c.nextTick=function(){var j="undefined"!=typeof window&&window.setImmediate,i="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(j){return function(e){return window.setImmediate(e)}}if(i){var h=[];return window.addEventListener("message",function(m){var l=m.source;if((l===window||null===l)&&"process-tick"===m.data&&(m.stopPropagation(),h.length>0)){var k=h.shift();k()}},!0),function(e){h.push(e),window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}(),c.title="browser",c.browser=!0,c.env={},c.argv=[],c.on=d,c.addListener=d,c.once=d,c.off=d,c.removeListener=d,c.removeAllListeners=d,c.emit=d,c.binding=function(){throw new Error("process.binding is not supported")},c.cwd=function(){return"/"},c.chdir=function(){throw new Error("process.chdir is not supported")}},{}],5:[function(f,d){function c(j,l,g){function q(e){return e>=200&&300>e||304===e}function h(){void 0===m.status||q(m.status)?l.call(m,null,m):l.call(m,m,null)}var k=!1;if("undefined"==typeof window.XMLHttpRequest){return l(Error("Browser not supported"))}if("undefined"==typeof g){var p=j.match(/^\s*https?:\/\/[^\/]*/);g=p&&p[0]!==location.protocol+"//"+location.domain+(location.port?":"+location.port:"")}var m=new window.XMLHttpRequest;if(g&&!("withCredentials" in m)){m=new window.XDomainRequest;var v=l;l=function(){if(k){v.apply(this,arguments)}else{var o=this,i=arguments;setTimeout(function(){v.apply(o,i)},0)}}}return"onload" in m?m.onload=h:m.onreadystatechange=function(){4===m.readyState&&h()},m.onerror=function(e){l.call(this,e||!0,null),l=function(){}},m.onprogress=function(){},m.ontimeout=function(e){l.call(this,e,null),l=function(){}},m.onabort=function(e){l.call(this,e,null),l=function(){}},m.open("GET",j,!0),m.send(null),k=!0,m}"undefined"!=typeof d&&(d.exports=c)},{}],6:[function(h,p){function d(c){return !!c.match(/(Lat)(itude)?/gi)}function x(c){return !!c.match(/(L)(on|ng)(gitude)?/i)}function g(c){return"object"==typeof c?Object.keys(c).length:0}function k(i){var f=[",",";","	","|"],c=[];return f.forEach(function(s){var r=q(s).parse(i);if(r.length>=1){for(var o=g(r[0]),l=0;l<r.length;l++){if(g(r[l])!==o){return}}c.push({delimiter:s,arity:Object.keys(r[0]).length})}}),c.length?c.sort(function(o,l){return l.arity-o.arity})[0].delimiter:null}function w(f){var c=k(f);return c?q(c).parse(f):null}function v(F,K,D){D||(D=K,K={}),K.delimiter=K.delimiter||",";var z=K.latfield||"",N=K.lonfield||"",B=[],J={type:"FeatureCollection",features:B};if("auto"===K.delimiter&&"string"==typeof F&&(K.delimiter=k(F),!K.delimiter)){return D({type:"Error",message:"Could not autodetect delimiter"})}var C="string"==typeof F?q(K.delimiter).parse(F):F;if(!C.length){return D(null,J)}if(!z||!N){for(var M in C[0]){!z&&d(M)&&(z=M),!N&&x(M)&&(N=M)}if(!z||!N){var I=[];for(var t in C[0]){I.push(t)}return D({type:"Error",message:"Latitude and longitude fields not present",data:C,fields:I})}}for(var H=[],G=0;G<C.length;G++){if(void 0!==C[G][N]&&void 0!==C[G][N]){var i,r,l,A=C[G][N],c=C[G][z];l=j(A,"EW"),l&&(A=l),l=j(c,"NS"),l&&(c=l),i=parseFloat(A),r=parseFloat(c),isNaN(i)||isNaN(r)?H.push({message:"A row contained an invalid value for latitude or longitude",row:C[G]}):(K.includeLatLon||(delete C[G][N],delete C[G][z]),B.push({type:"Feature",properties:C[G],geometry:{type:"Point",coordinates:[parseFloat(i),parseFloat(r)]}}))}}D(H.length?H:null,J)}function y(l){for(var i=l.features,f={type:"Feature",geometry:{type:"LineString",coordinates:[]}},c=0;c<i.length;c++){f.geometry.coordinates.push(i[c].geometry.coordinates)}return f.properties=i[0].properties,{type:"FeatureCollection",features:[f]}}function m(l){for(var i=l.features,f={type:"Feature",geometry:{type:"Polygon",coordinates:[[]]}},c=0;c<i.length;c++){f.geometry.coordinates[0].push(i[c].geometry.coordinates)}return f.properties=i[0].properties,{type:"FeatureCollection",features:[f]}}var q=h("dsv"),j=h("sexagesimal");p.exports={isLon:x,isLat:d,csv:q.csv.parse,tsv:q.tsv.parse,dsv:q,auto:w,csv2geojson:v,toLine:y,toPolygon:m}},{dsv:7,sexagesimal:8}],7:[function(d,c){d("fs");c.exports=new Function('dsv.version = "0.0.3";\n\ndsv.tsv = dsv("\\t");\ndsv.csv = dsv(",");\n\nfunction dsv(delimiter) {\n  var dsv = {},\n      reFormat = new RegExp("[\\"" + delimiter + "\\n]"),\n      delimiterCode = delimiter.charCodeAt(0);\n\n  dsv.parse = function(text, f) {\n    var o;\n    return dsv.parseRows(text, function(row, i) {\n      if (o) return o(row, i - 1);\n      var a = new Function("d", "return {" + row.map(function(name, i) {\n        return JSON.stringify(name) + ": d[" + i + "]";\n      }).join(",") + "}");\n      o = f ? function(row, i) { return f(a(row), i); } : a;\n    });\n  };\n\n  dsv.parseRows = function(text, f) {\n    var EOL = {}, // sentinel value for end-of-line\n        EOF = {}, // sentinel value for end-of-file\n        rows = [], // output rows\n        N = text.length,\n        I = 0, // current character index\n        n = 0, // the current line number\n        t, // the current token\n        eol; // is the current token followed by EOL?\n\n    function token() {\n      if (I >= N) return EOF; // special case: end of file\n      if (eol) return eol = false, EOL; // special case: end of line\n\n      // special case: quotes\n      var j = I;\n      if (text.charCodeAt(j) === 34) {\n        var i = j;\n        while (i++ < N) {\n          if (text.charCodeAt(i) === 34) {\n            if (text.charCodeAt(i + 1) !== 34) break;\n            ++i;\n          }\n        }\n        I = i + 2;\n        var c = text.charCodeAt(i + 1);\n        if (c === 13) {\n          eol = true;\n          if (text.charCodeAt(i + 2) === 10) ++I;\n        } else if (c === 10) {\n          eol = true;\n        }\n        return text.substring(j + 1, i).replace(/""/g, "\\"");\n      }\n\n      // common case: find next delimiter or newline\n      while (I < N) {\n        var c = text.charCodeAt(I++), k = 1;\n        if (c === 10) eol = true; // \\n\n        else if (c === 13) { eol = true; if (text.charCodeAt(I) === 10) ++I, ++k; } // \\r|\\r\\n\n        else if (c !== delimiterCode) continue;\n        return text.substring(j, I - k);\n      }\n\n      // special case: last token before EOF\n      return text.substring(j);\n    }\n\n    while ((t = token()) !== EOF) {\n      var a = [];\n      while (t !== EOL && t !== EOF) {\n        a.push(t);\n        t = token();\n      }\n      if (f && !(a = f(a, n++))) continue;\n      rows.push(a);\n    }\n\n    return rows;\n  };\n\n  dsv.format = function(rows) {\n    if (Array.isArray(rows[0])) return dsv.formatRows(rows); // deprecated; use formatRows\n    var fieldSet = {}, fields = [];\n\n    // Compute unique fields in order of discovery.\n    rows.forEach(function(row) {\n      for (var field in row) {\n        if (!(field in fieldSet)) {\n          fields.push(fieldSet[field] = field);\n        }\n      }\n    });\n\n    return [fields.map(formatValue).join(delimiter)].concat(rows.map(function(row) {\n      return fields.map(function(field) {\n        return formatValue(row[field]);\n      }).join(delimiter);\n    })).join("\\n");\n  };\n\n  dsv.formatRows = function(rows) {\n    return rows.map(formatRow).join("\\n");\n  };\n\n  function formatRow(row) {\n    return row.map(formatValue).join(delimiter);\n  }\n\n  function formatValue(text) {\n    return reFormat.test(text) ? "\\"" + text.replace(/\\"/g, "\\"\\"") + "\\"" : text;\n  }\n\n  return dsv;\n}\n;return dsv')()},{fs:2}],8:[function(d,c){c.exports=function(i,h){if(h||(h="NSEW"),"string"!=typeof i){return null}var g=/^([0-9.]+)? *(?:([0-9.]+)['] *)?(?:([0-9.]+)(?:''|"||) *)?([NSEW])?/,f=i.match(g);return f?f[4]&&-1===h.indexOf(f[4])?null:((f[1]?parseFloat(f[1]):0)+(f[2]?parseFloat(f[2])/60:0)+(f[3]?parseFloat(f[3])/3600:0))*(f[4]&&"S"===f[4]||"W"===f[4]?-1:1):null}},{}],9:[function(f,d,c){(function(e){toGeoJSON=function(){function K(i){if(!i||!i.length){return 0}for(var h=0,g=0;h<i.length;h++){g=(g<<5)-g+i.charCodeAt(h)|0}return g}function C(h,g){return h.getElementsByTagName(g)}function G(h,g){return h.getAttribute(g)}function t(h,g){return parseFloat(G(h,g))}function O(i,h){var g=C(i,h);return g.length?g[0]:null}function A(g){return g.normalize&&g.normalize(),g}function J(i){for(var h=0,g=[];h<i.length;h++){g[h]=parseFloat(i[h])}return g}function N(i){var h={};for(var g in i){i[g]&&(h[g]=i[g])}return h}function F(g){return g&&A(g),g&&g.firstChild&&g.firstChild.nodeValue}function B(g){return J(g.replace(j,"").split(","))}function M(l){for(var i=l.replace(q,"").split(k),h=[],g=0;g<i.length;g++){h.push(B(i[g]))}return h}function I(i){var h=[t(i,"lon"),t(i,"lat")],g=O(i,"ele");return g&&h.push(parseFloat(F(g))),h}function r(){return{type:"FeatureCollection",features:[]}}function H(g){return D.serializeToString(g)}var D,j=/\s*/g,q=/^\s*|\s*$/g,k=/\s+/;"undefined"!=typeof XMLSerializer?D=new XMLSerializer:"object"!=typeof c||"object"!=typeof e||e.browser||(D=new (f("xmldom").XMLSerializer));var z={kml:function(i,h){function T(g){return J(g.split(" "))}function S(u){for(var s=C(u,"coord","gx"),m=[],g=0;g<s.length;g++){m.push(T(F(s[g])))}return m}function V(s){var y,m,X,u,x,E=[];if(O(s,"MultiGeometry")){return V(O(s,"MultiGeometry"))}if(O(s,"MultiTrack")){return V(O(s,"MultiTrack"))}for(X=0;X<P.length;X++){if(m=C(s,P[X])){for(u=0;u<m.length;u++){if(y=m[u],"Point"==P[X]){E.push({type:"Point",coordinates:B(F(O(y,"coordinates")))})}else{if("LineString"==P[X]){E.push({type:"LineString",coordinates:M(F(O(y,"coordinates")))})}else{if("Polygon"==P[X]){var w=C(y,"LinearRing"),W=[];for(x=0;x<w.length;x++){W.push(M(F(O(w[x],"coordinates"))))}E.push({type:"Polygon",coordinates:W})}else{"Track"==P[X]&&E.push({type:"LineString",coordinates:S(y)})}}}}}}return E}function v(w){var X,m=V(w),ac={},x=F(O(w,"name")),ab=F(O(w,"styleUrl")),W=F(O(w,"description")),Z=O(w,"TimeSpan"),s=O(w,"ExtendedData");if(!m.length){return[]}if(x&&(ac.name=x),ab&&l[ab]&&(ac.styleUrl=ab,ac.styleHash=l[ab]),W&&(ac.description=W),Z){var Y=F(O(Z,"begin")),E=F(O(Z,"end"));ac.timespan={begin:Y,end:E}}if(s){var aa=C(s,"Data"),y=C(s,"SimpleData");for(X=0;X<aa.length;X++){ac[aa[X].getAttribute("name")]=F(O(aa[X],"value"))}for(X=0;X<y.length;X++){ac[y[X].getAttribute("name")]=F(y[X])}}return[{type:"Feature",geometry:1===m.length?m[0]:{type:"GeometryCollection",geometries:m},properties:ac}]}h=h||{};for(var o=r(),l={},P=["Polygon","LineString","Point","Track"],R=C(i,"Placemark"),Q=C(i,"Style"),U=0;U<Q.length;U++){l["#"+G(Q[U],"id")]=K(H(Q[U])).toString(16)}for(var p=0;p<R.length;p++){o.features=o.features.concat(v(R[p]))}return o},gpx:function(l){function v(Q,P){var E,s=C(Q,P),p=[];for(E=0;E<s.length;E++){p.push(I(s[E]))}return{type:"Feature",properties:x(Q),geometry:{type:"LineString",coordinates:p}}}function g(p){var i=x(p);return i.sym=F(O(p,"sym")),{type:"Feature",properties:i,geometry:{type:"Point",coordinates:I(p)}}}function x(u){var s,p=["name","desc","author","copyright","link","time","keywords"],i={};for(s=0;s<p.length;s++){i[p[s]]=F(O(u,p[s]))}return N(i)}var m,w=C(l,"trk"),y=C(l,"rte"),o=C(l,"wpt"),h=r();for(m=0;m<w.length;m++){h.features.push(v(w[m],"trkpt"))}for(m=0;m<y.length;m++){h.features.push(v(y[m],"rtept"))}for(m=0;m<o.length;m++){h.features.push(g(o[m]))}return h}};return z}(),"undefined"!=typeof d&&(d.exports=toGeoJSON)}).call(this,f("FWaASH"))},{FWaASH:4,xmldom:3}],10:[function(d,c){!function(){function A(h,m){function f(u){var s,i=h.arcs[0>u?~u:u],y=i[0];return h.transform?(s=[0,0],i.forEach(function(o){s[0]+=o[0],s[1]+=o[1]})):s=i[i.length-1],0>u?[s,y]:[y,s]}function w(u,s){for(var o in u){var i=u[o];delete s[i.start],delete i.start,delete i.end,i.forEach(function(r){g[0>r?~r:r]=1}),p.push(i)}}var g={},l={},v={},p=[],x=-1;return m.forEach(function(y,u){var N,s=h.arcs[0>y?~y:y];s.length<3&&!s[1][0]&&!s[1][1]&&(N=m[++x],m[x]=y,m[u]=N)}),m.forEach(function(Q){var N,r,O=f(Q),i=O[0],u=O[1];if(N=v[i]){if(delete v[N.end],N.push(Q),N.end=u,r=l[u]){delete l[r.start];var y=r===N?N:N.concat(r);l[y.start=N.start]=v[y.end=r.end]=y}else{l[N.start]=v[N.end]=N}}else{if(N=l[u]){if(delete l[N.start],N.unshift(Q),N.start=i,r=v[i]){delete v[r.end];var P=r===N?N:r.concat(N);l[P.start=r.start]=v[P.end=N.end]=P}else{l[N.start]=v[N.end]=N}}else{N=[Q],l[N.start=i]=v[N.end=u]=N}}}),w(v,l),w(l,v),m.forEach(function(i){g[0>i?~i:i]||p.push([i])}),p}function C(m,x,Q){function h(i){var f=0>i?~i:i;(N[f]||(N[f]=[])).push({i:i,g:w})}function v(f){f.forEach(h)}function P(f){f.forEach(v)}function O(f){"GeometryCollection"===f.type?f.geometries.forEach(O):f.type in r&&(w=f,r[f.type](f.arcs))}var R=[];if(arguments.length>1){var w,N=[],r={LineString:v,MultiLineString:P,Polygon:P,MultiPolygon:function(f){f.forEach(P)}};O(x),N.forEach(arguments.length<3?function(f){R.push(f[0].i)}:function(f){Q(f[0].g,f[f.length-1].g)&&R.push(f[0].i)})}else{for(var g=0,y=m.arcs.length;y>g;++g){R.push(g)}}return{type:"MultiLineString",arcs:A(m,R)}}function F(r,m){function s(f){f.forEach(function(i){i.forEach(function(o){(h[o=0>o?~o:o]||(h[o]=[])).push(f)})}),g.push(f)}function l(f){return J(z(r,{type:"Polygon",arcs:[f]}).coordinates[0])>0}var h={},g=[],p=[];return m.forEach(function(f){"Polygon"===f.type?s(f.arcs):"MultiPolygon"===f.type&&f.arcs.forEach(s)}),g.forEach(function(o){if(!o._){var i=[],f=[o];for(o._=1,p.push(i);o=f.pop();){i.push(o),o.forEach(function(u){u.forEach(function(v){h[0>v?~v:v].forEach(function(w){w._||(w._=1,f.push(w))})})})}}}),g.forEach(function(f){delete f._}),{type:"MultiPolygon",arcs:p.map(function(u){var x=[];if(u.forEach(function(f){f.forEach(function(o){o.forEach(function(y){h[0>y?~y:y].length<2&&x.push(y)})})}),x=A(r,x),(n=x.length)>1){for(var i,v=l(u[0][0]),w=0;n>w;++w){if(v===l(x[w])){i=x[0],x[0]=x[w],x[w]=i;break}}}return x})}}function t(g,f){return"GeometryCollection"===f.type?{type:"FeatureCollection",features:f.geometries.map(function(h){return M(g,h)})}:M(g,f)}function M(h,g){var f={type:"Feature",id:g.id,properties:g.properties||{},geometry:z(h,g)};return null==g.id&&delete f.id,f}function z(h,v){function f(R,P){P.length&&P.pop();for(var u,s=w[0>R?~R:R],Q=0,l=s.length;l>Q;++Q){P.push(u=s[Q].slice()),O(u,Q)}0>R&&I(P,l)}function N(i){return i=i.slice(),O(i,0),i}function g(s){for(var l=[],i=0,r=s.length;r>i;++i){f(s[i],l)}return l.length<2&&l.push(l[0].slice()),l}function p(l){for(var i=g(l);i.length<4;){i.push(i[0].slice())}return i}function y(i){return i.map(p)}function x(l){var i=l.type;return"GeometryCollection"===i?{type:i,geometries:l.geometries.map(x)}:i in m?{type:i,coordinates:m[i](l)}:null}var O=D(h.transform),w=h.arcs,m={Point:function(i){return N(i.coordinates)},MultiPoint:function(i){return i.coordinates.map(N)},LineString:function(i){return g(i.arcs)},MultiLineString:function(i){return i.arcs.map(g)},Polygon:function(i){return y(i.arcs)},MultiPolygon:function(i){return i.arcs.map(y)}};return x(v)}function I(l,h){for(var g,f=l.length,i=f-h;i<--f;){g=l[i],l[i++]=l[f],l[f]=g}}function K(l,h){for(var g=0,f=l.length;f>g;){var i=g+f>>>1;l[i]<h?g=i+1:f=i}return g}function E(x){function Q(g,f){g.forEach(function(l){0>l&&(l=~l);var i=w[l];i?i.push(f):w[l]=[f]})}function h(g,f){g.forEach(function(i){Q(i,f)})}function V(g,f){"GeometryCollection"===g.type?g.geometries.forEach(function(i){V(i,f)}):g.type in U&&U[g.type](g.arcs,f)}var w={},N=x.map(function(){return[]}),U={LineString:Q,MultiLineString:h,Polygon:h,MultiPolygon:function(g,f){g.forEach(function(i){h(i,f)})}};x.forEach(V);for(var S in w){for(var W=w[S],P=W.length,y=0;P>y;++y){for(var m=y+1;P>m;++m){var R,O=W[y],T=W[m];(R=N[O])[S=K(R,T)]!==T&&R.splice(S,0,T),(R=N[T])[S=K(R,O)]!==O&&R.splice(S,0,O)}}}return N}function B(l,v){function g(f){x.remove(f),f[1][2]=v(f),x.push(f)}var y,h=D(l.transform),m=e(l.transform),x=G(),w=0;for(v||(v=H),l.arcs.forEach(function(u){var s=[];u.forEach(h);for(var o=1,f=u.length-1;f>o;++o){y=u.slice(o-1,o+2),y[1][2]=v(y),s.push(y),x.push(y)}u[0][2]=u[f][2]=1/0;for(var o=0,f=s.length;f>o;++o){y=s[o],y.previous=s[o-1],y.next=s[o+1]}});y=x.pop();){var N=y.previous,p=y.next;y[1][2]<w?y[1][2]=w:w=y[1][2],N&&(N.next=p,N[2]=y[2],g(N)),p&&(p.previous=N,p[0]=y[0],g(p))}return l.arcs.forEach(function(f){f.forEach(m)}),l}function J(p){for(var l,h=-1,g=p.length,m=p[g-1],f=0;++h<g;){l=m,m=p[h],f+=l[0]*m[1]-l[1]*m[0]}return 0.5*f}function H(i){var h=i[0],g=i[1],f=i[2];return Math.abs((h[0]-f[0])*(g[1]-h[1])-(h[0]-g[0])*(f[1]-h[1]))}function q(g,f){return g[1][2]-f[1][2]}function G(){function l(u,p){for(;p>0;){var m=(p+1>>1)-1,s=f[m];if(q(u,s)>=0){break}f[s._=p]=s,f[u._=p=m]=u}}function h(w,v){for(;;){var s=v+1<<1,p=s-1,o=v,m=f[o];if(i>p&&q(f[p],m)<0&&(m=f[o=p]),i>s&&q(f[s],m)<0&&(m=f[o=s]),o===v){break}f[m._=v]=m,f[w._=v=o]=w}}var g={},f=[],i=0;return g.push=function(m){return l(f[m._=i]=m,i++),i},g.pop=function(){if(!(0>=i)){var o,m=f[0];return --i>0&&(o=f[i],h(f[o._=0]=o,0)),m}},g.remove=function(p){var o,m=p._;if(f[m]===p){return m!==--i&&(o=f[i],(q(o,p)<0?l:h)(f[o._=m]=o,m)),m}},g}function D(s){if(!s){return k}var m,l,h=s.scale[0],p=s.scale[1],g=s.translate[0],f=s.translate[1];return function(o,i){i||(m=l=0),o[0]=(m+=o[0])*h+g,o[1]=(l+=o[1])*p+f}}function e(s){if(!s){return k}var m,l,h=s.scale[0],p=s.scale[1],g=s.translate[0],f=s.translate[1];return function(u,i){i||(m=l=0);var o=(u[0]-g)/h|0,r=(u[1]-f)/p|0;u[0]=o-m,u[1]=r-l,m=o,l=r}}function k(){}var j={version:"1.6.8",mesh:function(f){return z(f,C.apply(this,arguments))},meshArcs:C,merge:function(f){return z(f,F.apply(this,arguments))},mergeArcs:F,feature:t,neighbors:E,presimplify:B};"function"==typeof b&&b.amd?b(j):"object"==typeof c&&c.exports?c.exports=j:this.topojson=j}()},{}],11:[function(g,f){function d(q){function B(i){var h=q.substring(y).match(i);return h?(y+=h[0].length,h[0]):null}function j(e){return e&&F.match(/\d+/)&&(e.crs={type:"name",properties:{name:"urn:ogc:def:crs:EPSG::"+F}}),e}function H(){B(/^\s*/)}function m(){H();for(var s,l=0,p=[],h=[p],e=p;s=B(/^(\()/)||B(/^(\))/)||B(/^(\,)/)||B(/^[-+]?([0-9]*\.[0-9]+|[0-9]+)/);){if("("==s){h.push(e),e=[],h[h.length-1].push(e),l++}else{if(")"==s){if(e=h.pop(),!e){return}if(l--,0===l){break}}else{if(","===s){e=[],h[h.length-1].push(e)}else{if(isNaN(parseFloat(s))){return null}e.push(parseFloat(s))}}}H()}return 0!==l?null:p}function x(){for(var i,e,h=[];e=B(/^[-+]?([0-9]*\.[0-9]+|[0-9]+)/)||B(/^(\,)/);){","==e?(h.push(i),i=[]):(i||(i=[]),i.push(parseFloat(e))),H()}return i&&h.push(i),h.length?h:null}function G(){if(!B(/^(point)/i)){return null}if(H(),!B(/^(\()/)){return null}var e=x();return e?(H(),B(/^(\))/)?{type:"Point",coordinates:e[0]}:null):null}function E(){if(!B(/^(multipoint)/i)){return null}H();var e=m();return e?(H(),{type:"MultiPoint",coordinates:e}):null}function I(){if(!B(/^(multilinestring)/i)){return null}H();var e=m();return e?(H(),{type:"MultiLineString",coordinates:e}):null}function A(){if(!B(/^(linestring)/i)){return null}if(H(),!B(/^(\()/)){return null}var e=x();return e?B(/^(\))/)?{type:"LineString",coordinates:e}:null:null}function D(){return B(/^(polygon)/i)?(H(),{type:"Polygon",coordinates:m()}):null}function w(){return B(/^(multipolygon)/i)?(H(),{type:"MultiPolygon",coordinates:m()}):null}function k(){var h,e=[];if(!B(/^(geometrycollection)/i)){return null}if(H(),!B(/^(\()/)){return null}for(;h=C();){e.push(h),H(),B(/^(\,)/),H()}return B(/^(\))/)?{type:"GeometryCollection",geometries:e}:null}function C(){return G()||A()||D()||E()||I()||w()||k()}var z=q.split(";"),q=z.pop(),F=(z.shift()||"").split("=").pop(),y=0;return j(C())}function c(p){function l(e){return 2===e.length?e[0]+" "+e[1]:3===e.length?e[0]+" "+e[1]+" "+e[2]:void 0}function k(e){return e.map(l).join(", ")}function m(e){return e.map(k).map(h).join(", ")}function j(e){return e.map(m).map(h).join(", ")}function h(e){return"("+e+")"}switch("Feature"===p.type&&(p=p.geometry),p.type){case"Point":return"POINT ("+l(p.coordinates)+")";case"LineString":return"LINESTRING ("+k(p.coordinates)+")";case"Polygon":return"POLYGON ("+m(p.coordinates)+")";case"MultiPoint":return"MULTIPOINT ("+k(p.coordinates)+")";case"MultiPolygon":return"MULTIPOLYGON ("+j(p.coordinates)+")";case"MultiLineString":return"MULTILINESTRING ("+m(p.coordinates)+")";case"GeometryCollection":return"GEOMETRYCOLLECTION ("+p.geometries.map(c).join(", ")+")";default:throw new Error("stringify requires a valid GeoJSON Feature or geometry object as input")}}f.exports=d,f.exports.parse=d,f.exports.stringify=c},{}]},{},[1])(1)});L.LatLngUtil={cloneLatLngs:function(a){var d=[];for(var c=0,b=a.length;c<b;c++){d.push(this.cloneLatLng(a[c]))}return d},cloneLatLng:function(a){return L.latLng(a.lat,a.lng)}};L.ProxyUtil=function(e,d){var a,c,b;if(typeof d==="string"){b=e[d];d=e;e=b}if(!(typeof e=="function")){return undefined}a=Array.prototype.slice.call(arguments,2);c=function(){return e.apply(d||this,a.concat(Array.prototype.slice.call(arguments)))};return c};L.GeometryUtil=L.extend(L.GeometryUtil||{},{geodesicArea:function(f){var c=f.length,d=0,a=L.LatLng.DEG_TO_RAD,g,e;if(c>2){for(var b=0;b<c;b++){g=f[b];e=f[(b+1)%c];d+=((e.lng-g.lng)*a)*(2+Math.sin(g.lat*a)+Math.sin(e.lat*a))}d=d*6378137*6378137/2}return Math.abs(d)},readableArea:function(b,a){var c;if(a){if(b>=1000000){c=(b*0.000001).toFixed(2)+" "}else{c=b.toFixed(2)+" ;"}}else{b/=0.836127;if(b>=3097600){c=(b/3097600).toFixed(2)+" mi&sup2;"}else{if(b>=4840){c=(b/4840).toFixed(2)+" acres"}else{c=Math.ceil(b)+" yd&sup2;"}}}return c},readableDistance:function(e,a,c){var d;if(a){if(e>1000){d=(e/1000).toFixed(2)+" "}else{d=Math.ceil(e)+" "}}else{e*=1.09361;if(e>1760){d=(e/1760).toFixed(2)+" miles"}else{var b=" yd";if(c){e=e*3;b=" ft"}d=Math.ceil(e)+b}}return d}});L.Util.extend(L.LineUtil,{segmentsIntersect:function(c,d,b,a){return this._checkCounterclockwise(c,b,a)!==this._checkCounterclockwise(d,b,a)&&this._checkCounterclockwise(c,d,b)!==this._checkCounterclockwise(c,d,a)},_checkCounterclockwise:function(b,c,a){return(a.y-b.y)*(c.x-b.x)>(c.y-b.y)*(a.x-b.x)}});L.Polyline.include({intersects:function(){var c=this._originalPoints,a=c?c.length:0,b,d,e;if(this._tooFewPointsForIntersection()){return false}for(b=a-1;b>=3;b--){d=c[b-1];e=c[b];if(this._lineSegmentsIntersectsRange(d,e,b-2)){return true}}return false},newLatLngIntersects:function(b,a){if(!this._map){return false}return this.newPointIntersects(this._map.latLngToLayerPoint(b),a)},newPointIntersects:function(b,e){var d=this._originalPoints,a=d?d.length:0,f=d?d[a-1]:null,c=a-2;if(this._tooFewPointsForIntersection(1)){return false}return this._lineSegmentsIntersectsRange(f,b,c,e?1:0)},_tooFewPointsForIntersection:function(c){var b=this._originalPoints,a=b?b.length:0;a+=c||0;return !this._originalPoints||a<=3},_lineSegmentsIntersectsRange:function(g,h,c,b){var d=this._originalPoints,f,e;b=b||0;for(var a=c;a>b;a--){f=d[a-1];e=d[a];if(L.LineUtil.segmentsIntersect(g,h,f,e)){return true}}return false}});L.Polygon.include({intersects:function(){var e,c=this._originalPoints,a,f,d,b;if(this._tooFewPointsForIntersection()){return false}e=L.Polyline.prototype.intersects.call(this);if(e){return true}a=c.length;f=c[0];d=c[a-1];b=a-2;return this._lineSegmentsIntersectsRange(d,f,b,1)}});L.FormatUtil={tryFunc:function(){var d=null;for(var c=0,a=arguments.length;c<a;c++){var b=arguments[c];try{d=b();break}catch(f){}}return d},bind:function(c,b){var a=Array.prototype.slice.apply(arguments,[2]);return function(){var d=a.concat(Array.prototype.slice.apply(arguments,[0]));return c.apply(b,d)}},applyDefaults:function(d,c){d=d||{};var b=typeof window.Event=="function"&&c instanceof window.Event;for(var a in c){if(d[a]===undefined||(!b&&c.hasOwnProperty&&c.hasOwnProperty(a)&&!d.hasOwnProperty(a))){d[a]=c[a]}}if(!b&&c&&c.hasOwnProperty&&c.hasOwnProperty("toString")&&!d.hasOwnProperty("toString")){d.toString=c.toString}return d}};L.Util.writeGeometryToWKT=function(g,e){var f;if(e=="point"){f="POLYGON("+g.lng+" "+g.lat+")"}else{if(e=="line"){f="LINESTRING(";var d=[];for(var c=0;c<g.length;c++){d.push(g[c].lng+" "+g[c].lat)}f+=d.join(",");f+=")"}else{if(e=="polygon"){f="POLYGON(";var a=[];for(var c=0;c<g.length;c++){var d=[];for(var b=0;b<g[c].length;b++){d.push(g[c][b].lng+" "+g[c][b].lat)}a.push("("+d.join(",")+")")}f+=a.join(",");f+=")"}}}return f};L.Util.getParam=function(f){var b=document.location.search.substring(1);var d=b.split("&");for(var a=0;a<d.length;a++){var c=d[a];if(c.indexOf(f+"=")==0){var e=c.substring(f.length+1);return decodeURIComponent(e)}}};L._LeafletCallbacks={};L.Request={support:!!(window.XMLHttpRequest&&"withCredentials" in new XMLHttpRequest()),callbacks:0,serialize:function(f){var d="";for(var a in f){if(a=="async"){continue}if(f.hasOwnProperty(a)){var e=f[a];var b=Object.prototype.toString.call(e);var c;if(d.length){d+="&"}if(b==="[object Array]"){c=(Object.prototype.toString.call(e[0])==="[object Object]")?JSON.stringify(e):e.join(",")}else{if(b==="[object Object]"){c=JSON.stringify(e)}else{if(b==="[object Date]"){c=e.valueOf()}else{c=e}}}d+=encodeURIComponent(a)+"="+encodeURIComponent(c)}}return d},createRequest:function(d,b,c){var a=new XMLHttpRequest();a.onerror=function(f){a.onreadystatechange=L.Util.falseFn;d.call(b,{error:{code:500,message:"XMLHttpRequest error"}},null)};a.onreadystatechange=function(){var e;var f;if(a.readyState===4){if(c=="json"){e=JSON.parse(a.responseText)}else{e=a.responseText}if(!f&&e.error){f=e.error;e=null}a.onerror=L.Util.falseFn;d.call(b,e,f)}};return a},request:function(a,d,h,b){var c=L.Request.serialize(d);var e=L.Request.createRequest(h,b);if(c!=""){if(a.indexOf("proxy.jsp?")!=-1){var i=a.replace("proxy.jsp?","");if(i.indexOf("?")!=-1){a+="&"+c}else{a+="?"+c}}else{if(a.indexOf("?")!=-1){a+="&"+c}else{a+="?"+c}}}var g=a.length;var f=true;if(d){f=d.async}if(g<=2000&&L.Request.support){e.open("GET",a,f);e.send(null)}else{if(g>2000&&L.Request.support){e.open("POST",a,f);e.setRequestHeader("Content-Type","application/x-www-form-urlencoded");e.send(c)}else{if(g<=2000&&!L.Request.support){return L.Request.get.JSONP(a,d,h,b)}}}return e},post:{XMLHTTP:function(b,e,f,c){var a=L.Request.createRequest(f,c);var d=true;if(e){d=e.async}a.open("POST",b,d);a.setRequestHeader("Content-Type","application/x-www-form-urlencoded");a.send(L.Request.serialize(e));return a}},get:{CORS:function(c,g,h,d){var f=L.Request.serialize(g);var b=L.Request.createRequest(h,d);if(f!=""){if(c.indexOf("proxy.jsp?")!=-1){var a=c.replace("proxy.jsp?","");if(a.indexOf("?")!=-1){c+="&"+f}else{c+="?"+f}}else{if(c.indexOf("?")!=-1){c+="&"+f}else{c+="?"+f}}}var e=true;if(g){e=g.async}b.open("GET",c,e);b.send(null);return b},JSON:function(c,g,h,d){var f=L.Request.serialize(g);var b=L.Request.createRequest(h,d,"json");if(f!=""){if(c.indexOf("proxy.jsp?")!=-1){var a=c.replace("proxy.jsp?","");if(a.indexOf("?")!=-1){c+="&"+f}else{c+="?"+f}}else{if(c.indexOf("?")!=-1){c+="&"+f}else{c+="?"+f}}}var e=true;if(g){e=g.async}b.open("GET",c,e);b.send(null);return b},JSONP:function(b,e,f,c){var d="c"+L.Request.callbacks;e=e?e:{};e.callback="L._LeafletCallbacks."+d;var a=L.DomUtil.create("script",null,document.body);a.type="text/javascript";if(b.indexOf("?")!=-1){a.src=b+"&"+L.Request.serialize(e)}else{a.src=b+"?"+L.Request.serialize(e)}a.id=d;L._LeafletCallbacks[d]=function(g){if(L._LeafletCallbacks[d]!==true){var i;var h=Object.prototype.toString.call(g);if(!(h==="[object Object]"||h==="[object Array]")){i={error:{code:500,message:"Expected array or object as JSONP response"}};g=null}if(!i&&g.error){i=g;g=null}f.call(c,g,i);L._LeafletCallbacks[d]=true}};L.Request.callbacks++;return{id:d,url:a.src,abort:function(){L._LeafletCallbacks._callback[d]({code:0,message:"Request aborted."})}}}}};L.get=(L.Request.support)?L.Request.get.CORS:L.Request.get.JSONP;L.getJSON=L.Request.get.JSON;L.jsonp=L.Request.get.JSONP;L.post=L.Request.post.XMLHTTP;L.request=L.Request.request;L.drawLocal={draw:{toolbar:{actions:{title:"",text:""},finish:{title:"",text:""},undo:{title:"",text:""},buttons:{polyline:"",polygon:"",rectangle:"",circle:"",marker:""}},handlers:{circle:{tooltip:{start:""},radius:""},marker:{tooltip:{start:""}},polygon:{tooltip:{start:"",cont:"",end:""}},polyline:{error:"<strong>:</strong> !",tooltip:{start:"",cont:"",end:""}},rectangle:{tooltip:{start:""}},simpleshape:{tooltip:{end:""}}}},edit:{toolbar:{actions:{save:{title:"",text:""},cancel:{title:"",text:""}},buttons:{edit:"",editDisabled:"",remove:"",removeDisabled:""}},handlers:{edit:{tooltip:{text:"",subtext:""}},remove:{tooltip:{text:""}}}}};L.Draw={};L.Draw.Feature=L.Handler.extend({includes:L.Mixin.Events,initialize:function(b,a){this._map=b;this._container=b._container;this._overlayPane=b._panes.overlayPane;this._popupPane=b._panes.popupPane;if(a&&a.shapeOptions){a.shapeOptions=L.Util.extend({},this.options.shapeOptions,a.shapeOptions)}L.setOptions(this,a)},enable:function(){if(this._enabled){return}L.Handler.prototype.enable.call(this);this.fire("enabled",{handler:this.type});this._map.fire("draw:drawstart",{layerType:this.type})},disable:function(){if(!this._enabled){return}L.Handler.prototype.disable.call(this);this._map.fire("draw:drawstop",{layerType:this.type});this.fire("disabled",{handler:this.type})},addHooks:function(){var a=this._map;if(a){L.DomUtil.disableTextSelection();a.getContainer().focus();this._tooltip=new L.Tooltip(this._map);L.DomEvent.on(this._container,"keyup",this._cancelDrawing,this)}},removeHooks:function(){if(this._map){L.DomUtil.enableTextSelection();this._tooltip.dispose();this._tooltip=null;L.DomEvent.off(this._container,"keyup",this._cancelDrawing,this)}},setOptions:function(a){L.setOptions(this,a)},_fireCreatedEvent:function(a){this._map.fire("draw:created",{layer:a,layerType:this.type})},_cancelDrawing:function(a){this._map.fire("draw:canceled",{layerType:this.type});if(a.keyCode===27){this.disable()}}});L.Draw.Polyline=L.Draw.Feature.extend({statics:{TYPE:"polyline"},Poly:L.Polyline,options:{allowIntersection:true,repeatMode:false,drawError:{color:"#b00b00",timeout:2500},icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),touchIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-touch-icon"}),guidelineDistance:20,maxGuideLineLength:4000,shapeOptions:{stroke:true,color:"#f06eaa",weight:4,opacity:0.5,fill:false,clickable:true},metric:true,feet:true,showLength:true,zIndexOffset:2000},initialize:function(b,a){if(L.Browser.touch){this.options.icon=this.options.touchIcon}this.options.drawError.message=L.drawLocal.draw.handlers.polyline.error;if(a&&a.drawError){a.drawError=L.Util.extend({},this.options.drawError,a.drawError)}this.type=L.Draw.Polyline.TYPE;L.Draw.Feature.prototype.initialize.call(this,b,a)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this);if(this._map){this._markers=[];this._markerGroup=new L.LayerGroup();this._map.addLayer(this._markerGroup);this._poly=new L.Polyline([],this.options.shapeOptions);this._tooltip.updateContent(this._getTooltipText());if(!this._mouseMarker){this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})}if(!L.Browser.touch){this._map.on("mouseup",this._onMouseUp,this)}this._mouseMarker.on("mousedown",this._onMouseDown,this).on("mouseout",this._onMouseOut,this).on("mouseup",this._onMouseUp,this).on("mousemove",this._onMouseMove,this).addTo(this._map);this._map.on("mouseup",this._onMouseUp,this).on("mousemove",this._onMouseMove,this).on("zoomlevelschange",this._onZoomEnd,this).on("click",this._onTouch,this).on("zoomend",this._onZoomEnd,this)}},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this);this._clearHideErrorTimeout();this._cleanUpShape();this._map.removeLayer(this._markerGroup);delete this._markerGroup;delete this._markers;this._map.removeLayer(this._poly);delete this._poly;this._mouseMarker.off("mousedown",this._onMouseDown,this).off("mouseout",this._onMouseOut,this).off("mouseup",this._onMouseUp,this).off("mousemove",this._onMouseMove,this);this._map.removeLayer(this._mouseMarker);delete this._mouseMarker;this._clearGuides();this._map.off("mouseup",this._onMouseUp,this).off("mousemove",this._onMouseMove,this).off("zoomlevelschange",this._onZoomEnd,this).off("zoomend",this._onZoomEnd,this).off("click",this._onTouch,this)},deleteLastVertex:function(){if(this._markers.length<=1){return}var b=this._markers.pop(),a=this._poly,c=this._poly.spliceLatLngs(a.getLatLngs().length-1,1)[0];this._markerGroup.removeLayer(b);if(a.getLatLngs().length<2){this._map.removeLayer(a)}this._vertexChanged(c,false)},addVertex:function(b){var a=this._markers.length;if(a>0&&!this.options.allowIntersection&&this._poly.newLatLngIntersects(b)){this._showErrorTooltip();return}else{if(this._errorShown){this._hideErrorTooltip()}}this._markers.push(this._createMarker(b));this._poly.addLatLng(b);if(this._poly.getLatLngs().length===2){this._map.addLayer(this._poly)}this._vertexChanged(b,true)},completeShape:function(){if(this._markers.length<=1){return}this._fireCreatedEvent();this.disable();if(this.options.repeatMode){this.enable()}},_finishShape:function(){var a=this._poly.newLatLngIntersects(this._poly.getLatLngs()[this._poly.getLatLngs().length-1]);if((!this.options.allowIntersection&&a)||!this._shapeIsValid()){this._showErrorTooltip();return}this._fireCreatedEvent();this.disable();if(this.options.repeatMode){this.enable()}},_shapeIsValid:function(){return true},_onZoomEnd:function(){if(this._markers!==null){this._updateGuide()}},_onMouseMove:function(b){var a=this._map.mouseEventToLayerPoint(b.originalEvent);var c=this._map.layerPointToLatLng(a);this._currentLatLng=c;this._updateTooltip(c);this._updateGuide(a);this._mouseMarker.setLatLng(c);L.DomEvent.preventDefault(b.originalEvent)},_vertexChanged:function(b,a){this._map.fire("draw:drawvertex",{layers:this._markerGroup});this._updateFinishHandler();this._updateRunningMeasure(b,a);this._clearGuides();this._updateTooltip()},_onMouseDown:function(b){var a=b.originalEvent;this._mouseDownOrigin=L.point(a.clientX,a.clientY)},_onMouseUp:function(a){if(this._mouseDownOrigin){var b=L.point(a.originalEvent.clientX,a.originalEvent.clientY).distanceTo(this._mouseDownOrigin);if(Math.abs(b)<9*(window.devicePixelRatio||1)){this.addVertex(a.latlng)}}this._mouseDownOrigin=null},_onTouch:function(a){if(L.Browser.touch){this._onMouseDown(a);this._onMouseUp(a)}},_onMouseOut:function(){if(this._tooltip){this._tooltip._onMouseOut.call(this._tooltip)}},_updateFinishHandler:function(){var a=this._markers.length;if(a>1){this._markers[a-1].on("click",this._finishShape,this)}if(a>2){this._markers[a-2].off("click",this._finishShape,this)}},_createMarker:function(b){var a=new L.Marker(b,{icon:this.options.icon,zIndexOffset:this.options.zIndexOffset*2});this._markerGroup.addLayer(a);return a},_updateGuide:function(b){var a=this._markers?this._markers.length:0;if(a>0){b=b||this._map.latLngToLayerPoint(this._currentLatLng);this._clearGuides();this._drawGuide(this._map.latLngToLayerPoint(this._markers[a-1].getLatLng()),b)}},_updateTooltip:function(a){var b=this._getTooltipText();if(a){this._tooltip.updatePosition(a)}if(!this._errorShown){this._tooltip.updateContent(b)}},_drawGuide:function(a,j){var b=Math.floor(Math.sqrt(Math.pow((j.x-a.x),2)+Math.pow((j.y-a.y),2))),e=this.options.guidelineDistance,g=this.options.maxGuideLineLength,c=b>g?b-g:e,h,f,d;if(!this._guidesContainer){this._guidesContainer=L.DomUtil.create("div","leaflet-draw-guides",this._overlayPane)}for(;c<b;c+=this.options.guidelineDistance){h=c/b;f={x:Math.floor((a.x*(1-h))+(h*j.x)),y:Math.floor((a.y*(1-h))+(h*j.y))};d=L.DomUtil.create("div","leaflet-draw-guide-dash",this._guidesContainer);d.style.backgroundColor=!this._errorShown?this.options.shapeOptions.color:this.options.drawError.color;L.DomUtil.setPosition(d,f)}},_updateGuideColor:function(b){if(this._guidesContainer){for(var c=0,a=this._guidesContainer.childNodes.length;c<a;c++){this._guidesContainer.childNodes[c].style.backgroundColor=b}}},_clearGuides:function(){if(this._guidesContainer){while(this._guidesContainer.firstChild){this._guidesContainer.removeChild(this._guidesContainer.firstChild)}}},_getTooltipText:function(){var a=this.options.showLength,b,c;if(this._markers.length===0){b={text:L.drawLocal.draw.handlers.polyline.tooltip.start}}else{c=a?this._getMeasurementString():"";if(this._markers.length===1){b={text:L.drawLocal.draw.handlers.polyline.tooltip.cont,subtext:c}}else{b={text:L.drawLocal.draw.handlers.polyline.tooltip.end,subtext:c}}}return b},_updateRunningMeasure:function(e,c){var a=this._markers.length,b,d;if(this._markers.length===1){this._measurementRunningTotal=0}else{b=a-(c?2:1);d=e.distanceTo(this._markers[b].getLatLng());this._measurementRunningTotal+=d*(c?1:-1)}},_getMeasurementString:function(){var b=this._currentLatLng,a=this._markers[this._markers.length-1].getLatLng(),c;c=this._measurementRunningTotal+b.distanceTo(a);return L.GeometryUtil.readableDistance(c,this.options.metric,this.options.feet)},_showErrorTooltip:function(){this._errorShown=true;this._tooltip.showAsError().updateContent({text:this.options.drawError.message});this._updateGuideColor(this.options.drawError.color);this._poly.setStyle({color:this.options.drawError.color});this._clearHideErrorTimeout();this._hideErrorTimeout=setTimeout(L.Util.bind(this._hideErrorTooltip,this),this.options.drawError.timeout)},_hideErrorTooltip:function(){this._errorShown=false;this._clearHideErrorTimeout();this._tooltip.removeError().updateContent(this._getTooltipText());this._updateGuideColor(this.options.shapeOptions.color);this._poly.setStyle({color:this.options.shapeOptions.color})},_clearHideErrorTimeout:function(){if(this._hideErrorTimeout){clearTimeout(this._hideErrorTimeout);this._hideErrorTimeout=null}},_cleanUpShape:function(){if(this._markers.length>1){this._markers[this._markers.length-1].off("click",this._finishShape,this)}},_fireCreatedEvent:function(){var a=new this.Poly(this._poly.getLatLngs(),this.options.shapeOptions);L.Draw.Feature.prototype._fireCreatedEvent.call(this,a)}});L.Draw.Polygon=L.Draw.Polyline.extend({statics:{TYPE:"polygon"},Poly:L.Polygon,options:{showArea:false,shapeOptions:{stroke:true,color:"#f06eaa",weight:4,opacity:0.5,fill:true,fillColor:null,fillOpacity:0.2,clickable:true},metric:true},initialize:function(b,a){L.Draw.Polyline.prototype.initialize.call(this,b,a);this.type=L.Draw.Polygon.TYPE},_updateFinishHandler:function(){var a=this._markers.length;if(a===1){this._markers[0].on("click",this._finishShape,this)}if(a>2){this._markers[a-1].on("dblclick",this._finishShape,this);if(a>3){this._markers[a-2].off("dblclick",this._finishShape,this)}}},_getTooltipText:function(){var b,a;if(this._markers.length===0){b=L.drawLocal.draw.handlers.polygon.tooltip.start}else{if(this._markers.length<3){b=L.drawLocal.draw.handlers.polygon.tooltip.cont}else{b=L.drawLocal.draw.handlers.polygon.tooltip.end;a=this._getMeasurementString()}}return{text:b,subtext:a}},_getMeasurementString:function(){var a=this._area;if(!a){return null}return L.GeometryUtil.readableArea(a,this.options.metric)},_shapeIsValid:function(){return this._markers.length>=3},_vertexChanged:function(c,a){var b;if(!this.options.allowIntersection&&this.options.showArea){b=this._poly.getLatLngs();this._area=L.GeometryUtil.geodesicArea(b)}L.Draw.Polyline.prototype._vertexChanged.call(this,c,a)},_cleanUpShape:function(){var a=this._markers.length;if(a>0){this._markers[0].off("click",this._finishShape,this);if(a>2){this._markers[a-1].off("dblclick",this._finishShape,this)}}}});L.Draw.SimpleShape=L.Draw.Feature.extend({options:{repeatMode:false},initialize:function(b,a){this._endLabelText=L.drawLocal.draw.handlers.simpleshape.tooltip.end;L.Draw.Feature.prototype.initialize.call(this,b,a)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this);if(this._map){this._mapDraggable=this._map.dragging.enabled();if(this._mapDraggable){this._map.dragging.disable()}this._container.style.cursor="crosshair";this._tooltip.updateContent({text:this._initialLabelText});this._map.on("mousedown",this._onMouseDown,this).on("mousemove",this._onMouseMove,this).on("touchstart",this._onMouseDown,this).on("touchmove",this._onMouseMove,this)}},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this);if(this._map){if(this._mapDraggable){this._map.dragging.enable()}this._container.style.cursor="";this._map.off("mousedown",this._onMouseDown,this).off("mousemove",this._onMouseMove,this).off("touchstart",this._onMouseDown,this).off("touchmove",this._onMouseMove,this);L.DomEvent.off(document,"mouseup",this._onMouseUp,this);L.DomEvent.off(document,"touchend",this._onMouseUp,this);if(this._shape){this._map.removeLayer(this._shape);delete this._shape}}this._isDrawing=false},_getTooltipText:function(){return{text:this._endLabelText}},_onMouseDown:function(a){this._isDrawing=true;this._startLatLng=a.latlng;L.DomEvent.on(document,"mouseup",this._onMouseUp,this).on(document,"touchend",this._onMouseUp,this).preventDefault(a.originalEvent)},_onMouseMove:function(a){var b=a.latlng;this._tooltip.updatePosition(b);if(this._isDrawing){this._tooltip.updateContent(this._getTooltipText());this._drawShape(b)}},_onMouseUp:function(){if(this._shape){this._fireCreatedEvent()}this.disable();if(this.options.repeatMode){this.enable()}}});L.Draw.Rectangle=L.Draw.SimpleShape.extend({statics:{TYPE:"rectangle"},options:{shapeOptions:{stroke:true,color:"#f06eaa",weight:4,opacity:0.5,fill:true,fillColor:null,fillOpacity:0.2,clickable:true},metric:true},initialize:function(b,a){this.type=L.Draw.Rectangle.TYPE;this._initialLabelText=L.drawLocal.draw.handlers.rectangle.tooltip.start;L.Draw.SimpleShape.prototype.initialize.call(this,b,a)},_drawShape:function(a){if(!this._shape){this._shape=new L.Rectangle(new L.LatLngBounds(this._startLatLng,a),this.options.shapeOptions);this._map.addLayer(this._shape)}else{this._shape.setBounds(new L.LatLngBounds(this._startLatLng,a))}},_fireCreatedEvent:function(){var a=new L.Rectangle(this._shape.getBounds(),this.options.shapeOptions);L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this,a)},_getTooltipText:function(){var e=L.Draw.SimpleShape.prototype._getTooltipText.call(this),a=this._shape,d,c,b;if(a){d=this._shape.getLatLngs();c=L.GeometryUtil.geodesicArea(d);b=L.GeometryUtil.readableArea(c,this.options.metric)}return{text:e.text,subtext:b}}});L.Draw.Circle=L.Draw.SimpleShape.extend({statics:{TYPE:"circle"},options:{shapeOptions:{stroke:true,color:"#f06eaa",weight:4,opacity:0.5,fill:true,fillColor:null,fillOpacity:0.2,clickable:true},showRadius:true,metric:true,feet:true},initialize:function(b,a){this.type=L.Draw.Circle.TYPE;this._initialLabelText=L.drawLocal.draw.handlers.circle.tooltip.start;L.Draw.SimpleShape.prototype.initialize.call(this,b,a)},_drawShape:function(a){if(!this._shape){this._shape=new L.Circle(this._startLatLng,this._startLatLng.distanceTo(a),this.options.shapeOptions);this._map.addLayer(this._shape)}else{this._shape.setRadius(this._startLatLng.distanceTo(a))}},_fireCreatedEvent:function(){var a=new L.Circle(this._startLatLng,this._shape.getRadius(),this.options.shapeOptions);L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this,a)},_onMouseMove:function(c){var f=c.latlng,b=this.options.showRadius,d=this.options.metric,a;this._tooltip.updatePosition(f);if(this._isDrawing){this._drawShape(f);a=this._shape.getRadius().toFixed(1);this._tooltip.updateContent({text:this._endLabelText,subtext:b?L.drawLocal.draw.handlers.circle.radius+": "+L.GeometryUtil.readableDistance(a,d,this.options.feet):""})}}});L.Draw.Marker=L.Draw.Feature.extend({statics:{TYPE:"marker"},options:{icon:new L.Icon.Default(),repeatMode:false,zIndexOffset:2000},initialize:function(b,a){this.type=L.Draw.Marker.TYPE;L.Draw.Feature.prototype.initialize.call(this,b,a)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this);if(this._map){this._tooltip.updateContent({text:L.drawLocal.draw.handlers.marker.tooltip.start});if(!this._mouseMarker){this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})}this._mouseMarker.on("click",this._onClick,this).addTo(this._map);this._map.on("mousemove",this._onMouseMove,this);this._map.on("click",this._onTouch,this)}},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this);if(this._map){if(this._marker){this._marker.off("click",this._onClick,this);this._map.off("click",this._onClick,this).off("click",this._onTouch,this).removeLayer(this._marker);delete this._marker}this._mouseMarker.off("click",this._onClick,this);this._map.removeLayer(this._mouseMarker);delete this._mouseMarker;this._map.off("mousemove",this._onMouseMove,this)}},_onMouseMove:function(a){var b=a.latlng;this._tooltip.updatePosition(b);this._mouseMarker.setLatLng(b);if(!this._marker){this._marker=new L.Marker(b,{icon:this.options.icon,zIndexOffset:this.options.zIndexOffset});this._marker.on("click",this._onClick,this);this._map.on("click",this._onClick,this).addLayer(this._marker)}else{b=this._mouseMarker.getLatLng();this._marker.setLatLng(b)}},_onClick:function(){this._fireCreatedEvent();this.disable();if(this.options.repeatMode){this.enable()}},_onTouch:function(a){this._onMouseMove(a);this._onClick()},_fireCreatedEvent:function(){var a=new L.Marker(this._marker.getLatLng(),{icon:this.options.icon});L.Draw.Feature.prototype._fireCreatedEvent.call(this,a)}});L.Edit=L.Edit||{};L.Edit.Marker=L.Handler.extend({initialize:function(a,b){this._marker=a;L.setOptions(this,b)},addHooks:function(){var a=this._marker;a.dragging.enable();a.on("dragend",this._onDragEnd,a);this._toggleMarkerHighlight()},removeHooks:function(){var a=this._marker;a.dragging.disable();a.off("dragend",this._onDragEnd,a);this._toggleMarkerHighlight()},_onDragEnd:function(b){var a=b.target;a.edited=true;this._map.fire("draw:editmove",{layer:a})},_toggleMarkerHighlight:function(){var a=this._marker._icon;if(!a){return}a.style.display="none";if(L.DomUtil.hasClass(a,"leaflet-edit-marker-selected")){L.DomUtil.removeClass(a,"leaflet-edit-marker-selected");this._offsetMarker(a,-4)}else{L.DomUtil.addClass(a,"leaflet-edit-marker-selected");this._offsetMarker(a,4)}a.style.display=""},_offsetMarker:function(b,d){var c=parseInt(b.style.marginTop,10)-d,a=parseInt(b.style.marginLeft,10)-d;b.style.marginTop=c+"px";b.style.marginLeft=a+"px"}});L.Marker.addInitHook(function(){if(L.Edit.Marker){this.editing=new L.Edit.Marker(this);if(this.options.editable){this.editing.enable()}}});L.Edit=L.Edit||{};L.Edit.Poly=L.Handler.extend({options:{},initialize:function(b,a){if(b._latlngs.length>1){this.latlngs=[b._latlngs]}else{this.latlngs=b._latlngs}if(b._holes){this.latlngs=this.latlngs.concat(b._holes)}this._poly=b;L.setOptions(this,a);this._poly.on("revert-edited",this._updateLatLngs,this)},_eachVertexHandler:function(b){for(var a=0;a<this._verticesHandlers.length;a++){b(this._verticesHandlers[a])}},addHooks:function(){this._initHandlers();this._eachVertexHandler(function(a){a.addHooks()})},removeHooks:function(){this._eachVertexHandler(function(a){a.removeHooks()})},updateMarkers:function(){this._eachVertexHandler(function(a){a.updateMarkers()})},_initHandlers:function(){this._verticesHandlers=[];for(var a=0;a<this.latlngs.length;a++){this._verticesHandlers.push(new L.Edit.PolyVerticesEdit(this._poly,this.latlngs[a],this.options))}},_updateLatLngs:function(a){this.latlngs=[a.layer._latlngs];if(a.layer._holes){this.latlngs=this.latlngs.concat(a.layer._holes)}}});L.Edit.PolyVerticesEdit=L.Handler.extend({options:{icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),touchIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-touch-icon"}),drawError:{color:"#b00b00",timeout:1000}},initialize:function(c,a,b){if(L.Browser.touch){this.options.icon=this.options.touchIcon}this._poly=c;if(b&&b.drawError){b.drawError=L.Util.extend({},this.options.drawError,b.drawError)}this._latlngs=a;L.setOptions(this,b)},addHooks:function(){var a=this._poly;if(!(a instanceof L.Polygon)){a.options.fill=false}a.setStyle(a.options.editing);if(this._poly._map){this._map=this._poly._map;if(!this._markerGroup){this._initMarkers()}this._poly._map.addLayer(this._markerGroup)}},removeHooks:function(){var a=this._poly;a.setStyle(a.options.original);if(a._map){a._map.removeLayer(this._markerGroup);delete this._markerGroup;delete this._markers}},updateMarkers:function(){this._markerGroup.clearLayers();this._initMarkers()},_initMarkers:function(){if(!this._markerGroup){this._markerGroup=new L.LayerGroup()}this._markers=[];var b=this._latlngs,g,f,a,c;for(g=0,a=b.length;g<a;g++){c=this._createMarker(b[g],g);c.on("click",this._onMarkerClick,this);this._markers.push(c)}var e,d;for(g=0,f=a-1;g<a;f=g++){if(g===0&&!(L.Polygon&&(this._poly instanceof L.Polygon))){continue}e=this._markers[f];d=this._markers[g];this._createMiddleMarker(e,d);this._updatePrevNext(e,d)}},_createMarker:function(c,b){var a=new L.Marker(c,{draggable:true,icon:this.options.icon,});a._origLatLng=c;a._index=b;a.on("dragstart",this._onMarkerDragStart,this).on("drag",this._onMarkerDrag,this).on("dragend",this._fireEdit,this).on("touchmove",this._onTouchMove,this).on("MSPointerMove",this._onTouchMove,this).on("touchend",this._fireEdit,this).on("MSPointerUp",this._fireEdit,this);this._markerGroup.addLayer(a);return a},_onMarkerDragStart:function(){this._poly.fire("editstart")},_spliceLatLngs:function(){var a=[].splice.apply(this._latlngs,arguments);this._poly._convertLatLngs(this._latlngs,true);this._poly.redraw();return a},_removeMarker:function(a){var b=a._index;this._markerGroup.removeLayer(a);this._markers.splice(b,1);this._spliceLatLngs(b,1);this._updateIndexes(b,-1);a.off("dragstart",this._onMarkerDragStart,this).off("drag",this._onMarkerDrag,this).off("dragend",this._fireEdit,this).off("touchmove",this._onMarkerDrag,this).off("touchend",this._fireEdit,this).off("click",this._onMarkerClick,this).off("MSPointerMove",this._onTouchMove,this).off("MSPointerUp",this._fireEdit,this)},_fireEdit:function(){this._poly.edited=true;this._poly.fire("edit");this._poly._map.fire("draw:editvertex",{layers:this._markerGroup})},_onMarkerDrag:function(f){var a=f.target;var d=this._poly;L.extend(a._origLatLng,a._latlng);if(a._middleLeft){a._middleLeft.setLatLng(this._getMiddleLatLng(a._prev,a))}if(a._middleRight){a._middleRight.setLatLng(this._getMiddleLatLng(a,a._next))}if(d.options.poly){var c=d._map._editTooltip;if(!d.options.poly.allowIntersection&&d.intersects()){var b=d.options.color;d.setStyle({color:this.options.drawError.color});if(c){c.updateContent({text:L.drawLocal.draw.handlers.polyline.error})}setTimeout(function(){d.setStyle({color:b});if(c){c.updateContent({text:L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.edit.handlers.edit.tooltip.subtext})}},1000);this._onMarkerClick(f)}}this._poly.redraw();this._poly.fire("editdrag")},_onMarkerClick:function(c){var b=L.Polygon&&(this._poly instanceof L.Polygon)?4:3,a=c.target;if(this._latlngs.length<b){return}this._removeMarker(a);this._updatePrevNext(a._prev,a._next);if(a._middleLeft){this._markerGroup.removeLayer(a._middleLeft)}if(a._middleRight){this._markerGroup.removeLayer(a._middleRight)}if(a._prev&&a._next){this._createMiddleMarker(a._prev,a._next)}else{if(!a._prev){a._next._middleLeft=null}else{if(!a._next){a._prev._middleRight=null}}}this._fireEdit()},_onTouchMove:function(c){var b=this._map.mouseEventToLayerPoint(c.originalEvent.touches[0]),d=this._map.layerPointToLatLng(b),a=c.target;L.extend(a._origLatLng,d);if(a._middleLeft){a._middleLeft.setLatLng(this._getMiddleLatLng(a._prev,a))}if(a._middleRight){a._middleRight.setLatLng(this._getMiddleLatLng(a,a._next))}this._poly.redraw();this.updateMarkers()},_updateIndexes:function(a,b){this._markerGroup.eachLayer(function(c){if(c._index>a){c._index+=b}})},_createMiddleMarker:function(f,d){var g=this._getMiddleLatLng(f,d),a=this._createMarker(g),e,c,b;a.setOpacity(0.6);f._middleRight=d._middleLeft=a;c=function(){a.off("touchmove",c,this);var h=d._index;a._index=h;a.off("click",e,this).on("click",this._onMarkerClick,this);g.lat=a.getLatLng().lat;g.lng=a.getLatLng().lng;this._spliceLatLngs(h,0,g);this._markers.splice(h,0,a);a.setOpacity(1);this._updateIndexes(h,1);d._index++;this._updatePrevNext(f,a);this._updatePrevNext(a,d);this._poly.fire("editstart")};b=function(){a.off("dragstart",c,this);a.off("dragend",b,this);a.off("touchmove",c,this);this._createMiddleMarker(f,a);this._createMiddleMarker(a,d)};e=function(){c.call(this);b.call(this);this._fireEdit()};a.on("click",e,this).on("dragstart",c,this).on("dragend",b,this).on("touchmove",c,this);this._markerGroup.addLayer(a)},_updatePrevNext:function(b,a){if(b){b._next=a}if(a){a._prev=b}},_getMiddleLatLng:function(e,c){var b=this._poly._map,d=b.project(e.getLatLng()),a=b.project(c.getLatLng());return b.unproject(d._add(a)._divideBy(2))}});L.Polyline.addInitHook(function(){if(this.editing){return}if(L.Edit.Poly){this.editing=new L.Edit.Poly(this,this.options.poly);if(this.options.editable){this.editing.enable()}}this.on("add",function(){if(this.editing&&this.editing.enabled()){this.editing.addHooks()}});this.on("remove",function(){if(this.editing&&this.editing.enabled()){this.editing.removeHooks()}})});L.Edit=L.Edit||{};L.Edit.SimpleShape=L.Handler.extend({options:{moveIcon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-move"}),resizeIcon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-resize"}),touchMoveIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-move leaflet-touch-icon"}),touchResizeIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-resize leaflet-touch-icon"}),},initialize:function(a,b){if(L.Browser.touch){this.options.moveIcon=this.options.touchMoveIcon;this.options.resizeIcon=this.options.touchResizeIcon}this._shape=a;L.Util.setOptions(this,b)},addHooks:function(){var a=this._shape;if(this._shape._map){this._map=this._shape._map;a.setStyle(a.options.editing);if(a._map){this._map=a._map;if(!this._markerGroup){this._initMarkers()}this._map.addLayer(this._markerGroup)}}},removeHooks:function(){var b=this._shape;b.setStyle(b.options.original);if(b._map){this._unbindMarker(this._moveMarker);for(var c=0,a=this._resizeMarkers.length;c<a;c++){this._unbindMarker(this._resizeMarkers[c])}this._resizeMarkers=null;this._map.removeLayer(this._markerGroup);delete this._markerGroup}this._map=null},updateMarkers:function(){this._markerGroup.clearLayers();this._initMarkers()},_initMarkers:function(){if(!this._markerGroup){this._markerGroup=new L.LayerGroup()}this._createMoveMarker();this._createResizeMarker()},_createMoveMarker:function(){},_createResizeMarker:function(){},_createMarker:function(c,b){var a=new L.Marker(c,{draggable:true,icon:b,zIndexOffset:10});this._bindMarker(a);this._markerGroup.addLayer(a);return a},_bindMarker:function(a){a.on("dragstart",this._onMarkerDragStart,this).on("drag",this._onMarkerDrag,this).on("dragend",this._onMarkerDragEnd,this).on("touchstart",this._onTouchStart,this).on("touchmove",this._onTouchMove,this).on("MSPointerMove",this._onTouchMove,this).on("touchend",this._onTouchEnd,this).on("MSPointerUp",this._onTouchEnd,this)},_unbindMarker:function(a){a.off("dragstart",this._onMarkerDragStart,this).off("drag",this._onMarkerDrag,this).off("dragend",this._onMarkerDragEnd,this).off("touchstart",this._onTouchStart,this).off("touchmove",this._onTouchMove,this).off("MSPointerMove",this._onTouchMove,this).off("touchend",this._onTouchEnd,this).off("MSPointerUp",this._onTouchEnd,this)},_onMarkerDragStart:function(b){var a=b.target;a.setOpacity(0);this._shape.fire("editstart")},_fireEdit:function(){this._shape.edited=true;this._shape.fire("edit")},_onMarkerDrag:function(b){var a=b.target,c=a.getLatLng();if(a===this._moveMarker){this._move(c)}else{this._resize(c)}this._shape.redraw();this._shape.fire("editdrag")},_onMarkerDragEnd:function(b){var a=b.target;a.setOpacity(1);this._fireEdit()},_onTouchStart:function(d){L.Edit.SimpleShape.prototype._onMarkerDragStart.call(this,d);if(typeof(this._getCorners)==="function"){var b=this._getCorners(),a=d.target,c=a._cornerIndex;a.setOpacity(0);this._oppositeCorner=b[(c+2)%4];this._toggleCornerMarkers(0,c)}this._shape.fire("editstart")},_onTouchMove:function(c){var b=this._map.mouseEventToLayerPoint(c.originalEvent.touches[0]),d=this._map.layerPointToLatLng(b),a=c.target;if(a===this._moveMarker){this._move(d)}else{this._resize(d)}this._shape.redraw();return false},_onTouchEnd:function(b){var a=b.target;a.setOpacity(1);this.updateMarkers();this._fireEdit()},_move:function(){},_resize:function(){}});L.Edit=L.Edit||{};L.Edit.Rectangle=L.Edit.SimpleShape.extend({_createMoveMarker:function(){var b=this._shape.getBounds(),a=b.getCenter();this._moveMarker=this._createMarker(a,this.options.moveIcon)},_createResizeMarker:function(){var b=this._getCorners();this._resizeMarkers=[];for(var c=0,a=b.length;c<a;c++){this._resizeMarkers.push(this._createMarker(b[c],this.options.resizeIcon));this._resizeMarkers[c]._cornerIndex=c}},_onMarkerDragStart:function(d){L.Edit.SimpleShape.prototype._onMarkerDragStart.call(this,d);var b=this._getCorners(),a=d.target,c=a._cornerIndex;this._oppositeCorner=b[(c+2)%4];this._toggleCornerMarkers(0,c)},_onMarkerDragEnd:function(d){var b=d.target,c,a;if(b===this._moveMarker){c=this._shape.getBounds();a=c.getCenter();b.setLatLng(a)}this._toggleCornerMarkers(1);this._repositionCornerMarkers();L.Edit.SimpleShape.prototype._onMarkerDragEnd.call(this,d)},_move:function(d){var b=this._shape.getLatLngs(),g=this._shape.getBounds(),a=g.getCenter(),h,f=[];for(var e=0,c=b.length;e<c;e++){h=[b[e].lat-a.lat,b[e].lng-a.lng];f.push([d.lat+h[0],d.lng+h[1]])}this._shape.setLatLngs(f);this._repositionCornerMarkers();this._map.fire("draw:editmove",{layer:this._shape})},_resize:function(b){var a;this._shape.setBounds(L.latLngBounds(b,this._oppositeCorner));a=this._shape.getBounds();this._moveMarker.setLatLng(a.getCenter());this._map.fire("draw:editresize",{layer:this._shape})},_getCorners:function(){var c=this._shape.getBounds(),b=c.getNorthWest(),e=c.getNorthEast(),d=c.getSouthEast(),a=c.getSouthWest();return[b,e,d,a]},_toggleCornerMarkers:function(b){for(var c=0,a=this._resizeMarkers.length;c<a;c++){this._resizeMarkers[c].setOpacity(b)}},_repositionCornerMarkers:function(){var b=this._getCorners();for(var c=0,a=this._resizeMarkers.length;c<a;c++){this._resizeMarkers[c].setLatLng(b[c])}}});L.Rectangle.addInitHook(function(){if(L.Edit.Rectangle){this.editing=new L.Edit.Rectangle(this);if(this.options.editable){this.editing.enable()}}});L.Edit=L.Edit||{};L.Edit.Circle=L.Edit.SimpleShape.extend({_createMoveMarker:function(){var a=this._shape.getLatLng();this._moveMarker=this._createMarker(a,this.options.moveIcon)},_createResizeMarker:function(){var a=this._shape.getLatLng(),b=this._getResizeMarkerPoint(a);this._resizeMarkers=[];this._resizeMarkers.push(this._createMarker(b,this.options.resizeIcon))},_getResizeMarkerPoint:function(c){var b=this._shape._radius*Math.cos(Math.PI/4),a=this._map.project(c);return this._map.unproject([a.x+b,a.y-b])},_move:function(b){var a=this._getResizeMarkerPoint(b);this._resizeMarkers[0].setLatLng(a);this._shape.setLatLng(b);this._map.fire("draw:editmove",{layer:this._shape})},_resize:function(c){var b=this._moveMarker.getLatLng(),a=b.distanceTo(c);this._shape.setRadius(a);this._map.fire("draw:editresize",{layer:this._shape})}});L.Circle.addInitHook(function(){if(L.Edit.Circle){this.editing=new L.Edit.Circle(this);if(this.options.editable){this.editing.enable()}}this.on("add",function(){if(this.editing&&this.editing.enabled()){this.editing.addHooks()}});this.on("remove",function(){if(this.editing&&this.editing.enabled()){this.editing.removeHooks()}})});L.Tooltip=L.Class.extend({initialize:function(a){this._map=a;this._popupPane=a._panes.popupPane;this._container=a.options.drawControlTooltips?L.DomUtil.create("div","leaflet-draw-tooltip",this._popupPane):null;this._singleLineLabel=false;this._map.on("mouseout",this._onMouseOut,this)},dispose:function(){this._map.off("mouseout",this._onMouseOut,this);if(this._container){this._popupPane.removeChild(this._container);this._container=null}},updateContent:function(a){if(!this._container){return this}a.subtext=a.subtext||"";if(a.subtext.length===0&&!this._singleLineLabel){L.DomUtil.addClass(this._container,"leaflet-draw-tooltip-single");this._singleLineLabel=true}else{if(a.subtext.length>0&&this._singleLineLabel){L.DomUtil.removeClass(this._container,"leaflet-draw-tooltip-single");this._singleLineLabel=false}}this._container.innerHTML=(a.subtext.length>0?'<span class="leaflet-draw-tooltip-subtext">'+a.subtext+"</span><br />":"")+"<span>"+a.text+"</span>";return this},updatePosition:function(c){var b=this._map.latLngToLayerPoint(c),a=this._container;if(this._container){a.style.visibility="inherit";L.DomUtil.setPosition(a,b)}return this},showAsError:function(){if(this._container){L.DomUtil.addClass(this._container,"leaflet-error-draw-tooltip")}return this},removeError:function(){if(this._container){L.DomUtil.removeClass(this._container,"leaflet-error-draw-tooltip")}return this},_onMouseOut:function(){if(this._container){this._container.style.visibility="hidden"}}});L.Map.mergeOptions({drawControlTooltips:true});L.EditTool=L.EditTool||{};L.EditTool.Edit=L.Handler.extend({statics:{TYPE:"edit"},includes:L.Mixin.Events,initialize:function(b,a){L.Handler.prototype.initialize.call(this,b);L.setOptions(this,a);this._featureGroup=a.featureGroup;if(!(this._featureGroup instanceof L.FeatureGroup)){throw new Error("options.featureGroup must be a L.FeatureGroup")}this._uneditedLayerProps={};this.type=L.EditTool.Edit.TYPE},enable:function(){if(this._enabled||!this._hasAvailableLayers()){return}this.fire("enabled",{handler:this.type});this._map.fire("draw:editstart",{handler:this.type});L.Handler.prototype.enable.call(this);this._featureGroup.on("layeradd",this._enableLayerEdit,this).on("layerremove",this._disableLayerEdit,this)},disable:function(){if(!this._enabled){return}this._featureGroup.off("layeradd",this._enableLayerEdit,this).off("layerremove",this._disableLayerEdit,this);L.Handler.prototype.disable.call(this);this._map.fire("draw:editstop",{handler:this.type});this.fire("disabled",{handler:this.type})},addHooks:function(){var a=this._map;if(a){a.getContainer().focus();this._featureGroup.eachLayer(this._enableLayerEdit,this);this._tooltip=new L.Tooltip(this._map);this._tooltip.updateContent({text:L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.edit.handlers.edit.tooltip.subtext});a._editTooltip=this._tooltip;this._updateTooltip();this._map.on("mousemove",this._onMouseMove,this).on("touchmove",this._onMouseMove,this).on("MSPointerMove",this._onMouseMove,this).on("click",this._editStyle,this).on("draw:editvertex",this._updateTooltip,this)}},removeHooks:function(){if(this._map){this._featureGroup.eachLayer(this._disableLayerEdit,this);this._uneditedLayerProps={};this._tooltip.dispose();this._tooltip=null;this._map.off("mousemove",this._onMouseMove,this).off("touchmove",this._onMouseMove,this).off("MSPointerMove",this._onMouseMove,this).off("click",this._editStyle,this).off("draw:editvertex",this._updateTooltip,this)}},revertLayers:function(){this._featureGroup.eachLayer(function(a){this._revertLayer(a)},this)},save:function(){var a=new L.LayerGroup();this._featureGroup.eachLayer(function(b){if(b.edited){a.addLayer(b);b.edited=false}});this._map.fire("draw:edited",{layers:a})},_backupLayer:function(a){var b=L.Util.stamp(a);if(!this._uneditedLayerProps[b]){if(a instanceof L.Polyline||a instanceof L.Polygon||a instanceof L.Rectangle){this._uneditedLayerProps[b]={latlngs:L.LatLngUtil.cloneLatLngs(a.getLatLngs())}}else{if(a instanceof L.Circle){this._uneditedLayerProps[b]={latlng:L.LatLngUtil.cloneLatLng(a.getLatLng()),radius:a.getRadius()}}else{if(a instanceof L.Marker){this._uneditedLayerProps[b]={latlng:L.LatLngUtil.cloneLatLng(a.getLatLng())}}}}}},_getTooltipText:function(){return({text:L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.edit.handlers.edit.tooltip.subtext})},_updateTooltip:function(){this._tooltip.updateContent(this._getTooltipText())},_revertLayer:function(a){var b=L.Util.stamp(a);a.edited=false;if(this._uneditedLayerProps.hasOwnProperty(b)){if(a instanceof L.Polyline||a instanceof L.Polygon||a instanceof L.Rectangle){a.setLatLngs(this._uneditedLayerProps[b].latlngs)}else{if(a instanceof L.Circle){a.setLatLng(this._uneditedLayerProps[b].latlng);a.setRadius(this._uneditedLayerProps[b].radius)}else{if(a instanceof L.Marker){a.setLatLng(this._uneditedLayerProps[b].latlng)}}}a.fire("revert-edited",{layer:a})}},_enableLayerEdit:function(d){var b=d.layer||d.target||d,a,c;this._backupLayer(b);if(this.options.poly){c=L.Util.extend({},this.options.poly);b.options.poly=c}if(this.options.selectedPathOptions){a=L.Util.extend({},this.options.selectedPathOptions);if(a.maintainColor){a.color=b.options.color;a.fillColor=b.options.fillColor}b.options.original=L.extend({},b.options);b.options.editing=a}if(this.isMarker){b.dragging.enable();b.on("dragend",this._onMarkerDragEnd).on("touchmove",this._onTouchMove,this).on("MSPointerMove",this._onTouchMove,this).on("touchend",this._onMarkerDragEnd,this).on("MSPointerUp",this._onMarkerDragEnd,this)}else{b.editing.enable()}},_disableLayerEdit:function(b){var a=b.layer||b.target||b;a.edited=false;a.editing.disable();delete a.options.editing;delete a.options.original;if(this._selectedPathOptions){if(a instanceof L.Marker){this._toggleMarkerHighlight(a)}else{a.setStyle(a.options.previousOptions);delete a.options.previousOptions}}if(a instanceof L.Marker){a.dragging.disable();a.off("dragend",this._onMarkerDragEnd,this).off("touchmove",this._onTouchMove,this).off("MSPointerMove",this._onTouchMove,this).off("touchend",this._onMarkerDragEnd,this).off("MSPointerUp",this._onMarkerDragEnd,this)}else{a.editing.disable()}},_onMouseMove:function(a){this._tooltip.updatePosition(a.latlng)},_onTouchMove:function(c){var a=c.originalEvent.changedTouches[0],b=this._map.mouseEventToLayerPoint(a),d=this._map.layerPointToLatLng(b);c.target.setLatLng(d)},_hasAvailableLayers:function(){return this._featureGroup.getLayers().length!==0}});L.EditTool.Delete=L.Handler.extend({statics:{TYPE:"remove"},includes:L.Mixin.Events,initialize:function(b,a){L.Handler.prototype.initialize.call(this,b);L.Util.setOptions(this,a);this._deletableLayers=this.options.featureGroup;if(!(this._deletableLayers instanceof L.FeatureGroup)){throw new Error("options.featureGroup must be a L.FeatureGroup")}this.type=L.EditTool.Delete.TYPE},enable:function(){if(this._enabled||!this._hasAvailableLayers()){return}this.fire("enabled",{handler:this.type});this._map.fire("draw:deletestart",{handler:this.type});L.Handler.prototype.enable.call(this);this._deletableLayers.on("layeradd",this._enableLayerDelete,this).on("layerremove",this._disableLayerDelete,this)},disable:function(){if(!this._enabled){return}this._deletableLayers.off("layeradd",this._enableLayerDelete,this).off("layerremove",this._disableLayerDelete,this);L.Handler.prototype.disable.call(this);this._map.fire("draw:deletestop",{handler:this.type});this.fire("disabled",{handler:this.type})},addHooks:function(){var a=this._map;if(a){a.getContainer().focus();this._deletableLayers.eachLayer(this._enableLayerDelete,this);this._deletedLayers=new L.LayerGroup();this._tooltip=new L.Tooltip(this._map);this._tooltip.updateContent({text:L.drawLocal.edit.handlers.remove.tooltip.text});this._map.on("mousemove",this._onMouseMove,this)}},removeHooks:function(){if(this._map){this._deletableLayers.eachLayer(this._disableLayerDelete,this);this._deletedLayers=null;this._tooltip.dispose();this._tooltip=null;this._map.off("mousemove",this._onMouseMove,this)}},revertLayers:function(){this._deletedLayers.eachLayer(function(a){this._deletableLayers.addLayer(a);a.fire("revert-deleted",{layer:a})},this)},save:function(){this._map.fire("draw:deleted",{layers:this._deletedLayers})},_enableLayerDelete:function(b){var a=b.layer||b.target||b;a.on("click",this._removeLayer,this)},_disableLayerDelete:function(b){var a=b.layer||b.target||b;a.off("click",this._removeLayer,this);this._deletedLayers.removeLayer(a)},_removeLayer:function(b){var a=b.layer||b.target||b;this._deletableLayers.removeLayer(a);this._deletedLayers.addLayer(a);a.fire("deleted")},_onMouseMove:function(a){this._tooltip.updatePosition(a.latlng)},_hasAvailableLayers:function(){return this._deletableLayers.getLayers().length!==0}});L.Measure=L.Measure||{};L.Measure.Path=L.Draw.Polyline.extend({initialize:function(b,a){L.Draw.Polyline.prototype.initialize.call(this,b,a);this._cache=[]},addHooks:function(){L.Draw.Polyline.prototype.addHooks.call(this);if(this._map){this._markerGroup=new L.LayerGroup();this._map.addLayer(this._markerGroup);this._markers=[];this._popups=[];this._map.on("click",this._onClick,this);this._startShape()}},removeHooks:function(){this._clearHideErrorTimeout();this._mouseMarker.off("mousedown",this._onMouseDown,this).off("mouseout",this._onMouseOut,this).off("mouseup",this._onMouseUp,this).off("mousemove",this._onMouseMove,this);this._map.removeLayer(this._mouseMarker);delete this._mouseMarker;this._map.off("pointermove",this._onMouseMove,this).off("mousemove",this._onMouseMove,this).off("click",this._onClick,this);this._clearGuides();this._container.style.cursor="";this._tooltip.dispose()},_startShape:function(){this._drawing=true;this._poly=new L.Polyline([],this.options.shapeOptions);this._poly._onClick=function(){};this._container.style.cursor="crosshair";this._updateTooltip();this._map.on("pointermove",this._onMouseMove,this).on("mousemove",this._onMouseMove,this)},_finishShape:function(){this._drawing=false;this._cleanUpShape();this._clearGuides();this._updateTooltip();this._map.off("pointermove",this._onMouseMove,this).off("mousemove",this._onMouseMove,this);this._container.style.cursor="";this.disable();var c=L.stamp(this._poly);var d="measure-"+c;var b={id:d,popups:this._popups,markers:this._markers,poly:this._poly};this._cache.push(b);if(this._tippopup){var e=this._tippopup.getContent();var f=L.DomUtil.create("div","leaflet-measure-tipclose");f.id=d;f.title="";this._tippopup._contentNode.appendChild(f);var a=this._tippopup._contentNode.offsetWidth;this._tippopup._contentNode.style.width=(a+30)+"px";L.DomEvent.on(f,"click",this._onTipClose,this)}},_removeShape:function(){if(!this._poly){return}this._map.removeLayer(this._poly);delete this._poly;this._markers.splice(0);this._markerGroup.clearLayers()},_onClick:function(){if(!this._drawing){this._removeShape();this._startShape();return}},_getTooltipText:function(){var a=L.Draw.Polyline.prototype._getTooltipText.call(this);if(!this._drawing){a.text=""}return a},addVertex:function(g){var d=this._markers.length;if(d>0&&!this.options.allowIntersection&&this._poly.newLatLngIntersects(g)){this._showErrorTooltip();return}else{if(this._errorShown){this._hideErrorTooltip()}}var c=this._createMarker(g);L.DomEvent.on(c,"dblclick",this._preventMouseEvent,this);var f=this._getTooltipText();var e="";var b;if(f.subtext){e=f.subtext;b=46}else{e="";b=40}var a=new L.TipPopup({offset:new L.Point(b,24)});a.setLatLng(g).setContent(e).openOn(this._map);a._sort="tip-popup";this._tippopup=a;this._popups.push(a);this._markers.push(c);this._poly.addLatLng(g);if(this._poly.getLatLngs().length===2){this._map.addLayer(this._poly)}this._vertexChanged(g,true)},_onTipClose:function(h){var f=h.target||h.srcElement;var d=f.id;var a=this._getCacheById(d);if(a){var b=a.popups;var j=a.markers;var g=a.poly;this._map.removeLayer(g);for(var c=0;c<j.length;c++){if(j[c]&&b[c]){this._map.removeLayer(j[c]);this._map.removeLayer(b[c])}}this._deleteCacheById(d)}},_getCacheById:function(c){var a;for(var b=0;b<this._cache.length;b++){if(this._cache[b].id==c){a=this._cache[b];break}}return a},_deleteCacheById:function(b){for(var a=this._cache.length-1;a>=0;a--){if(this._cache[a].id==b){this._cache.splice(a,1);break}}},_preventMouseEvent:function(a){if(a.type==="contextmenu"&&this.hasEventListeners(a.type)){L.DomEvent.preventDefault(a)}if(a.type!=="mousedown"){L.DomEvent.stopPropagation(a)}else{L.DomEvent.preventDefault(a)}},clear:function(){var a=this._cache;for(var c=0;c<a.length;c++){var b=a[c];var d=b.popups;var g=b.markers;var f=b.poly;this._map.removeLayer(f);for(var e=0;e<g.length;e++){if(g[e]&&d[e]){this._map.removeLayer(g[e]);this._map.removeLayer(d[e])}}}this._popups=[];this._markers=[];this._poly=null;this._cache=[]}});L.Measure=L.Measure||{};L.Measure.Area=L.Draw.Polygon.extend({options:{showArea:true,shapeOptions:{stroke:true,color:"#f06eaa",weight:4,opacity:0.5,fill:true,fillColor:null,fillOpacity:0.2,clickable:true},metric:true},initialize:function(b,a){L.Draw.Polygon.prototype.initialize.call(this,b,a);this._cache=[]},addHooks:function(){L.Draw.Polygon.prototype.addHooks.call(this);if(this._map&&!this._areaGroup){this._areaGroup=new L.LayerGroup();this._map.addLayer(this._areaGroup)}},removeHooks:function(){this._clearHideErrorTimeout();this._cleanUpShape();this._map.removeLayer(this._markerGroup);delete this._markerGroup;delete this._markers;this._map.removeLayer(this._poly);delete this._poly;this._mouseMarker.off("mousedown",this._onMouseDown,this).off("mouseout",this._onMouseOut,this).off("mouseup",this._onMouseUp,this).off("mousemove",this._onMouseMove,this);this._map.removeLayer(this._mouseMarker);delete this._mouseMarker;this._clearGuides();this._map.off("mouseup",this._onMouseUp,this).off("mousemove",this._onMouseMove,this).off("zoomlevelschange",this._onZoomEnd,this).off("zoomend",this._onZoomEnd,this).off("click",this._onTouch,this);this._container.style.cursor="";this._tooltip.dispose()},_finishShape:function(){this._cleanUpShape();this._clearGuides();var b=this._poly.getLatLngs();var l=b[b.length-1];var h=this._poly.newLatLngIntersects(l);if((!this.options.allowIntersection&&h)||!this._shapeIsValid()){this._showErrorTooltip();return}var f=L.GeometryUtil.geodesicArea(b);f=L.GeometryUtil.readableArea(f,this.options.metric);var c=new this.Poly(this._poly.getLatLngs(),this.options.shapeOptions);this._areaGroup.addLayer(c);var d=L.stamp(c);var g="measure-"+d;var e=new L.TipPopup({offset:new L.Point(36,-4)});e.setLatLng(l).setContent(f).openOn(this._map);e._sort="tip-popup";var i=e.getContent();var j=L.DomUtil.create("div","leaflet-measure-tipclose");j.id=g;j.title="";e._contentNode.appendChild(j);var k=e._contentNode.offsetWidth;e._contentNode.style.width=(k+30)+"px";L.DomEvent.on(j,"click",this._onTipClose,this);var a={id:g,popup:e,poly:c};this._cache.push(a);this.disable()},_onTipClose:function(g){var d=g.target||g.srcElement;var c=d.id;var b=this._getCacheById(c);if(b){var a=b.popup;var f=b.poly;this._map.removeLayer(f);this._map.removeLayer(a);this._deleteCacheById(c)}},_getCacheById:function(c){var a;for(var b=0;b<this._cache.length;b++){if(this._cache[b].id==c){a=this._cache[b];break}}return a},_deleteCacheById:function(b){for(var a=this._cache.length-1;a>=0;a--){if(this._cache[a].id==b){this._cache.splice(a,1);break}}},clear:function(){var b=this._cache;for(var d=0;d<b.length;d++){var c=b[d];var a=c.popup;var e=c.poly;this._map.removeLayer(e);this._map.removeLayer(a)}this._cache=[]}});L.Knob=L.Draggable.extend({initialize:function(b,c,a){L.Draggable.prototype.initialize.call(this,b,b);this._element=b;this._stepHeight=c;this._knobHeight=a;this.on("predrag",function(){this._newPos.x=0;this._newPos.y=this._adjust(this._newPos.y)},this)},_adjust:function(b){var a=Math.round(this._toValue(b));a=Math.max(0,Math.min(this._maxValue,a));return this._toY(a)},_toY:function(a){return this._k*a+this._m},_toValue:function(a){return(a-this._m)/this._k},setSteps:function(a){var b=a*this._stepHeight;this._maxValue=a-1;this._k=-this._stepHeight;this._m=b-(this._stepHeight+this._knobHeight)/2},setPosition:function(a){L.DomUtil.setPosition(this._element,L.point(0,this._adjust(a)))},setValue:function(a){this.setPosition(this._toY(a))},getValue:function(){return this._toValue(L.DomUtil.getPosition(this._element).y)}});L.Control.Zoomslider=L.Control.extend({options:{position:"topleft",stepHeight:8,knobHeight:6,styleNS:"leaflet-control-zoomslider"},onAdd:function(a){this._map=a;this._ui=this._createUI();this._knob=new L.Knob(this._ui.knob,this.options.stepHeight,this.options.knobHeight);a.whenReady(this._initKnob,this).whenReady(this._initEvents,this).whenReady(this._updateSize,this).whenReady(this._updateKnobValue,this).whenReady(this._updateDisabled,this);return this._ui.bar},onRemove:function(a){a.off("zoomlevelschange",this._updateSize,this).off("zoomend zoomlevelschange",this._updateKnobValue,this).off("zoomend zoomlevelschange",this._updateDisabled,this)},_createUI:function(){var b={},a=this.options.styleNS;b.bar=L.DomUtil.create("div",a+" leaflet-bar");b.zoomIn=this._createZoomBtn("in","top",b.bar);b.wrap=L.DomUtil.create("div",a+"-wrap leaflet-bar-part",b.bar);b.zoomOut=this._createZoomBtn("out","bottom",b.bar);b.body=L.DomUtil.create("div",a+"-body",b.wrap);b.knob=L.DomUtil.create("div",a+"-knob");L.DomEvent.disableClickPropagation(b.bar);L.DomEvent.disableClickPropagation(b.knob);return b},_createZoomBtn:function(c,b,a){var d=this.options.styleNS+"-"+c+" leaflet-bar-part leaflet-bar-part-"+b,e=L.DomUtil.create("a",d,a);e.href="#";if(c=="in"){e.title=""}else{e.title=""}L.DomEvent.on(e,"click",L.DomEvent.preventDefault);return e},_initKnob:function(){this._knob.enable();this._ui.body.appendChild(this._ui.knob)},_initEvents:function(){this._map.on("zoomlevelschange",this._updateSize,this).on("zoomend zoomlevelschange",this._updateKnobValue,this).on("zoomend zoomlevelschange",this._updateDisabled,this);L.DomEvent.on(this._ui.body,"click",this._onSliderClick,this);L.DomEvent.on(this._ui.zoomIn,"click",this._zoomIn,this);L.DomEvent.on(this._ui.zoomOut,"click",this._zoomOut,this);this._knob.on("dragend",this._updateMapZoom,this)},_onSliderClick:function(a){var b=(a.touches&&a.touches.length===1?a.touches[0]:a),c=L.DomEvent.getMousePosition(b,this._ui.body).y;this._knob.setPosition(c);this._updateMapZoom()},_zoomIn:function(a){this._map.zoomIn(a.shiftKey?3:1)},_zoomOut:function(a){this._map.zoomOut(a.shiftKey?3:1)},_zoomLevels:function(){var a=this._map.getMaxZoom()-this._map.getMinZoom()+1;return a<Infinity?a:0},_toZoomLevel:function(a){return a+this._map.getMinZoom()},_toValue:function(a){return a-this._map.getMinZoom()},_updateSize:function(){var a=this._zoomLevels();this._ui.body.style.height=this.options.stepHeight*a+"px";this._knob.setSteps(a)},_updateMapZoom:function(){this._map.setZoom(this._toZoomLevel(this._knob.getValue()))},_updateKnobValue:function(){this._knob.setValue(this._toValue(this._map.getZoom()))},_updateDisabled:function(){var b=this._map.getZoom(),a=this.options.styleNS+"-disabled";L.DomUtil.removeClass(this._ui.zoomIn,a);L.DomUtil.removeClass(this._ui.zoomOut,a);if(b===this._map.getMinZoom()){L.DomUtil.addClass(this._ui.zoomOut,a)}if(b===this._map.getMaxZoom()){L.DomUtil.addClass(this._ui.zoomIn,a)}}});L.control.zoomslider=function(a){return new L.Control.Zoomslider(a)};L.Control.MousePosition=L.Control.extend({options:{position:"bottomleft",separator:" : ",emptyString:"Unavailable",lngFirst:true,numDigits:5,lngFormatter:undefined,latFormatter:undefined,prefix:""},onAdd:function(a){this._container=L.DomUtil.create("div","leaflet-control-mouseposition");L.DomEvent.disableClickPropagation(this._container);a.on("mousemove",this._onMouseMove,this);this._container.innerHTML=this.options.emptyString;return this._container},onRemove:function(a){a.off("mousemove",this._onMouseMove)},_onMouseMove:function(f){var b=this.options.lngFormatter?this.options.lngFormatter(f.latlng.lng):L.Util.formatNum(f.latlng.lng,this.options.numDigits);var d=this.options.latFormatter?this.options.latFormatter(f.latlng.lat):L.Util.formatNum(f.latlng.lat,this.options.numDigits);var c=this.options.lngFirst?b+this.options.separator+d:d+this.options.separator+b;var a=this.options.prefix+" "+c;this._container.innerHTML=a}});L.Map.mergeOptions({positionControl:false});L.Map.addInitHook(function(){if(this.options.positionControl){this.positionControl=new L.Control.MousePosition();this.addControl(this.positionControl)}});L.control.mousePosition=function(a){return new L.Control.MousePosition(a)};L.TileLayer.WMTS=L.TileLayer.extend({defaultWmtsParams:{service:"WMTS",request:"GetTile",version:"1.0.0",layer:"",style:"",tilematrixSet:"",format:"image/jpeg"},initialize:function(b,a){this._url=b;var d=L.extend({},this.defaultWmtsParams),e=a.tileSize||this.options.tileSize;if(a.detectRetina&&L.Browser.retina){d.width=d.height=e*2}else{d.width=d.height=e}for(var c in a){if(!this.options.hasOwnProperty(c)&&c!="matrixIds"){d[c]=a[c]}}this.wmtsParams=d;this.matrixIds=a.matrixIds||this.getDefaultMatrix();L.setOptions(this,a)},onAdd:function(a){L.TileLayer.prototype.onAdd.call(this,a)},getTileUrl:function(b){var q=this._map;var c=q.options.crs;var j=this.options.tileSize;var i=b.multiplyBy(j);i.x+=1;i.y-=1;var h=i.add(new L.Point(j,j));var o=c.project(q.unproject(i));var s=c.project(q.unproject(h));var m=s.x-o.x;var a=this._getZoomForUrl();var r=q.getScales()[a];var l=this.getMatrixIdByScale(r);var k=l.identifier;var p=l.topLeftCorner.lng;var e=l.topLeftCorner.lat;var f=Math.round((o.x-p)/m);var g=-Math.round((o.y-e)/m);var d=L.Util.template(this._url,{s:this._getSubdomain(b)});return d+L.Util.getParamString(this.wmtsParams,d)+"&tilematrix="+k+"&tilerow="+g+"&tilecol="+f},setParams:function(b,a){L.extend(this.wmtsParams,b);if(!a){this.redraw()}return this},getDefaultMatrix:function(){var b=new Array(22);for(var a=0;a<22;a++){b[a]={identifier:""+a,topLeftCorner:new L.LatLng(20037508.3428,-20037508.3428)}}return b},getMatrixIdByScale:function(e){var b;for(var c=0;c<this.matrixIds.length;c++){var a=this.matrixIds[c].scaleDenominator;var d=parseFloat(a)/parseFloat(e);if(d>0.9&&d<1.1){b=this.matrixIds[c];break}}return b}});L.tileLayer.wmts=function(b,a){return new L.TileLayer.WMTS(b,a)};L.TileLayer.ImeDynamicMapService=L.TileLayer.extend({params:{FORMAT:"png",TRANSPARENT:true},options:{tileSize:256,layers:false,FORMAT:"png",TRANSPARENT:true},initialize:function(b,a){this._url=b+"/export";a=L.setOptions(this,a);a.width=a.height=a.tileSize*(a.detectRetina&&L.Browser.retina?2:1);this.mapService=new L.ImeMapService({url:b})},onAdd:function(a){this._crs=a.options.crs;L.TileLayer.prototype.onAdd.call(this,a)},getTileUrl:function(c){var d=this._tileCoordsToBounds(c),a=this._crs.project(d.getNorthWest()),b=this._crs.project(d.getSouthEast());var e={TRANSPARENT:this.options.TRANSPARENT,FORMAT:this.options.FORMAT,xmin:a.x,ymin:b.y,xmax:b.x,ymax:a.y,width:this.options.width,height:this.options.height};if(this.options.layers){e.layers=this.options.layers.join(",")}L.extend(this.params,e);url=L.TileLayer.prototype.getTileUrl.call(this,c);return url+L.Util.getParamString(this.params,url)},setParams:function(b,a){L.extend(this.params,b);if(!a){this.redraw()}return this},setLayers:function(b,a){this.options.layers=b;if(!a){this.redraw()}}});L.imeDynamicMapService=function(b,a){return new L.TileLayer.ImeDynamicMapService(b,a)};L.BaseImageLayer=L.Layer.extend({includes:L.Mixin.Events,options:{opacity:1,position:"front",f:"image"},onAdd:function(b){this._map=b;this._update=this.limitExecByInterval(this._update,this.options.updateInterval,this);if(b.options.crs&&b.options.crs.code){var a=b.options.crs.code.split(":")[1]}b.on("moveend",this._update,this);if(this._currentImage&&this._currentImage._bounds.equals(this._map.getBounds())){b.addLayer(this._currentImage)}else{if(this._currentImage){this._map.removeLayer(this._currentImage);this._currentImage=null}}this._update()},onRemove:function(a){if(this._currentImage){this._map.removeLayer(this._currentImage)}this._map.off("moveend",this._update,this);this._map=null},bringToFront:function(){this.options.position="front";if(this._currentImage){this._currentImage.bringToFront()}return this},bringToBack:function(){this.options.position="back";if(this._currentImage){this._currentImage.bringToBack()}return this},getAttribution:function(){return this.options.attribution},getOpacity:function(){return this.options.opacity},setOpacity:function(a){this.options.opacity=a;this._currentImage.setOpacity(a);return this},_renderImage:function(a,b){if(this._map){var c=new L.ImageOverlay(a,b,{opacity:0}).addTo(this._map);c.once("load",function(f){var g=f.target;var d=this._currentImage;if(g._bounds.equals(b)&&g._bounds.equals(this._map.getBounds())){this._currentImage=g;if(this.options.position==="front"){this.bringToFront()}else{this.bringToBack()}if(this._map&&this._currentImage._map){this._currentImage.setOpacity(this.options.opacity)}else{this._currentImage._map.removeLayer(this._currentImage)}if(d&&this._map){this._map.removeLayer(d)}if(d&&d._map){d._map.removeLayer(d)}}else{this._map.removeLayer(g)}this.fire("load",{bounds:b})},this);this.fire("loading",{bounds:b})}},_update:function(){if(!this._map){return}var b=this._map.getZoom();var a=this._map.getBounds();if(this._animatingZoom){return}if(this._map._panTransition&&this._map._panTransition._inProgress){return}if(b>this.options.maxZoom||b<this.options.minZoom){if(this._currentImage){this._currentImage._map.removeLayer(this._currentImage)}return}var c=this._buildExportParams();this._requestExport(c,a)},limitExecByInterval:function(d,f,c){var b,e;return function a(){var g=arguments;if(b){e=true;return}b=true;setTimeout(function(){b=false;if(e){a.apply(c,g);e=false}},f);d.apply(c,g)}}});L.BaseImageLayer.ImeDynamicMapService=L.BaseImageLayer.extend({options:{updateInterval:150,layers:false,format:"png",transparent:true},initialize:function(a){L.Util.setOptions(this,a);this.mapService=new L.ImeMapService({url:a.url})},getLayers:function(){return this.options.layers},setLayers:function(a){this.options.layers=a;this._update();return this},_buildExportParams:function(){var d=this._map.getBounds();var c=this._map.getSize();var f=this._map.options.crs.project(d._northEast);var a=this._map.options.crs.project(d._southWest);var e=this._map.latLngToLayerPoint(d._northEast);var b=this._map.latLngToLayerPoint(d._southWest);if(e.y>0||b.y<c.y){c.y=b.y-e.y}var g={xmin:a.x,ymin:a.y,xmax:f.x,ymax:f.y,width:c.x,height:c.y,format:this.options.format,transparent:this.options.transparent};if(this.options.layers){g.layers=this.options.layers.join(",")}this.params=g;return g},_requestExport:function(b,a){this._renderImage(this.options.url+"/export"+L.Util.getParamString(b),a)}});L.BaseImageLayer.imeDynamicMapService=function(a){return new L.BaseImageLayer.ImeDynamicMapService(a)};L.Format=L.Class.extend({options:null,initialize:function(a){this.options=L.setOptions(this,a)},destroy:function(){},read:function(a){},write:function(a){}});L.Format.XML=L.Format.extend({namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(a){if(window.ActiveXObject){this.xmldom=new ActiveXObject("Microsoft.XMLDOM")}L.Format.prototype.initialize.apply(this,[a]);this.namespaces=L.extend({},this.namespaces);this.namespaceAlias={};for(var b in this.namespaces){this.namespaceAlias[this.namespaces[b]]=b}},destroy:function(){this.xmldom=null;L.Format.prototype.destroy.apply(this,arguments)},setNamespace:function(a,b){this.namespaces[a]=b;this.namespaceAlias[b]=a},read:function(c){var a=c.indexOf("<");if(a>0){c=c.substring(a)}var b=L.FormatUtil.tryFunc(L.FormatUtil.bind((function(){var d;if(window.ActiveXObject&&!this.xmldom){d=new ActiveXObject("Microsoft.XMLDOM")}else{d=this.xmldom}d.loadXML(c);return d}),this),function(){return new DOMParser().parseFromString(c,"text/xml")},function(){var d=new XMLHttpRequest();d.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(c),false);if(d.overrideMimeType){d.overrideMimeType("text/xml")}d.send(null);return d.responseXML});return b},write:function(b){var c;if(this.xmldom){c=b.xml}else{var a=new XMLSerializer();if(b.nodeType==1){var d=document.implementation.createDocument("","",null);if(d.importNode){b=d.importNode(b,true)}d.appendChild(b);c=a.serializeToString(d)}else{c=a.serializeToString(b)}}return c},createElementNS:function(c,a){var b;if(this.xmldom){if(typeof c=="string"){b=this.xmldom.createNode(1,a,c)}else{b=this.xmldom.createNode(1,a,"")}}else{b=document.createElementNS(c,a)}return b},createDocumentFragment:function(){var a;if(this.xmldom){a=this.xmldom.createDocumentFragment()}else{a=document.createDocumentFragment()}return a},createTextNode:function(b){var a;if(typeof b!=="string"){b=String(b)}if(this.xmldom){a=this.xmldom.createTextNode(b)}else{a=document.createTextNode(b)}return a},getElementsByTagNameNS:function(e,d,c){var a=[];if(e.getElementsByTagNameNS){a=e.getElementsByTagNameNS(d,c)}else{var b=e.getElementsByTagName("*");var j,f;for(var g=0,h=b.length;g<h;++g){j=b[g];f=(j.prefix)?(j.prefix+":"+c):c;if((c=="*")||(f==j.nodeName)){if((d=="*")||(d==j.namespaceURI)){a.push(j)}}}}return a},getAttributeNodeNS:function(c,b,a){var j=null;if(c.getAttributeNodeNS){j=c.getAttributeNodeNS(b,a)}else{var e=c.attributes;var h,d;for(var f=0,g=e.length;f<g;++f){h=e[f];if(h.namespaceURI==b){d=(h.prefix)?(h.prefix+":"+a):a;if(d==h.nodeName){j=h;break}}}}return j},getAttributeNS:function(e,d,a){var b="";if(e.getAttributeNS){b=e.getAttributeNS(d,a)||""}else{var c=this.getAttributeNodeNS(e,d,a);if(c){b=c.nodeValue}}return b},getChildValue:function(a,c){var b=c||"";if(a){for(var d=a.firstChild;d;d=d.nextSibling){switch(d.nodeType){case 3:case 4:b+=d.nodeValue}}}return b},isSimpleContent:function(a){var c=true;for(var b=a.firstChild;b;b=b.nextSibling){if(b.nodeType===1){c=false;break}}return c},hasAttributeNS:function(c,b,a){var d=false;if(c.hasAttributeNS){d=c.hasAttributeNS(b,a)}else{d=!!this.getAttributeNodeNS(c,b,a)}return d},setAttributeNS:function(d,c,a,e){if(d.setAttributeNS){d.setAttributeNS(c,a,e)}else{if(this.xmldom){if(c){var b=d.ownerDocument.createNode(2,a,c);b.nodeValue=e;d.setAttributeNode(b)}else{d.setAttribute(a,e)}}else{throw"setAttributeNS not implemented"}}},createElementNSPlus:function(b,a){a=a||{};var d=a.uri||this.namespaces[a.prefix];if(!d){var f=b.indexOf(":");d=this.namespaces[b.substring(0,f)]}if(!d){d=this.namespaces[this.defaultPrefix]}var c=this.createElementNS(d,b);if(a.attributes){this.setAttributes(c,a.attributes)}var e=a.value;if(e!=null){c.appendChild(this.createTextNode(e))}return c},setAttributes:function(c,e){var d,b;for(var a in e){if(e[a]!=null&&e[a].toString){d=e[a].toString();b=this.namespaces[a.substring(0,a.indexOf(":"))]||null;this.setAttributeNS(c,b,a,d)}}},readNode:function(c,e){if(!e){e={}}var d=this.readers[c.namespaceURI?this.namespaceAlias[c.namespaceURI]:this.defaultPrefix];if(d){var b=c.localName||c.nodeName.split(":").pop();var a=d[b]||d["*"];if(a){a.apply(this,[c,e])}}return e},readChildNodes:function(d,e){if(!e){e={}}var c=d.childNodes;var f;for(var b=0,a=c.length;b<a;++b){f=c[b];if(f.nodeType==1){this.readNode(f,e)}}return e},writeNode:function(a,f,d){var e,c;var b=a.indexOf(":");if(b>0){e=a.substring(0,b);c=a.substring(b+1)}else{if(d){e=this.namespaceAlias[d.namespaceURI]}else{e=this.defaultPrefix}c=a}var g=this.writers[e][c].apply(this,[f]);if(d){d.appendChild(g)}return g},getChildEl:function(c,a,b){return c&&this.getThisOrNextEl(c.firstChild,a,b)},getNextEl:function(c,a,b){return c&&this.getThisOrNextEl(c.nextSibling,a,b)},getThisOrNextEl:function(d,a,c){outer:for(var b=d;b;b=b.nextSibling){switch(b.nodeType){case 1:if((!a||a===(b.localName||b.nodeName.split(":").pop()))&&(!c||c===b.namespaceURI)){break outer}b=null;break outer;case 3:if(/^\s*$/.test(b.nodeValue)){break}case 4:case 6:case 12:case 10:case 11:b=null;break outer}}return b||null},lookupNamespaceURI:function(e,f){var d=null;if(e){if(e.lookupNamespaceURI){d=e.lookupNamespaceURI(f)}else{outer:switch(e.nodeType){case 1:if(e.namespaceURI!==null&&e.prefix===f){d=e.namespaceURI;break outer}var b=e.attributes.length;if(b){var a;for(var c=0;c<b;++c){a=e.attributes[c];if(a.prefix==="xmlns"&&a.name==="xmlns:"+f){d=a.value||null;break outer}else{if(a.name==="xmlns"&&f===null){d=a.value||null;break outer}}}}d=this.lookupNamespaceURI(e.parentNode,f);break outer;case 2:d=this.lookupNamespaceURI(e.ownerElement,f);break outer;case 9:d=this.lookupNamespaceURI(e.documentElement,f);break outer;case 6:case 12:case 10:case 11:break outer;default:d=this.lookupNamespaceURI(e.parentNode,f);break outer}}}return d},getXMLDoc:function(){if(!L.Format.XML.document&&!this.xmldom){if(document.implementation&&document.implementation.createDocument){L.Format.XML.document=document.implementation.createDocument("","",null)}else{if(!this.xmldom&&window.ActiveXObject){this.xmldom=new ActiveXObject("Microsoft.XMLDOM")}}}return L.Format.XML.document||this.xmldom},});L.Format.XML.document=null;L.Format.XML.VersionedOGC=L.Format.XML.extend({defaultVersion:null,version:null,profile:null,allowFallback:false,name:null,stringifyOutput:false,parser:null,initialize:function(a){L.Format.XML.prototype.initialize.apply(this,[a])},getVersion:function(b,c){var a;if(b){a=this.version;if(!a){a=b.getAttribute("version");if(!a){a=this.defaultVersion}}}else{a=(c&&c.version)||this.version||this.defaultVersion}return a},getParser:function(a){a=a||this.defaultVersion;var b=this.profile?"_"+this.profile:"";if(!this.parser||this.parser.VERSION!=a){var c=L.Format[this.name]["v"+a.replace(/\./g,"_")+b];if(c){this.parser=new c(this.options)}}return this.parser},write:function(d,c){var b=this.getVersion(null,c);this.parser=this.getParser(b);var a=this.parser.write(d,c);if(this.stringifyOutput===false){return a}else{return L.Format.XML.prototype.write.apply(this,[a])}},read:function(d,c){if(typeof d=="string"){d=L.Format.XML.prototype.read.apply(this,[d])}var b=d.documentElement;var a=this.getVersion(b);this.parser=this.getParser(a);var e=this.parser.read(d,c);e.version=a;return e}});L.Format.OWSCommon=L.Format.XML.VersionedOGC.extend({defaultVersion:"1.0.0",getVersion:function(b,c){var a=this.version;if(!a){var d=b.getAttribute("xmlns:ows");if(d&&d.substring(d.lastIndexOf("/")+1)==="1.1"){a="1.1.0"}if(!a){a=this.defaultVersion}}return a}});L.Format.WMTSCapabilities=L.Format.XML.VersionedOGC.extend({name:"WMTSCapabilities",defaultVersion:"1.0.0",yx:{"urn:ogc:def:crs:EPSG::4326":true,"urn:ogc:def:crs:EPSG::4490":true,"urn:ogc:def:crs:EPSG::900913":true},xy:{"urn:ogc:def:crs:EPSG::3857":true,"urn:ogc:def:crs:EPSG::3785":true,"urn:ogc:def:crs:EPSG::102100":true}});L.Format.OWSCommon.v1=L.Format.XML.extend({regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},read:function(b,a){a=L.FormatUtil.applyDefaults(a,this.options);var c={};this.readChildNodes(b,c);return c},readers:{ows:{Exception:function(b,c){var a={code:b.getAttribute("exceptionCode"),locator:b.getAttribute("locator"),texts:[]};c.exceptions.push(a);this.readChildNodes(b,a)},ExceptionText:function(b,a){var c=this.getChildValue(b);a.texts.push(c)},ServiceIdentification:function(a,b){b.serviceIdentification={};this.readChildNodes(a,b.serviceIdentification)},Title:function(a,b){b.title=this.getChildValue(a)},Abstract:function(a,b){b["abstract"]=this.getChildValue(a)},Keywords:function(a,b){b.keywords={};this.readChildNodes(a,b.keywords)},Keyword:function(b,a){a[this.getChildValue(b)]=true},ServiceType:function(a,b){b.serviceType={codeSpace:a.getAttribute("codeSpace"),value:this.getChildValue(a)}},ServiceTypeVersion:function(a,b){b.serviceTypeVersion=this.getChildValue(a)},Fees:function(a,b){b.fees=this.getChildValue(a)},AccessConstraints:function(a,b){b.accessConstraints=this.getChildValue(a)},ServiceProvider:function(a,b){b.serviceProvider={};this.readChildNodes(a,b.serviceProvider)},ProviderName:function(a,b){b.providerName=this.getChildValue(a)},ProviderSite:function(a,b){b.providerSite=this.getAttributeNS(a,this.namespaces.xlink,"href")},ServiceContact:function(a,b){b.serviceContact={};this.readChildNodes(a,b.serviceContact)},IndividualName:function(b,a){a.individualName=this.getChildValue(b)},PositionName:function(b,a){a.positionName=this.getChildValue(b)},ContactInfo:function(b,a){a.contactInfo={};this.readChildNodes(b,a.contactInfo)},Phone:function(b,a){a.phone={};this.readChildNodes(b,a.phone)},Voice:function(b,a){a.voice=this.getChildValue(b)},Address:function(b,a){a.address={};this.readChildNodes(b,a.address)},DeliveryPoint:function(b,a){a.deliveryPoint=this.getChildValue(b)},City:function(b,a){a.city=this.getChildValue(b)},AdministrativeArea:function(b,a){a.administrativeArea=this.getChildValue(b)},PostalCode:function(b,a){a.postalCode=this.getChildValue(b)},Country:function(b,a){a.country=this.getChildValue(b)},ElectronicMailAddress:function(b,a){a.electronicMailAddress=this.getChildValue(b)},Role:function(b,a){a.role=this.getChildValue(b)},OperationsMetadata:function(a,b){b.operationsMetadata={};this.readChildNodes(a,b.operationsMetadata)},Operation:function(c,b){var a=c.getAttribute("name");b[a]={};this.readChildNodes(c,b[a])},DCP:function(b,a){a.dcp={};this.readChildNodes(b,a.dcp)},HTTP:function(b,a){a.http={};this.readChildNodes(b,a.http)},Get:function(b,a){if(!a.get){a.get=[]}var c={url:this.getAttributeNS(b,this.namespaces.xlink,"href")};this.readChildNodes(b,c);a.get.push(c)},Post:function(b,a){if(!a.post){a.post=[]}var c={url:this.getAttributeNS(b,this.namespaces.xlink,"href")};this.readChildNodes(b,c);a.post.push(c)},Parameter:function(c,a){if(!a.parameters){a.parameters={}}var b=c.getAttribute("name");a.parameters[b]={};this.readChildNodes(c,a.parameters[b])},Constraint:function(b,c){if(!c.constraints){c.constraints={}}var a=b.getAttribute("name");c.constraints[a]={};this.readChildNodes(b,c.constraints[a])},Value:function(a,b){b[this.getChildValue(a)]=true},OutputFormat:function(a,b){b.formats.push({value:this.getChildValue(a)});this.readChildNodes(a,b)},WGS84BoundingBox:function(b,c){var a={};a.crs=b.getAttribute("crs");if(c.BoundingBox){c.BoundingBox.push(a)}else{c.projection=a.crs;a=c}this.readChildNodes(b,a)},BoundingBox:function(a,b){this.readers.ows["WGS84BoundingBox"].apply(this,[a,b])},LowerCorner:function(b,c){var d=this.getChildValue(b).replace(this.regExes.trimSpace,"");d=d.replace(this.regExes.trimComma,",");var a=d.split(this.regExes.splitSpace);c.left=a[0];c.bottom=a[1]},UpperCorner:function(d,e){var f=this.getChildValue(d).replace(this.regExes.trimSpace,"");f=f.replace(this.regExes.trimComma,",");var a=f.split(this.regExes.splitSpace);e.right=a[0];e.top=a[1];var c=L.latLng(e.bottom,e.left);var b=L.latLng(e.top,e.right);e.bounds=L.latLngBounds(c,b);delete e.left;delete e.bottom;delete e.right;delete e.top},Language:function(a,b){b.language=this.getChildValue(a)}}},writers:{ows:{BoundingBox:function(a,c){var b=this.createElementNSPlus(c||"ows:BoundingBox",{attributes:{crs:a.projection}});this.writeNode("ows:LowerCorner",a,b);this.writeNode("ows:UpperCorner",a,b);return b},LowerCorner:function(a){var b=this.createElementNSPlus("ows:LowerCorner",{value:a.bounds.left+" "+a.bounds.bottom});return b},UpperCorner:function(a){var b=this.createElementNSPlus("ows:UpperCorner",{value:a.bounds.right+" "+a.bounds.top});return b},Identifier:function(a){var b=this.createElementNSPlus("ows:Identifier",{value:a});return b},Title:function(b){var a=this.createElementNSPlus("ows:Title",{value:b});return a},Abstract:function(a){var b=this.createElementNSPlus("ows:Abstract",{value:a});return b},OutputFormat:function(b){var a=this.createElementNSPlus("ows:OutputFormat",{value:b});return a}}}});L.Format.OWSCommon.v1_1_0=L.Format.OWSCommon.v1.extend({namespaces:{ows:"http://www.opengis.net/ows/1.1",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:L.FormatUtil.applyDefaults({ExceptionReport:function(a,b){b.exceptionReport={version:a.getAttribute("version"),language:a.getAttribute("xml:lang"),exceptions:[]};this.readChildNodes(a,b.exceptionReport)},AllowedValues:function(a,b){b.allowedValues={};this.readChildNodes(a,b.allowedValues)},AnyValue:function(a,b){b.anyValue=true},DataType:function(a,b){b.dataType=this.getChildValue(a)},Range:function(a,b){b.range={};this.readChildNodes(a,b.range)},MinimumValue:function(b,a){a.minValue=this.getChildValue(b)},MaximumValue:function(b,a){a.maxValue=this.getChildValue(b)},Identifier:function(a,b){b.identifier=this.getChildValue(a)},SupportedCRS:function(a,b){b.supportedCRS=this.getChildValue(a)}},L.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:L.FormatUtil.applyDefaults({Range:function(a){var b=this.createElementNSPlus("ows:Range",{attributes:{"ows:rangeClosure":a.closure}});this.writeNode("ows:MinimumValue",a.minValue,b);this.writeNode("ows:MaximumValue",a.maxValue,b);return b},MinimumValue:function(b){var a=this.createElementNSPlus("ows:MinimumValue",{value:b});return a},MaximumValue:function(b){var a=this.createElementNSPlus("ows:MaximumValue",{value:b});return a},Value:function(b){var a=this.createElementNSPlus("ows:Value",{value:b});return a}},L.Format.OWSCommon.v1.prototype.writers.ows)}});L.Format.WMTSCapabilities.v1_0_0=L.Format.OWSCommon.v1_1_0.extend({version:"1.0.0",namespaces:{ows:"http://www.opengis.net/ows/1.1",wmts:"http://www.opengis.net/wmts/1.0",xlink:"http://www.w3.org/1999/xlink"},yx:null,defaultPrefix:"wmts",initialize:function(b){L.Format.XML.prototype.initialize.apply(this,[b]);this.options=b;var a=L.extend({},L.Format.WMTSCapabilities.prototype.yx);this.yx=L.extend(a,this.yx)},read:function(b){if(typeof b=="string"){b=L.Format.XML.prototype.read.apply(this,[b])}if(b&&b.nodeType==9){b=b.documentElement}var a={};this.readNode(b,a);a.version=this.version;return a},readers:{wmts:{Capabilities:function(a,b){this.readChildNodes(a,b)},Contents:function(a,b){b.contents={};b.contents.layers=[];b.contents.tileMatrixSets={};this.readChildNodes(a,b.contents)},Layer:function(b,c){var a={styles:[],formats:[],dimensions:[],tileMatrixSetLinks:[]};a.layers=[];this.readChildNodes(b,a);c.layers.push(a)},Style:function(b,c){var a={};a.isDefault=(b.getAttribute("isDefault")==="true");this.readChildNodes(b,a);c.styles.push(a)},Format:function(a,b){b.formats.push(this.getChildValue(a))},TileMatrixSetLink:function(b,c){var a={};this.readChildNodes(b,a);c.tileMatrixSetLinks.push(a)},TileMatrixSet:function(b,c){if(c.layers){var a={matrixIds:[]};this.readChildNodes(b,a);c.tileMatrixSets[a.identifier]=a}else{c.tileMatrixSet=this.getChildValue(b)}},TileMatrix:function(b,c){var a={supportedCRS:c.supportedCRS};this.readChildNodes(b,a);c.matrixIds.push(a)},ScaleDenominator:function(a,b){b.scaleDenominator=parseFloat(this.getChildValue(a))},TopLeftCorner:function(d,f){var c=this.getChildValue(d);var e=c.split(" ");var a;if(f.supportedCRS){var b=f.supportedCRS.replace(/urn:ogc:def:crs:(\w+):.+:(\w+)$/,"urn:ogc:def:crs:$1::$2");a=!!this.yx[b]}if(a){f.topLeftCorner=L.latLng(e[0],e[1])}else{f.topLeftCorner=L.latLng(e[1],e[0])}},TileWidth:function(a,b){b.tileWidth=parseInt(this.getChildValue(a))},TileHeight:function(a,b){b.tileHeight=parseInt(this.getChildValue(a))},MatrixWidth:function(a,b){b.matrixWidth=parseInt(this.getChildValue(a))},MatrixHeight:function(a,b){b.matrixHeight=parseInt(this.getChildValue(a))},ResourceURL:function(c,d){d.resourceUrl=d.resourceUrl||{};var b=c.getAttribute("resourceType");if(!d.resourceUrls){d.resourceUrls=[]}var a=d.resourceUrl[b]={format:c.getAttribute("format"),template:c.getAttribute("template"),resourceType:b};d.resourceUrls.push(a)},WSDL:function(a,b){b.wsdl={};b.wsdl.href=a.getAttribute("xlink:href")},ServiceMetadataURL:function(a,b){b.serviceMetadataUrl={};b.serviceMetadataUrl.href=a.getAttribute("xlink:href")},LegendURL:function(a,b){b.legend={};b.legend.href=a.getAttribute("xlink:href");b.legend.format=a.getAttribute("format")},Dimension:function(a,c){var b={values:[]};this.readChildNodes(a,b);c.dimensions.push(b)},Default:function(a,b){b["default"]=this.getChildValue(a)},Value:function(a,b){b.values.push(this.getChildValue(a))}},ows:L.Format.OWSCommon.v1_1_0.prototype.readers.ows}});L.Format.WMSCapabilities=L.Format.XML.VersionedOGC.extend({name:"WMSCapabilities",defaultVersion:"1.1.1"});L.Format.WMSCapabilities.v1=L.Format.XML.extend({namespaces:{wms:"http://www.opengis.net/wms",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"wms",read:function(c){if(typeof c=="string"){c=L.Format.XML.prototype.read.apply(this,[c])}var b=c;if(c&&c.nodeType==9){c=c.documentElement}var a={};this.readNode(c,a);return a},readers:{wms:{Service:function(a,b){b.service={};this.readChildNodes(a,b.service)},Name:function(a,b){b.name=this.getChildValue(a)},Title:function(a,b){b.title=this.getChildValue(a)},Abstract:function(a,b){b["abstract"]=this.getChildValue(a)},BoundingBox:function(b,c){var d={};d.bbox=[parseFloat(b.getAttribute("minx")),parseFloat(b.getAttribute("miny")),parseFloat(b.getAttribute("maxx")),parseFloat(b.getAttribute("maxy"))];var a={x:parseFloat(b.getAttribute("resx")),y:parseFloat(b.getAttribute("resy"))};if(!(isNaN(a.x)&&isNaN(a.y))){d.res=a}return d},OnlineResource:function(a,b){b.href=this.getAttributeNS(a,this.namespaces.xlink,"href")},ContactInformation:function(a,b){b.contactInformation={};this.readChildNodes(a,b.contactInformation)},ContactPersonPrimary:function(a,b){b.personPrimary={};this.readChildNodes(a,b.personPrimary)},ContactPerson:function(a,b){b.person=this.getChildValue(a)},ContactOrganization:function(a,b){b.organization=this.getChildValue(a)},ContactPosition:function(a,b){b.position=this.getChildValue(a)},ContactAddress:function(a,b){b.contactAddress={};this.readChildNodes(a,b.contactAddress)},AddressType:function(a,b){b.type=this.getChildValue(a)},Address:function(a,b){b.address=this.getChildValue(a)},City:function(a,b){b.city=this.getChildValue(a)},StateOrProvince:function(a,b){b.stateOrProvince=this.getChildValue(a)},PostCode:function(a,b){b.postcode=this.getChildValue(a)},Country:function(a,b){b.country=this.getChildValue(a)},ContactVoiceTelephone:function(a,b){b.phone=this.getChildValue(a)},ContactFacsimileTelephone:function(a,b){b.fax=this.getChildValue(a)},ContactElectronicMailAddress:function(a,b){b.email=this.getChildValue(a)},Fees:function(b,c){var a=this.getChildValue(b);if(a&&a.toLowerCase()!="none"){c.fees=a}},AccessConstraints:function(a,b){var c=this.getChildValue(a);if(c&&c.toLowerCase()!="none"){b.accessConstraints=c}},Capability:function(a,b){b.capability={nestedLayers:[],layers:[]};this.readChildNodes(a,b.capability)},Request:function(a,b){b.request={};this.readChildNodes(a,b.request)},GetCapabilities:function(a,b){b.getcapabilities={formats:[]};this.readChildNodes(a,b.getcapabilities)},Format:function(a,b){if(L.Util.isArray(b.formats)){b.formats.push(this.getChildValue(a))}else{b.format=this.getChildValue(a)}},DCPType:function(a,b){this.readChildNodes(a,b)},HTTP:function(a,b){this.readChildNodes(a,b)},Get:function(a,b){b.get={};this.readChildNodes(a,b.get);if(!b.href){b.href=b.get.href}},Post:function(a,b){b.post={};this.readChildNodes(a,b.post);if(!b.href){b.href=b.get.href}},GetMap:function(a,b){b.getmap={formats:[]};this.readChildNodes(a,b.getmap)},GetFeatureInfo:function(a,b){b.getfeatureinfo={formats:[]};this.readChildNodes(a,b.getfeatureinfo)},Exception:function(a,b){b.exception={formats:[]};this.readChildNodes(a,b.exception)},Layer:function(c,i){var e,b;if(i.capability){b=i.capability;e=i}else{b=i}var r=c.getAttributeNode("queryable");var d=(r&&r.specified)?c.getAttribute("queryable"):null;r=c.getAttributeNode("cascaded");var m=(r&&r.specified)?c.getAttribute("cascaded"):null;r=c.getAttributeNode("opaque");var j=(r&&r.specified)?c.getAttribute("opaque"):null;var p=c.getAttribute("noSubsets");var a=c.getAttribute("fixedWidth");var l=c.getAttribute("fixedHeight");var q=e||{},o=L.Util.extend;var k={nestedLayers:[],styles:e?[].concat(e.styles):[],srs:e?o({},q.srs):{},metadataURLs:[],bbox:e?o({},q.bbox):{},llbbox:q.llbbox,dimensions:e?o({},q.dimensions):{},authorityURLs:e?o({},q.authorityURLs):{},identifiers:{},keywords:[],queryable:(d&&d!=="")?(d==="1"||d==="true"):(q.queryable||false),cascaded:(m!==null)?parseInt(m):(q.cascaded||0),opaque:j?(j==="1"||j==="true"):(q.opaque||false),noSubsets:(p!==null)?(p==="1"||p==="true"):(q.noSubsets||false),fixedWidth:(a!=null)?parseInt(a):(q.fixedWidth||0),fixedHeight:(l!=null)?parseInt(l):(q.fixedHeight||0),minScale:q.minScale,maxScale:q.maxScale,attribution:q.attribution};i.nestedLayers.push(k);k.capability=b;this.readChildNodes(c,k);delete k.capability;if(k.name){var h=k.name.split(":"),g=b.request,f=g.getfeatureinfo;if(h.length>0){k.prefix=h[0]}b.layers.push(k);if(k.formats===undefined){k.formats=g.getmap.formats}if(k.infoFormats===undefined&&f){k.infoFormats=f.formats}}},Attribution:function(a,b){b.attribution={};this.readChildNodes(a,b.attribution)},LogoURL:function(a,b){b.logo={width:a.getAttribute("width"),height:a.getAttribute("height")};this.readChildNodes(a,b.logo)},Style:function(b,c){var a={};c.styles.push(a);this.readChildNodes(b,a)},LegendURL:function(b,c){var a={width:b.getAttribute("width"),height:b.getAttribute("height")};c.legend=a;this.readChildNodes(b,a)},MetadataURL:function(a,b){var c={type:a.getAttribute("type")};b.metadataURLs.push(c);this.readChildNodes(a,c)},DataURL:function(a,b){b.dataURL={};this.readChildNodes(a,b.dataURL)},FeatureListURL:function(a,b){b.featureListURL={};this.readChildNodes(a,b.featureListURL)},AuthorityURL:function(b,d){var a=b.getAttribute("name");var c={};this.readChildNodes(b,c);d.authorityURLs[a]=c.href},Identifier:function(a,c){var b=a.getAttribute("authority");c.identifiers[b]=this.getChildValue(a)},KeywordList:function(a,b){this.readChildNodes(a,b)},SRS:function(a,b){b.srs[this.getChildValue(a)]=true}}}});L.Format.WMSCapabilities.v1_1=L.Format.WMSCapabilities.v1.extend({readers:{wms:L.FormatUtil.applyDefaults({WMT_MS_Capabilities:function(a,b){this.readChildNodes(a,b)},Keyword:function(a,b){if(b.keywords){b.keywords.push(this.getChildValue(a))}},DescribeLayer:function(a,b){b.describelayer={formats:[]};this.readChildNodes(a,b.describelayer)},GetLegendGraphic:function(a,b){b.getlegendgraphic={formats:[]};this.readChildNodes(a,b.getlegendgraphic)},GetStyles:function(a,b){b.getstyles={formats:[]};this.readChildNodes(a,b.getstyles)},PutStyles:function(a,b){b.putstyles={formats:[]};this.readChildNodes(a,b.putstyles)},UserDefinedSymbolization:function(a,b){var c={supportSLD:parseInt(a.getAttribute("SupportSLD"))==1,userLayer:parseInt(a.getAttribute("UserLayer"))==1,userStyle:parseInt(a.getAttribute("UserStyle"))==1,remoteWFS:parseInt(a.getAttribute("RemoteWFS"))==1};b.userSymbols=c},LatLonBoundingBox:function(a,b){b.llbbox=[parseFloat(a.getAttribute("minx")),parseFloat(a.getAttribute("miny")),parseFloat(a.getAttribute("maxx")),parseFloat(a.getAttribute("maxy"))]},BoundingBox:function(a,b){var c=L.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[a,b]);c.srs=a.getAttribute("SRS");b.bbox[c.srs]=c},ScaleHint:function(a,b){},Dimension:function(b,d){var a=b.getAttribute("name").toLowerCase();var c={name:a,units:b.getAttribute("units"),unitsymbol:b.getAttribute("unitSymbol")};d.dimensions[c.name]=c},Extent:function(d,e){var b=d.getAttribute("name").toLowerCase();if(b in e.dimensions){var c=e.dimensions[b];c.nearestVal=d.getAttribute("nearestValue")==="1";c.multipleVal=d.getAttribute("multipleValues")==="1";c.current=d.getAttribute("current")==="1";c["default"]=d.getAttribute("default")||"";var a=this.getChildValue(d);c.values=a.split(",")}}},L.Format.WMSCapabilities.v1.prototype.readers.wms)}});L.Format.WMSCapabilities.v1_1_1=L.Format.WMSCapabilities.v1_1.extend({version:"1.1.1",readers:{wms:L.FormatUtil.applyDefaults({SRS:function(a,b){b.srs[this.getChildValue(a)]=true}},L.Format.WMSCapabilities.v1_1.prototype.readers.wms)}});L.Format.TRouteResultFormat=L.Format.XML.extend({initialize:function(a){L.Format.XML.prototype.initialize.apply(this,[a])},read:function(e){var a=null;if(typeof e=="string"){e=L.Format.XML.prototype.read.apply(this,[e])}if(e&&e.nodeType==9){a={};var b=e.getElementsByTagName("result")[0].childNodes;for(var c=0;c<b.length;c++){var d=b[c];var f=d.nodeName;if(this._resultPaser[f]){this._resultPaser[f](d,a)}}}return a},_resultPaser:{parameters:function(c,d){var a=c.childNodes;d.parameters={};for(var b=0;b<a.length;b++){var c=a[b];if(c.nodeName=="#text"){continue}d.parameters[c.nodeName]=c.text||c.textContent}},routes:function(g,h){var c=g.attributes;var b=g.childNodes;h.routes={};for(var d=0;d<c.length;d++){var f=c[d];if(f.nodeName=="#text"){continue}h.routes[f.nodeName]=f.text||f.textContent}for(var d=0;d<b.length;d++){if(!h.routes.items){h.routes.items=[]}var g=b[d];if(g.nodeName=="#text"){continue}var e={};a(g,e);h.routes.items.push(e)}function a(l,m){var j=l.childNodes;for(var k=0;k<j.length;k++){if(j[k].nodeName=="#text"){continue}m[j[k].nodeName]=j[k].text||j[k].textContent}}},simple:function(e,f){f.simple={};var b=e.childNodes;for(var c=0;c<b.length;c++){if(!f.simple.items){f.simple.items=[]}var e=b[c];if(e.nodeName=="#text"){continue}var d={};a(e,d);f.simple.items.push(d)}function a(j,k){var g=j.childNodes;for(var h=0;h<g.length;h++){if(g[h].nodeName=="#text"){continue}k[g[h].nodeName]=g[h].text||g[h].textContent}}},distance:function(a,b){b.distance=a.text||a.textContent},duration:function(a,b){b.duration=a.text||a.textContent},routelatlon:function(a,b){b.routelatlon=a.text||a.textContent},mapinfo:function(c,d){d.mapinfo={};var a=c.childNodes;for(var b=0;b<a.length;b++){if(a[b].nodeName=="#text"){continue}d.mapinfo[a[b].nodeName]=a[b].text||a[b].textContent}}}});L.TRouteResult=L.Class.extend({data:null,orig:null,dest:null,startFeature:null,endFeature:null,routes:null,segmentFeatures:null,distance:null,duration:null,routelatlon:null,initialize:function(c){if(c){this.data=c;for(var b in c){if(this._resultPaser[b]){var a=L.FormatUtil.bind(this._resultPaser[b],this);a(c[b])}}}},lineStringToGeometry:function(g){var d=[];var e=g.split(";");for(var c=0;c<e.length;c++){if(e[c]==""){continue}var b=e[c].split(",");var a=new L.LatLng(b[1],b[0]);d.push(a)}var f=new L.Polyline(d);return f},_resultPaser:{parameters:function(b){var a=b.orig.split(",");var d=b.dest.split(",");this.start=new L.LatLng(a[1],a[0]);this.end=new L.LatLng(d[1],d[0]);var e=new L.LatLng(this.start.lat,this.start.lng);this.startFeature=new L.Marker(e);var c=new L.LatLng(this.end.lat,this.end.lng);this.endFeature=new L.Marker(c)},routes:function(a){this.routes=a},simple:function(e){this.simple=e;if(!e.items){return}var b=e.items;var d=[];for(var c=0;c<b.length;c++){var a=this.lineStringToGeometry(b[c].streetLatLon);L.setOptions(a,b[c]);d.push(a)}this.simple.segmentFeatures=d},distance:function(a){this.distance=a},duration:function(a){this.duration=a},routelatlon:function(a){this.routelatlon=a},mapinfo:function(a){this.mapinfo=a}}});L.WMTSUtil={getCapabilities:function(a,b,d){var c={SERVICE:"WMTS",VERSION:"1.0.0",REQUEST:"GetCapabilities"};L.get(L.ProxyHost+a,c,function(g){try{var j=g;var i=new L.Format.WMTSCapabilities();var f=i.read(j);if(b){b(f)}}catch(h){if(d){d(h)}}})},getUnitByEpsgCode:function(c){var d={degrees:["4490","4326","4610"],m:["3857","900913","102100"]};var b=c.lastIndexOf(":");c=c.substring(b+1);var a=d.degrees.join(",");if(a.indexOf(c)!=-1){return"degrees"}else{return"m"}},getCapAndUnit:function(a,d){var b=function(m){m.serviceURL=a;var e=m.contents;var j=e.tileMatrixSets;var f=e.layers;var h=f[f.length-1];var g="";var k="";if(h.tileMatrixSetLinks.length>0){var i=h.tileMatrixSetLinks.length;g=h.tileMatrixSetLinks[i-1].tileMatrixSet;k=j[g].supportedCRS}var l=L.WMTSUtil.getUnitByEpsgCode(k);d(m,l)};var c=function(){};this.getCapabilities(a,b,c)},getLayer:function(b){try{var c=b.serviceURL;var t=b.contents;var l=t.tileMatrixSets;var g=t.layers;var o=null;var i=null;for(var q=g.length-1;q>=0;q--){var w="Default";if(g[q].styles.length>0){w=g[q].styles[0].identifier}var d=g[q].formats[0];var a="";if(g[q].tileMatrixSetLinks.length>0){var r=g[q].tileMatrixSetLinks.length;a=g[q].tileMatrixSetLinks[r-1].tileMatrixSet}var h=t.tileMatrixSets[a].matrixIds;var s=h[0].topLeftCorner;var m=[];for(var p=0;p<h.length;p++){m.push({identifier:h[p].identifier,scaleDenominator:h[p].scaleDenominator,topLeftCorner:s})}var f=b.contents.layers[0].bounds;var v=new L.TileLayer.WMTS(c,{tileSize:256,layer:g[q].identifier,style:w,tilematrixSet:a,format:d,matrixIds:m,fullExtent:f});return v}}catch(u){throw u}}};L.Geocoder=L.Class.extend({options:{url:null},initialize:function(a){L.setOptions(this,a)},getLatLngInfo:function(a,b){this._getLatLngInfo(a,b)},getLocation:function(b,a){this._getLocation(b,a)},_getLatLngInfo:function(e,f){var b=this.options.url;if(!b){return false}var a=e.address;var d=e.city;var c=e.format||"json";b=b+"?format="+c+"&address="+a;if(d){b=b+"&city="+d}if(c=="json"){L.jsonp(b,null,function(g){if(f&&typeof(f)=="function"){f(g)}})}else{L.get(b,null,function(g){if(f&&typeof(f)=="function"){f(g)}})}},_getLocation:function(c,b){var a=this.options.url;if(!a){return false}a=a+"?format=json&lon="+c.lng+"&lat="+c.lat;L.jsonp(a,null,function(d){if(b&&typeof(b)=="function"){b(d)}})}});L.TGeocoder=L.Class.extend({options:{url:"http://www.tianditu.com/query.shtml"},initialize:function(a){L.setOptions(this,a)},getLocation:function(b,a){this._getLocation(b,a)},_getLocation:function(b,j){var a=this.options.url;if(!a){return false}var h={};h.lon=b.lng;h.lat=b.lat;h.appkey="8a7b9aac0db21f9dd995e61a14685f05";h.ver=1;var g=["lon","lat","appkey","ver"];var d="?postStr=";var c=[];for(var e=0;e<g.length;e++){var k=g[e];if(k in h){c.push("'"+k+"':'"+h[k]+"'")}}d+="{"+c.join(",")+"}";d+="&type=geocode";var f=this;L.get(L.ProxyHost+a+d,null,function(i){try{var l=JSON.parse(i);if(j&&typeof(j)=="function"){j(l)}}catch(m){if(j&&typeof(j)=="function"){j(i)}}})}});L.Geolocation=L.Class.extend({options:{enableHighAccuracy:false,timeout:5000,maximumAge:3000},initialize:function(a){L.setOptions(this,a)},getCurrentPosition:function(f,b){L.setOptions(this,b);if(navigator.geolocation){var e=function(h){var i=h.coords;var j=new L.LatLng(i.latitude,i.longitude);var g={latlng:j,status:"ok"};f(g)};var d=function(h){var i="";switch(h.code){case h.PERMISSION_DENIED:i="User denied the request for Geolocation.";break;case h.POSITION_UNAVAILABLE:i="Location information is unavailable.";break;case h.TIMEOUT:i="The request to get user location timed out.";break;case h.UNKNOWN_ERROR:i="An unknown error occurred.";break}var g={latlng:null,status:"error",errorMsg:i};f(g)};navigator.geolocation.getCurrentPosition(e,d,this.options)}else{var c="Your browser does not support Geolocation!";var a={latlng:null,status:"error",errorMsg:c};f(a)}}});L.LocalSearch=L.Class.extend({options:{url:null,pageNum:0,pageSize:10,onSearchComplete:null,param:null,resultType:0,currentResult:null},initialize:function(b,a){this.map=b;L.setOptions(this,a)},setUrl:function(a){this.options.url=a},setPageSize:function(a){this.options.pageSize=a},getPageSize:function(){return this.options.pageSize},setSearchCompleteCallback:function(a){this.options.onSearchComplete=a},search:function(a,b){switch(b){case 1:this.options.resultType=1;this._search(a,null);break;case 2:this.options.resultType=2;this._searchInView(a,null);break;case 3:this.options.resultType=3;this._searchStatistics(a,null);break}},searchBySort:function(a,b){switch(b){case 1:this.options.resultType=4;this._search(null,a);break;case 2:this.options.resultType=5;this._searchInView(null,a);break;case 3:this.options.resultType=6;this._searchStatistics(null,a);break}},searchInBounds:function(b,d){this.options.resultType=7;if(d instanceof L.LatLngBounds){d=[d.getSouth(),d.getWest(),d.getNorth(),d.getEast()].join(",")}var e=this.options.pageNum;var a=this.options.pageSize;var f={keyword:b,bounds:d,pageNum:e,pageSize:a};this.options.param=f;var c=this._queryParam(f);if(c){this._doQuery(c)}},searchInBoundsBySort:function(c,d){this.options.resultType=8;if(d instanceof L.LatLngBounds){d=[d.getSouth(),d.getWest(),d.getNorth(),d.getEast()].join(",")}var e=this.options.pageNum;var a=this.options.pageSize;var f={sort:c,bounds:d,pageNum:e,pageSize:a};this.options.param=f;var b=this._queryParam(f);if(b){this._doQuery(b)}},searchNearby:function(d,b,a){this.options.resultType=9;var f=this.options.pageNum;var c=this.options.pageSize;var g={keyword:d,center:b,radius:a,pageNum:f,pageSize:c};this.options.param=g;var e=this._queryBufferParam(g);if(e){this._doQuery(e)}},searchNearbyBySort:function(e,b,a){this.options.resultType=10;var f=this.options.pageNum;var c=this.options.pageSize;var g={sort:e,center:b,radius:a,pageNum:f,pageSize:c};this.options.param=g;var d=this._queryBufferParam(g);if(d){this._doQuery(d)}},getResults:function(){return this.options.currentResult},clearResults:function(){this.options.currentResult=null;this.options.pageNum=0},getTotalPage:function(){var c;var a=this.options.currentResult;if(a){var b=a.totalCount;if(b&&b>0){c=Math.ceil(b/this.options.pageSize)-1}}return c},firstPage:function(){this.gotoPage(0)},nextPage:function(){var b=this.options.param;var a=b.pageNum;this.gotoPage(a+1)},previousPage:function(){var b=this.options.param;var a=b.pageNum;this.gotoPage(a-1)},lastPage:function(){var b=this.options.param;var a=this.getTotalPage();this.gotoPage(a)},gotoPage:function(b){var c=this.options.param;var a=this.getTotalPage();if(c&&a){if(b>a){b=a}else{if(b<0){b=0}}c.pageNum=b;if(c.radius){url=this._queryBufferParam(c)}else{url=this._queryParam(c)}if(url){this._doQuery(url)}}},searchNear:function(c){this.options.resultType=11;var a=this.options.url;if(!a){return false}a=a+"/nearest?location="+c.lat+","+c.lng;var b=this;L.jsonp(a,null,function(d){if(b.options.onSearchComplete){b.options.onSearchComplete.call(b,d,b.options.resultType)}})},_doQuery:function(a){var b=this;L.jsonp(a,null,function(c){b.options.currentResult=c;if(b.options.onSearchComplete){b.options.onSearchComplete.call(b,c,b.options.resultType)}})},_search:function(b,d){var e=this.options.pageNum;var a=this.options.pageSize;var f={keyword:b,sort:d,pageNum:e,pageSize:a};this.options.param=f;var c=this._queryParam(f);if(c){this._doQuery(c)}},_searchInView:function(b,d){var e=this.map.getBounds();var h=[e.getSouth(),e.getWest(),e.getNorth(),e.getEast()].join(",");var f=this.options.pageNum;var a=this.options.pageSize;var g={keyword:b,sort:d,bounds:h,pageNum:f,pageSize:a};this.options.param=g;var c=this._queryParam(g);if(c){this._doQuery(c)}},_searchStatistics:function(a,c){var d={keyword:a,sort:c};var b=this._queryStatParam(d);if(b){this._doQuery(b)}},_queryParam:function(h){var c=this.options.url;if(!c){return false}var b=h.keyword;var d=h.sort;var e=h.bounds;var g=h.city;var f=h.pageNum;var a=h.pageSize;c=c+"/search?format=json&page_num="+f+"&page_size="+a;if(b){c+="&q="+encodeURIComponent(b)}if(d){c+="&type="+encodeURIComponent(d)}if(g){c+="&city="+encodeURIComponent(g)}if(e){c+="&sq_type=bounds&bounds="+encodeURIComponent(e)}return c},_queryBufferParam:function(c,g,i){var b=this.options.url;if(!b){return false}var d=c.keyword;var h=c.sort;var e=c.radius;var a=option.center;b=b+"/search?format=json";if(d){b+="&q="+encodeURIComponent(d)}if(h){b+="&type="+encodeURIComponent(h)}var g=c.pageNum;var i=c.pageSize;var f="&page_num={page_num}&page_size={page_size}&sq_type=buffer&location={y},{x}&radius={r}".replace("{page_num}",g).replace("{page_size}",i).replace("{x}",a.lng).replace("{y}",a.lat).replace("{r}",e);b+=f;return b},_queryStatParam:function(d){var b=this.options.url;if(!b){return false}var a=d.keyword;var c=d.sort;b=b+"/statistic?";if(a){b+="&q="+encodeURIComponent(a)}if(c){b+="&type="+encodeURIComponent(c)}return b}});L.TLocalSearch=L.Class.extend({options:{url:"http://www.tianditu.com/query.shtml",pageNum:0,pageSize:10,onSearchComplete:null,param:null,resultType:0,currentResult:null},initialize:function(b,a){this.map=b;L.setOptions(this,a)},setUrl:function(a){this.options.url=a},setPageSize:function(a){this.options.pageSize=a},getPageSize:function(){return this.options.pageSize},setSearchCompleteCallback:function(a){this.options.onSearchComplete=a},search:function(a,b){this._search(a,b)},searchInBounds:function(a,b){param.mapBound=b.toBBoxString();this._search(a,10)},searchNearby:function(d,b,a){var e=this.options.pageNum;var c=this.options.pageSize;var f={keyWord:encodeURIComponent(d),pageNum:e,pageSize:c,queryType:3,queryRadius:a,pointLonlat:b.lng+","+b.lat};this.options.param=f;this._dosearch()},getResults:function(){return this.options.currentResult},clearResults:function(){this.options.currentResult=null;this.options.pageNum=0},getTotalPage:function(){var c;var a=this.options.currentResult;if(a){var b=a.count;if(b&&b>0){c=Math.ceil(b/this.options.pageSize)-1}}return c},firstPage:function(){this.gotoPage(0)},nextPage:function(){var b=this.options.param;var a=b.pageNum;this.gotoPage(a+1)},previousPage:function(){var b=this.options.param;var a=b.pageNum;this.gotoPage(a-1)},lastPage:function(){var b=this.options.param;var a=this.getTotalPage();this.gotoPage(a)},gotoPage:function(b){var c=this.options.param;var a=this.getTotalPage();if(c&&a){if(b>a){b=a}else{if(b<0){b=0}}c.pageNum=b;this._dosearch()}},_search:function(c,a){var d=this.options.pageNum;var b=this.options.pageSize;var e={keyWord:encodeURIComponent(c),pageNum:d,pageSize:b,queryType:a};this.options.param=e;this._dosearch()},_dosearch:function(){var c=this.options.param;var a=this._queryParam(c);if(a){var b=this;L.get(L.ProxyHost+a,null,function(d){try{var f=JSON.parse(d);b.options.currentResult=f;if(b.options.onSearchComplete){b.options.onSearchComplete.call(b,f,b.options.queryType)}}catch(g){if(b.options.onSearchComplete){b.options.onSearchComplete.call(b,d,b.options.queryType)}}})}},_queryParam:function(d){var b=this.options.url;if(!b){return false}var l=L.setOptions({},d);var h=d.pageSize;var c=d.pageNum*d.pageSize;if(this.map){var a=this.map.getZoom();l.level=l.level||a;var k=this.map.getBounds().toBBoxString();l.mapBound=l.mapBound||k}l.queryType=l.queryType||1;l.count=h||10;l.start=c||0;var j=["keyWord","level","mapBound","pointLonlat","queryRadius","queryType","specifyAdminCode","count","start"];var g="?postStr=";var e=[];for(var f=0;f<j.length;f++){var m=j[f];if(m in l){e.push("'"+m+"':'"+l[m]+"'")}}g+="{"+e.join(",")+"}";g+="&type=query";b=b+encodeURIComponent(g);return b}});L.RoutePlan=L.Class.extend({options:{plan:null},initialize:function(a){L.setOptions(this,a)},getDistance:function(){var a=this.options.plan;if(a){return parseInt(a.distance/1000)+""}return null},getDuration:function(){var a=this.options.plan;if(a){return this._formatMinute(route.duration)}return null},getNumSteps:function(){var a=this.options.plan;if(a){return a.steps.length}return null},getStep:function(b){var c=this.options.plan;if(c){var a=c.steps;return a[b]}return null},_formatMinute:function(d){var c=parseInt(d);var b=0;if(c>60){b=parseInt(c/60);c=parseInt(c%60)}var a=0;if(b>0){a=""+parseInt(b)+""}a=a+c+"";return a}});L.DrivingRoute=L.Class.extend({options:{url:null,policy:0,onSearchComplete:null,start:null,end:null,waypoints:[],currentResult:null,},initialize:function(b,a){this.map=b;L.setOptions(this,a)},setPolicy:function(b,a){this.options.policy=b;if(!a){this._search()}},search:function(b,a){if(b instanceof L.LatLng&&a instanceof L.LatLng){this.options.start=b;this.options.end=a;this._search()}else{this._failFn()}},setWayPoints:function(b,a){if(b&&b.length>0){this.options.waypoints=b;if(!a){this._search()}}},getWayPoints:function(){return this.options.waypoints},clearResults:function(){this.options.policy=0;this.options.start=null;this.options.end=null;this.options.currentResult=null},getResults:function(){return this.options.currentResult},getStart:function(){return this.options.start},getEnd:function(){return this.options.end},getNumPlans:function(){var a=this.options.currentResult;if(a&&a.status.toLowerCase()=="ok"){return a.totalCount}else{return 0}},getPlan:function(a){var b=this.getNumPlans();var c;if(b>0){var d=this.options.currentResult.results;if(typeof a==="number"&&isFinite(a)&&a<=b){c=d[a];return new L.RoutePlan({plan:c})}}return false},_failFn:function(){var a={msg:"L.LatLng",status:"error"};if(this.options.onSearchComplete){this.options.onSearchComplete.call(this,a)}},_search:function(){var a=this._queryParam();if(a){var b=this;L.jsonp(a,null,function(c){b.options.currentResult=c;if(b.options.onSearchComplete){b.options.onSearchComplete.call(b,c)}})}},_queryParam:function(){var a=this.options.url;var b=this.options.start;var c=this.options.end;var g=this.options.policy;if(b&&c&&a){var k=b.lng+","+b.lat;var j=c.lng+","+c.lat;a=a+"?format=json&origin="+k+"&destination="+j+"&mode="+g;var h=this.getWayPoints();if(h&&h.length>0){var f=[];for(var e=0;e<h.length;e++){var d=h[e].lng+","+h[e].lat;f.push(d)}a+="&waypoints="+f.join(";")}return a}else{return false}}});L.TDrivingRoute=L.Class.extend({options:{url:"http://www.tianditu.com/query.shtml",policy:0,onSearchComplete:null,start:null,end:null,waypoints:[],currentResult:null,},initialize:function(b,a){this.map=b;L.setOptions(this,a)},setPolicy:function(b,a){this.options.policy=b;if(!a){this._search()}},search:function(b,a){if(b instanceof L.LatLng&&a instanceof L.LatLng){this.options.start=b;this.options.end=a;this._search()}else{this._failFn()}},setWayPoints:function(b,a){if(b&&b.length>0){this.options.waypoints=b;if(!a){this._search()}}},getWayPoints:function(){return this.options.waypoints},clearResults:function(){this.options.policy=0;this.options.start=null;this.options.end=null;this.options.currentResult=null},getResults:function(){return this.options.currentResult},getStart:function(){return this.options.start},getEnd:function(){return this.options.end},_failFn:function(){var a={msg:"L.LatLng",status:"error"};if(this.options.onSearchComplete){this.options.onSearchComplete.call(this,a)}},_search:function(){var a=this._queryParam();if(a){var b=this;L.get(a,null,function(c){try{var g=new L.Format.TRouteResultFormat();var d=new L.TRouteResult(g.read(c));b.options.currentResult=d;if(b.options.onSearchComplete){b.options.onSearchComplete.call(b,d)}}catch(f){if(b.options.onSearchComplete){b.options.onSearchComplete.call(b,c)}}})}},_queryParam:function(){var a=this.options.url;var b=this.options.start;var c=this.options.end;var k=this.options.policy;if(b&&c&&a){var l=this.getWayPoints();var q="";if(l&&l.length>0){var j=[];for(var g=0;g<l.length;g++){var e=l[g].lng+","+l[g].lat;j.push(e)}q=j.join(";")}var p=b.lng+","+b.lat;var m=c.lng+","+c.lat;var o={};o.orig=p;o.dest=m;o.style=k;o.mid=q;var h=["orig","dest","style","mid"];var f="?postStr=";var d=[];for(var g=0;g<h.length;g++){var r=h[g];if(r in o){d.push("'"+r+"':'"+o[r]+"'")}}f+="{"+d.join(",")+"}";f+="&type=search";a=a+f;return a}else{return false}}});L.ImeMapService=L.Class.extend({options:{url:null},initialize:function(a){L.setOptions(this,a)},getLayerLegend:function(a,g,h){var c=this.options.url+"/"+a+"/legend?";var f=["width","height","format"];var b=0;for(var d=0;d<f.length;d++){var e=f[d];if(e in g){if(b==0){c+=e+"="+g[e]}else{c+="&"+e+"="+g[e]}b++}}L.jsonp(c,null,function(i){if(h&&typeof h=="function"){h(i)}})},querySingleLayer:function(a,g,h){var c=this.options.url+"/"+a+"/query?";var f=["spatialOper","geometry","where","orderBy","outFields","format"];var b=0;for(var d=0;d<f.length;d++){var e=f[d];if(e in g){if(e=="geometry"){g[e]=L.Util.writeGeometryToWKT(g[e],"polygon")}if(b==0){c+=e+"="+g[e]}else{c+="&"+e+"="+g[e]}b++}}L.jsonp(c,null,function(i){if(h&&typeof h=="function"){h(i)}})},identify:function(f,e,g){var a={};a.xmin=f.xmin;a.ymin=f.ymin;a.xmax=f.xmax;a.ymax=f.ymax;a.width=f.width;a.height=f.height;if(f.layers){a.layers=f.layers}L.extend(a,e);var c=this.options.url+"/identify";var d=L.Util.getParamString(a);var b=c+"?"+d;L.jsonp(b,null,function(h){if(g&&typeof g=="function"){g(h)}})}});